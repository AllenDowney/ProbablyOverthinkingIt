

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Better Than New &#8212; Probably Overthinking It</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'nbue';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Jumping to Conclusions" href="berkson.html" />
    <link rel="prev" title="Extremes, Outliers, and GOATs" href="lognormal.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">Probably Overthinking It</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Probably Overthinking It
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gaussian.html">Are You Normal? Hint: No.</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspection.html">Relay Races and Revolving Doors</a></li>
<li class="toctree-l1"><a class="reference internal" href="preston.html">Defy Tradition, Save the World</a></li>
<li class="toctree-l1"><a class="reference internal" href="lognormal.html">Extremes, Outliers, and GOATs</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Better Than New</a></li>
<li class="toctree-l1"><a class="reference internal" href="berkson.html">Jumping to Conclusions</a></li>
<li class="toctree-l1"><a class="reference internal" href="birthweight.html">Causation, Collision, and Confusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="longtail.html">The Long Tail of Disaster</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_rate.html">Fairness and Fallacy</a></li>
<li class="toctree-l1"><a class="reference internal" href="simpson.html">Penguins, Pessimists, and Paradoxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress.html">Changing Hearts and Minds</a></li>
<li class="toctree-l1"><a class="reference internal" href="overton.html">Chasing the Overton Window</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ansur_pca.html">The Principal Components of Anthropometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="bertrand.html">Bertrand’s Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="ideology_gap.html">Is the Ideology Gap Growing?</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AllenDowney/ProbablyOverthinkingIt" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/nbue.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Better Than New</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#light-bulbs">Light Bulbs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#any-day-now">Any day now</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cancer-survival-times">Cancer survival times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#life-expectancy-at-birth">Life Expectancy At Birth</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#child-mortality">Child mortality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-immortal-swede">The Immortal Swede</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="better-than-new">
<h1>Better Than New<a class="headerlink" href="#better-than-new" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/ProbablyOverthinkingIt/blob/book/notebooks/nbue.ipynb">Click here to run this notebook on Colab</a>.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install empiricaldist if we don&#39;t already have it</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">empiricaldist</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>empiricaldist
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># download utils.py</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">exists</span>


<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>

        <span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Downloaded &quot;</span> <span class="o">+</span> <span class="n">local</span><span class="p">)</span>


<span class="n">download</span><span class="p">(</span>
    <span class="s2">&quot;https://github.com/AllenDowney/ProbablyOverthinkingIt/raw/book/notebooks/utils.py&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">DATA_PATH</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/AllenDowney/ProbablyOverthinkingIt/raw/book/data/&quot;</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">font_scale</span><span class="o">=</span><span class="mf">1.1</span><span class="p">)</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">rc</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">:(</span><span class="mi">6</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">)})</span>
<span class="n">sns</span><span class="o">.</span><span class="n">set_style</span><span class="p">(</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>

<span class="c1"># Set the random seed so we get the same results every time</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">utils</span>

<span class="k">def</span> <span class="nf">decorate</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">decorate</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">despine</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">fit_normal</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">make_cdf</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">normal_error_bounds</span>


<span class="k">def</span> <span class="nf">make_plot</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">model_label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">plot_bounds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the data and a normal model.</span>
<span class="sd">    </span>
<span class="sd">    series: Series</span>
<span class="sd">    model_label: string</span>
<span class="sd">    plot_bounds: boolean, whether to plot the expected upper bound</span>
<span class="sd">    qs: sequence of quantities where the model should be evaluated</span>
<span class="sd">    options: passed to plt.plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cdf</span> <span class="o">=</span> <span class="n">make_cdf</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
    <span class="n">dist</span> <span class="o">=</span> <span class="n">fit_normal</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">))</span>
    <span class="n">upper</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">plot_bounds</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">upper</span><span class="p">,</span> <span class="n">p</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="s2">&quot;+&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">qs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">q_max</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">upper</span><span class="p">)</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cdf</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">q_max</span><span class="p">)</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">normal_error_bounds</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">low</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">high</span> <span class="o">*</span> <span class="mi">100</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

    <span class="n">cdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
    <span class="k">if</span> <span class="s1">&#39;dpi&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">options</span><span class="p">:</span>
        <span class="n">options</span><span class="p">[</span><span class="s1">&#39;dpi&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">300</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Suppose you work in a hospital, and one day you have lunch with three of your colleagues.
One is a facilities engineer working on a new lighting system, one is an obstetrician who works in the maternity ward, and one is an oncologist who works with cancer patients.
While you all enjoy the hospital food, each of them poses a statistical puzzle.</p>
<p>The engineer says they are replacing old incandescent light bulbs with LED bulbs, and they’ve decided to replace the oldest bulbs first.
According to previous tests, the bulbs last 1400 hours on average.
So, they ask, which do you think will last longer: a new bulb or one that has already been lit for 1000 hours?</p>
<p>Sensing a trick question, you ask if the new bulb might be defective.
The engineer says, no, let’s assume we’ve confirmed that it works.
In that case, you say, I think the new bulb will last longer.</p>
<p>“That’s right,” says the engineer.
“Light bulbs behave as you expect; they wear out over time, so the longer they’ve been in use, the sooner they burn out, on average.”</p>
<p>“However,” says the obstetrician, “not everything works that way.
For example, most often, pregnancy lasts 39 or 40 weeks.
Today I saw three patients who are all pregnant; the first is at the beginning of week 39, the second is at the beginning of week 40, and the third is at the beginning of week 41.
Which one do you think will deliver her baby first?”</p>
<p>Now you are sure it’s a trick question, but just to play along, you say the third patient is likely to deliver first.</p>
<p>The obstetrician says no, the remaining duration of the three pregnancies is nearly the same, about four days.
Even taking medical intervention into account, all three have the same chance of delivering first.</p>
<p>“That’s surprising,” says the oncologist.
“But in my field things are even stranger.
For example, today I saw two patients with glioblastoma, which is a kind of brain cancer. They are about the same age, and the stage of their cancers is about the same, but one of them was diagnosed a week ago and one was diagnosed a year ago.
Unfortunately, the average survival time after diagnosis is only about a year.
So you probably expect the first patient to live longer.”</p>
<p>By now you know better than to guess, so you wait for the answer.</p>
<p>The oncologist explains that many patients with glioblastoma live only a few months after diagnosis.
So, it turns out, a patient who survives one year after diagnosis is then <em>more</em> likely to survive a second year.</p>
<p>Based on this conversation, we can see that there are three ways survival times can go:</p>
<ul class="simple">
<li><p>Many things wear out over time, like light bulbs, so we expect something new to last longer than something old.</p></li>
<li><p>But there are some situations, like patients after a cancer diagnosis, that are the other way around: the longer someone has survived, the longer we expect them to survive.</p></li>
<li><p>And there are some situations, like women expecting babies, where the average remaining time doesn’t change, at least for a while.</p></li>
</ul>
<p>In this chapter I’ll demonstrate and explain each of these effects, starting with light bulbs.</p>
<section id="light-bulbs">
<h2>Light Bulbs<a class="headerlink" href="#light-bulbs" title="Permalink to this heading">#</a></h2>
<p>The data are available in a gist:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span>
    <span class="s2">&quot;https://gist.github.com/epogrebnyak/7933e16c0ad215742c4c104be4fbdeb1/raw/c932bc5b6aa6317770c4cbf43eb591511fec08f9/lamps.csv&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;lamps.csv&quot;</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>h</th>
      <th>f</th>
      <th>K</th>
    </tr>
    <tr>
      <th>i</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28</th>
      <td>1812</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <th>29</th>
      <td>1836</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <th>30</th>
      <td>1860</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <th>31</th>
      <td>1980</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>32</th>
      <td>2568</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">h</span></code> column contains the quantities; the <code class="docutils literal notranslate"><span class="pre">k</span></code> column contains the frequencies (counts).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Pmf</span>

<span class="n">pmf_lifetimes</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;h&quot;</span><span class="p">])</span>
<span class="n">pmf_lifetimes</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;t&quot;</span>
</pre></div>
</div>
</div>
</div>
<p>We can use a <code class="docutils literal notranslate"><span class="pre">Counter</span></code> to reconstitute the 50 individual lifetimes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">Counter</span>

<span class="n">lifetimes</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">Counter</span><span class="p">(</span><span class="n">pmf_lifetimes</span><span class="o">.</span><span class="n">to_dict</span><span class="p">())</span><span class="o">.</span><span class="n">elements</span><span class="p">())</span>
<span class="n">lifetimes</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count      50.000000
mean     1413.840000
std       346.520628
min       840.000000
25%      1176.000000
50%      1446.000000
75%      1653.000000
max      2568.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Here’s a normal distribution that has the same mean and standard deviation as the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">lifetimes</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lifetimes</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1413.84, 346.52062753337276)
</pre></div>
</div>
</div>
</div>
<p>The following figure shows the distribution of survival times for these light bulbs, plotted as a cumulative distribution function (CDF), along with a Gaussian model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Cdf</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">500</span><span class="p">,</span> <span class="mi">2500</span><span class="p">)</span>
<span class="n">ps</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">ps</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gaussian model&quot;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">)</span>
<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">normal_error_bounds</span><span class="p">(</span><span class="n">dist</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">surv</span> <span class="o">=</span> <span class="n">Cdf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">)</span>
<span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Duration (hours)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;CDF&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of light bulb lifetimes&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/12222e93b86bb61567b5ef1a0c658a53bfe0af783e120e4d877bc4acfec43c93.png" src="_images/12222e93b86bb61567b5ef1a0c658a53bfe0af783e120e4d877bc4acfec43c93.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<span class="n">ys</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">)</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
<span class="n">density</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
<span class="n">density</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.06666298081917303
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span> <span class="o">=</span> <span class="n">lifetimes</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">mean</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1413.84
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decorate_kde</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">decorate</span><span class="p">(</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Duration (hours)&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Density&quot;</span><span class="p">,</span>
        <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">3000</span><span class="p">],</span>
        <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_density</span><span class="p">(</span><span class="n">density</span><span class="p">):</span>
    <span class="n">mean</span> <span class="o">=</span> <span class="n">density</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">density</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">mean</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
    <span class="c1"># plt.text(mean-20, 0.002, f&#39;mean  {mean:0.0f}&#39;, ha=&#39;center&#39;)</span>
    <span class="n">decorate_kde</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_density</span><span class="p">(</span><span class="n">density</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue1a.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1c07c29848f9b75d2c62d2f5abd7e9ada347935a1aaa142c738d6d197743ea09.png" src="_images/1c07c29848f9b75d2c62d2f5abd7e9ada347935a1aaa142c738d6d197743ea09.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_conditional</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
    <span class="n">left</span> <span class="o">=</span> <span class="n">density</span><span class="p">[</span><span class="n">density</span><span class="o">.</span><span class="n">qs</span> <span class="o">&lt;</span> <span class="n">age</span><span class="p">]</span>
    <span class="n">right</span> <span class="o">=</span> <span class="n">density</span><span class="p">[</span><span class="n">density</span><span class="o">.</span><span class="n">qs</span> <span class="o">&gt;=</span> <span class="n">age</span><span class="p">]</span>

    <span class="n">left</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
    <span class="n">right</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">right</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">decorate_kde</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">right</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">age</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">conditional</span> <span class="o">=</span> <span class="n">plot_conditional</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue1b.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c28b61f5686c36f6d2f01a8542cf657529d214d748e64dba5d539aa0e9ea0101.png" src="_images/c28b61f5686c36f6d2f01a8542cf657529d214d748e64dba5d539aa0e9ea0101.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shifted</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">conditional</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">conditional</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">age</span><span class="p">)</span>
<span class="n">shifted</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">plot_density</span><span class="p">(</span><span class="n">shifted</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue1c.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/42fc1eb7f43f940590d8f3e9f6e2811ef4b8de435f0699595e9d44c7ea0df7a6.png" src="_images/42fc1eb7f43f940590d8f3e9f6e2811ef4b8de435f0699595e9d44c7ea0df7a6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">age</span> <span class="o">=</span> <span class="mi">500</span>
<span class="n">conditional</span> <span class="o">=</span> <span class="n">plot_conditional</span><span class="p">(</span><span class="n">shifted</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue1d.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/35fe467fcd3877ec031335770219481bb657f221302993ed3544e057150ff718.png" src="_images/35fe467fcd3877ec031335770219481bb657f221302993ed3544e057150ff718.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">shifted</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">conditional</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">conditional</span><span class="o">.</span><span class="n">index</span> <span class="o">-</span> <span class="n">age</span><span class="p">)</span>
<span class="n">shifted</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">plot_density</span><span class="p">(</span><span class="n">shifted</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue1e.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a415fb9c4ca59d895d08f618929cee976aa7502cecc9d5551338022a69d274b6.png" src="_images/a415fb9c4ca59d895d08f618929cee976aa7502cecc9d5551338022a69d274b6.png" />
</div>
</div>
<p>The shaded area shows how much variation we expect from the Gaussian model.
Except for one unusually long-lasting bulb, the lifetimes fall within the bounds, which shows that the data are consistent with the model.</p>
<p>In this dataset, the average lifetime for a new light bulb is about 1414 hours.
For a bulb that has been used for 1000 hours, the average lifetime is higher, about 1495 hours; however, since it has already burned 1000 hours, its average remaining lifetime is only 495 hours.
So we would rather have the new bulb.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1413.84
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lifetimes</span><span class="p">[</span><span class="n">lifetimes</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1000</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>495.2558139534883
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lifetimes</span><span class="p">[</span><span class="n">lifetimes</span> <span class="o">&gt;</span> <span class="mi">1500</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="mi">1500</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>213.391304347826
</pre></div>
</div>
</div>
</div>
<p>We can do the same calculation for a range of elapsed times from 0 to 2568 hours (the lifespan of the oldest bulb).
At each point in time, <span class="math notranslate nohighlight">\(t\)</span>, we can compute the average lifetime for bulbs that survive past <span class="math notranslate nohighlight">\(t\)</span> and the average remaining lifetime we expect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remaining_lifetimes_seq</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">qs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute average remaining lifetimes.</span>
<span class="sd">    </span>
<span class="sd">    seq: sequence of quantities</span>
<span class="sd">    qs: ages to evaluate</span>
<span class="sd">    </span>
<span class="sd">    returns: Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">qs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">seq</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">200</span><span class="p">)</span>        

    <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="n">qs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">qs</span><span class="p">:</span>
        <span class="n">conditional</span> <span class="o">=</span> <span class="n">Pmf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">seq</span><span class="p">[</span><span class="n">seq</span> <span class="o">&gt;=</span> <span class="n">q</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">conditional</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">conditional</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
            <span class="n">series</span><span class="p">[</span><span class="n">q</span><span class="p">]</span> <span class="o">=</span> <span class="n">conditional</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">q</span>

    <span class="k">return</span> <span class="n">series</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>To compute error bounds, we’ll use resampling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">resample</span><span class="p">(</span><span class="n">xs</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Resample a sequence of quantities.</span>
<span class="sd">    </span>
<span class="sd">    xs: quantities</span>
<span class="sd">    </span>
<span class="sd">    returns: sample</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">lifetimes</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">lifetimes</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
<span class="n">dist</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">)</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">pmf_lifetimes</span><span class="o">.</span><span class="n">index</span>
</pre></div>
</div>
</div>
</div>
<p>The following loop generates multiple resamplings and compute the remaining lifetimes for each.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span>

<span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">)</span>

<span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2550</span><span class="p">,</span> <span class="mi">50</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">201</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">lifetimes</span><span class="p">))</span>
    <span class="n">rem</span> <span class="o">=</span> <span class="n">remaining_lifetimes_seq</span><span class="p">(</span><span class="n">sample</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">lifetimes</span><span class="p">[</span><span class="n">lifetimes</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">-</span> <span class="n">x</span>
<span class="n">x</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1000, 495.2558139534883)
</pre></div>
</div>
</div>
</div>
<p>The following two functions compile the results and compute error bounds.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">percentile_rows</span><span class="p">(</span><span class="n">series_seq</span><span class="p">,</span> <span class="n">ps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes percentiles from aligned series.</span>

<span class="sd">    series_seq: list of sequences</span>
<span class="sd">    ps: cumulative probabilities</span>

<span class="sd">    returns: Series of x-values, NumPy array with selected rows</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># NOTE: This is a specialized version of this function that</span>
    <span class="c1"># fills NaNs with 0</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">series_seq</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
    <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">nrows</span><span class="p">,</span> <span class="n">ncols</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>

    <span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
    <span class="n">indices</span> <span class="o">=</span> <span class="p">(</span><span class="n">ps</span> <span class="o">*</span> <span class="n">nrows</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">rows</span> <span class="o">=</span> <span class="n">array</span><span class="p">[</span><span class="n">indices</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">xs</span><span class="p">,</span> <span class="n">rows</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_percentiles</span><span class="p">(</span><span class="n">series_seq</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot the low, median, and high percentiles.</span>
<span class="sd">    </span>
<span class="sd">    series_seq: sequence of Series</span>
<span class="sd">    ps: percentiles to use for low, medium and high</span>
<span class="sd">    label: string label for the median line</span>
<span class="sd">    options: options passed plt.plot and plt.fill_between</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>
    <span class="n">xs</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">percentile_rows</span><span class="p">(</span><span class="n">series_seq</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">rows</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">label</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.5</span><span class="p">]</span>
<span class="n">xs</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">percentile_rows</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span>
<span class="p">(</span><span class="n">med</span><span class="p">,)</span> <span class="o">=</span> <span class="n">rows</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">med</span><span class="p">,</span> <span class="n">xs</span><span class="p">)[</span><span class="n">x</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plot_percentiles</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Elapsed time in hours&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining lifetime&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Average remaining lifetime of light bulbs&quot;,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue2.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/0de1a884cba696e71de3de43b80ec79169187cba911082a596eacb647626a855.png" src="_images/0de1a884cba696e71de3de43b80ec79169187cba911082a596eacb647626a855.png" />
</div>
</div>
<p>The x-axis shows elapsed times since the installation of a hypothetical light bulb.
The y-axis shows the average remaining lifetime.
In this example, a bulb that has been burning for 1000 hours is expected to last about 495 hours more, as indicated by the dotted lines.</p>
<p>So a new bulb generally lasts longer than a used bulb.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">lifetimes</span> <span class="o">&gt;</span> <span class="mi">1450</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="p">(</span><span class="n">lifetimes</span> <span class="o">&gt;</span> <span class="mi">1710</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="p">(</span><span class="n">lifetimes</span> <span class="o">&gt;</span> <span class="mi">1800</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(25, 11, 5)
</pre></div>
</div>
</div>
</div>
</section>
<section id="any-day-now">
<h2>Any day now<a class="headerlink" href="#any-day-now" title="Permalink to this heading">#</a></h2>
<p>Now let’s consider the question posed by the imaginary obstetrician at lunch.
Suppose you visit a maternity ward and meet women who are starting their 39th, 40th, and 41st week of pregnancy.
Which one do you think will deliver first?</p>
<p>To answer this question, we need to know the distribution of gestation times, which we can get from the National Survey of Family Growth (NSFG), which was the source of the birth weights in Chapter~\ref{extremes-outliers-and-goats}.
I gathered data collected between 2002 and 2017, which includes information about 43,939 live births.</p>
<p>I’ve made a subset of the data available in an HDF file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="s2">&quot;nsfg.hdf5&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data cleaning is in FirstLateNSFG repo</span>
<span class="c1"># includes data from 2002, 2006-2010, 2011-2013, 2013-2015,  2015-2017</span>

<span class="n">nsfg</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">&quot;nsfg.hdf5&quot;</span><span class="p">,</span> <span class="s2">&quot;nsfg&quot;</span><span class="p">)</span>
<span class="n">nsfg</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(62539, 7)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nsfg</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>pregend1</th>
      <th>nbrnaliv</th>
      <th>prglngth</th>
      <th>outcome</th>
      <th>birthord</th>
      <th>finalwgt</th>
      <th>cycle</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>6.0</td>
      <td>1.0</td>
      <td>40</td>
      <td>1</td>
      <td>1.0</td>
      <td>19877.457610</td>
      <td>10</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1.0</td>
      <td>NaN</td>
      <td>14</td>
      <td>4</td>
      <td>NaN</td>
      <td>19877.457610</td>
      <td>10</td>
    </tr>
    <tr>
      <th>2</th>
      <td>6.0</td>
      <td>1.0</td>
      <td>39</td>
      <td>1</td>
      <td>2.0</td>
      <td>19877.457610</td>
      <td>10</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6.0</td>
      <td>1.0</td>
      <td>39</td>
      <td>1</td>
      <td>1.0</td>
      <td>4221.017695</td>
      <td>10</td>
    </tr>
    <tr>
      <th>4</th>
      <td>6.0</td>
      <td>1.0</td>
      <td>39</td>
      <td>1</td>
      <td>2.0</td>
      <td>4221.017695</td>
      <td>10</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>I selected live births with pregnancy lengths less than 45 weeks (the outliers are probably errors).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">live</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s2">&quot;outcome&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
<span class="n">reasonable</span> <span class="o">=</span> <span class="n">nsfg</span><span class="p">[</span><span class="s2">&quot;prglngth&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">45</span>

<span class="n">lengths</span> <span class="o">=</span> <span class="n">nsfg</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">live</span> <span class="o">&amp;</span> <span class="n">reasonable</span><span class="p">,</span> <span class="s2">&quot;prglngth&quot;</span><span class="p">]</span>
<span class="n">pmf_length</span> <span class="o">=</span> <span class="n">Pmf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
<span class="nb">len</span><span class="p">(</span><span class="n">lengths</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>43246
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">lengths</span> <span class="o">&lt;</span> <span class="mi">28</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9272533875965407
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gt</span> <span class="o">=</span> <span class="n">pmf_length</span><span class="o">.</span><span class="n">qs</span> <span class="o">&gt;=</span> <span class="mi">28</span>
<span class="n">pmf_length_gt</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">pmf_length</span><span class="p">[</span><span class="n">gt</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows the distribution of their durations (except for the 1% of babies born prior to 28 weeks).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_length_gt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Pregnancy length (weeks)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percentage&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Distribution of pregnancy length&quot;,</span>
    <span class="n">xticks</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">28</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue3.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b5b9cb0937d63f680273a9c5521bfc95e0693e124afccc50f8c05ca2002b3b9a.png" src="_images/b5b9cb0937d63f680273a9c5521bfc95e0693e124afccc50f8c05ca2002b3b9a.png" />
</div>
</div>
<p>About 41% of these births were during the 39th week of pregnancy, and another 18% during the 40th week.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lengths</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pmf_length_gt</span><span class="p">[</span><span class="mi">39</span><span class="p">],</span> <span class="n">pmf_length_gt</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(38.505341534477175, 42.357674698237986, 17.400453221107153)
</pre></div>
</div>
</div>
</div>
<p>I’ll use resampling to compute error bounds. Since the sampling weights are specific to each cycle, I’ll do the resampling within the cycles.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">nsfg</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cycle&quot;</span><span class="p">):</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">group</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>6 13593
7 20492
8 9543
9 9358
10 9553
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">sample_by_cycle</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;cycle&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="s2">&quot;finalwgt&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sample</span>
</pre></div>
</div>
</div>
</div>
<p>The following loop computes the remaining lifetimes for each resampling.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">36</span><span class="p">,</span> <span class="mi">44</span><span class="p">)</span>
<span class="n">mrt_seq</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">sample_by_cycle</span><span class="p">(</span><span class="n">nsfg</span><span class="p">)</span>

    <span class="n">live</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;outcome&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span>
    <span class="n">reasonable</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;prglngth&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">50</span>

    <span class="n">lengths</span> <span class="o">=</span> <span class="n">sample</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">live</span> <span class="o">&amp;</span> <span class="n">reasonable</span><span class="p">,</span> <span class="s2">&quot;prglngth&quot;</span><span class="p">]</span>
    <span class="n">mrt</span> <span class="o">=</span> <span class="n">remaining_lifetimes_seq</span><span class="p">(</span><span class="n">lengths</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>

    <span class="n">mrt_seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mrt</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">decorate_pregnancy</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">):</span>
    <span class="n">decorate</span><span class="p">(</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Week of pregnancy&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining time&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span>
        <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">],</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the previous version of plot_percentiles was specialized;</span>
<span class="c1"># for this analysis we want the general one (not that it matters)</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">plot_percentiles</span>

<span class="n">plot_percentiles</span><span class="p">(</span><span class="n">mrt_seq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>

<span class="c1">#decorate_pregnancy(title=&quot;Average remaining duration of pregancy&quot;)</span>
<span class="n">decorate_pregnancy</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue4.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3f61f1688486550fe3b65b32be6f3aa777e621905f8faaece7b462ade9de924f.png" src="_images/3f61f1688486550fe3b65b32be6f3aa777e621905f8faaece7b462ade9de924f.png" />
</div>
</div>
<p>Between weeks 36 and 39, the curve behaves as we expect: as time goes on, we get closer to the finish line.
For example, at the beginning of week 36, the average remaining time is 3.2 weeks.
At the beginning of week 37, it is down to 2.3 weeks.
So far, so good: a week goes by and the finish line is just about one week closer.</p>
<p>But then, cruelly, the curve levels off.
At the beginning of week 39, the average remaining time is 0.68 weeks, so the end seems near.
But if we get to the beginning of week 40, and the baby has not been born, the average remaining time is 0.63 weeks.
A week has passed and the finish line is only 8 hours closer.</p>
<p>And if we get to the beginning of week 41, and the baby has not been born, the average remaining time is 0.59 weeks.
Another week has passed and the finish line is only 7 hours closer!</p>
<p>Here’s the computation for the average remaining time at the end of each week.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">percentile_rows</span>

<span class="n">xs</span><span class="p">,</span> <span class="n">ys</span> <span class="o">=</span> <span class="n">percentile_rows</span><span class="p">(</span><span class="n">mrt_seq</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.025</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.975</span><span class="p">])</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">ys</span><span class="p">),</span> <span class="n">xs</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2.5</th>
      <th>50.0</th>
      <th>97.5</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>36</th>
      <td>3.142822</td>
      <td>3.153736</td>
      <td>3.165931</td>
    </tr>
    <tr>
      <th>37</th>
      <td>2.292390</td>
      <td>2.303369</td>
      <td>2.316928</td>
    </tr>
    <tr>
      <th>38</th>
      <td>1.465161</td>
      <td>1.474933</td>
      <td>1.488573</td>
    </tr>
    <tr>
      <th>39</th>
      <td>0.669659</td>
      <td>0.679651</td>
      <td>0.692118</td>
    </tr>
    <tr>
      <th>40</th>
      <td>0.612146</td>
      <td>0.629809</td>
      <td>0.647226</td>
    </tr>
    <tr>
      <th>41</th>
      <td>0.560671</td>
      <td>0.586682</td>
      <td>0.611351</td>
    </tr>
    <tr>
      <th>42</th>
      <td>0.320918</td>
      <td>0.352373</td>
      <td>0.382273</td>
    </tr>
    <tr>
      <th>43</th>
      <td>0.220000</td>
      <td>0.271242</td>
      <td>0.340611</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">40</span><span class="p">,</span> <span class="mi">41</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">7</span> <span class="o">*</span> <span class="mi">24</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>40   -8.373551
41   -7.245228
Name: 50.0, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Hazard</span>

<span class="n">series</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="mi">50</span><span class="p">]</span>
<span class="n">interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>

<span class="n">x</span> <span class="o">=</span> <span class="mi">39</span>

<span class="k">for</span> <span class="n">letter</span> <span class="ow">in</span> <span class="s1">&#39;abcdef&#39;</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">*</span><span class="mi">7</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plot_percentiles</span><span class="p">(</span><span class="n">mrt_seq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">36</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mi">37</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">y</span><span class="o">*</span><span class="mi">7</span><span class="si">:</span><span class="s1">0.2f</span><span class="si">}</span><span class="s1"> days&#39;</span><span class="p">)</span>
    <span class="n">decorate_pregnancy</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;nbue4</span><span class="si">{</span><span class="n">letter</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">+=</span> <span class="n">y</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>39 4.757559429477013
39.679651347068145 4.520430465974382
40.32542712792163 4.310420075240543
40.941201424384566 4.124527367596406
41.530419619755484 3.2367992226202267
41.99281950870123 2.4783853029123057
</pre></div>
</div>
<img alt="_images/3325ceeb475d289eec541fd593a14008a4595d3ce521d0cebceba4d46e566c21.png" src="_images/3325ceeb475d289eec541fd593a14008a4595d3ce521d0cebceba4d46e566c21.png" />
<img alt="_images/2f0a39c7f6128f381ef38490676e82bf9ef293d3e300f8a96ae428387b947248.png" src="_images/2f0a39c7f6128f381ef38490676e82bf9ef293d3e300f8a96ae428387b947248.png" />
<img alt="_images/c123f4e8c2a8691230c8755d7cb9aa8e56a92c85b5429793040189db634d52d3.png" src="_images/c123f4e8c2a8691230c8755d7cb9aa8e56a92c85b5429793040189db634d52d3.png" />
<img alt="_images/968ec3bdd62277f0fc49151efd353eef6515c0f09ab96b6370876add678eb79c.png" src="_images/968ec3bdd62277f0fc49151efd353eef6515c0f09ab96b6370876add678eb79c.png" />
<img alt="_images/c2c4014bb33d717fa6c6330ba5bd572b5820c18405eb6dfe70607251e7858e1e.png" src="_images/c2c4014bb33d717fa6c6330ba5bd572b5820c18405eb6dfe70607251e7858e1e.png" />
<img alt="_images/c849804d22dac9033ba82dcc07448e8ea3542f73c08767775fccbfeedd6a3eb1.png" src="_images/c849804d22dac9033ba82dcc07448e8ea3542f73c08767775fccbfeedd6a3eb1.png" />
</div>
</div>
</section>
<section id="cancer-survival-times">
<h2>Cancer survival times<a class="headerlink" href="#cancer-survival-times" title="Permalink to this heading">#</a></h2>
<p>Finally, let’s consider the surprising result reported by the imaginary oncologist at lunch: for many cancers, a patient who has survived a year after diagnosis is expected to live longer than someone who has just been diagnosed.</p>
<p>To demonstrate and explain this result, I’ll use data from the the Surveillance, Epidemiology, and End Results (SEER) program, which is run by the U.S. National Institutes of Health (NIH).
Starting in 1973, SEER has collected data on cancer cases from registries in several locations in the United States.
In the most recent datasets, these registries cover about one third of the U.S. population.</p>
<p>NOTE: I am definitely not allowed to redistribute SEER data, so the data in this example in synthetic; that is, I have generated random data that is statistically similar to the actual data I reported in the book. The results below will differ from what’s in the book, but the conclusions are qualitatively similar.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;brain.hdf&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">&quot;brain.hdf&quot;</span><span class="p">,</span> <span class="s2">&quot;brain&quot;</span><span class="p">)</span>
<span class="n">brain</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(16202, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brain</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>duration</th>
      <th>observed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>4.50</td>
      <td>True</td>
    </tr>
    <tr>
      <th>1</th>
      <td>15.75</td>
      <td>True</td>
    </tr>
    <tr>
      <th>2</th>
      <td>10.75</td>
      <td>True</td>
    </tr>
    <tr>
      <th>3</th>
      <td>6.25</td>
      <td>True</td>
    </tr>
    <tr>
      <th>4</th>
      <td>29.50</td>
      <td>True</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>From the SEER data I selected the 16,202 cases of glioblastoma, diagnosed between 2000 and 2016, where the survival times are available.
We can use this data to infer the distribution of survival times, but first we have to deal with a statistical obstacle: some of the patients are still alive, or were alive the last time they appeared in a registry.</p>
<p>For these cases, the time until their death is unknown, which is a good thing.
However, in order to work with data like this, we need a special method, called Kaplan-Meier estimation, to compute the distribution of lifetimes.</p>
<p><code class="docutils literal notranslate"><span class="pre">duration</span></code> is the observed duration in months, for both complete and ongoing cases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">duration</span> <span class="o">=</span> <span class="n">brain</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
<span class="n">duration</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    16202.000000
mean        13.457783
std         19.088951
min          0.250000
25%          3.250000
50%          7.750000
75%         16.500000
max        201.750000
Name: duration, dtype: float64
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">observed</span></code> is a boolean that indicates whether each case is complete or ongoing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">observed</span> <span class="o">=</span> <span class="n">brain</span><span class="p">[</span><span class="s2">&quot;observed&quot;</span><span class="p">]</span>
<span class="n">observed</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>14548
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="n">observed</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="o">~</span><span class="n">observed</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.0, 0.0)
</pre></div>
</div>
</div>
</div>
<p>As we should expect, the distributions are different for the complete and ongoing cases.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">Cdf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="n">observed</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;complete&quot;</span><span class="p">)</span>
<span class="n">Cdf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">duration</span><span class="p">[</span><span class="o">~</span><span class="n">observed</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;ongoing&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6b0f83e5c87dc9c17a10b4617c81ba6ce9548856c9e603bcffdfe5967cb6a974.png" src="_images/6b0f83e5c87dc9c17a10b4617c81ba6ce9548856c9e603bcffdfe5967cb6a974.png" />
</div>
</div>
<p>With Kaplan-Meier estimation, we can use all cases to estimate the survival function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">lifelines</span>
<span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Surv</span>


<span class="k">def</span> <span class="nf">km_fit</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">observed</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute a survival function by Kaplan-Meier estimation.</span>
<span class="sd">    </span>
<span class="sd">    duration: sequence of durations for complete and incomplete cases</span>
<span class="sd">    observed: sequence booleans indicating whether each case is complete</span>
<span class="sd">    </span>
<span class="sd">    returns: tuple of Surv (estimate, low, high)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fit</span> <span class="o">=</span> <span class="n">lifelines</span><span class="o">.</span><span class="n">KaplanMeierFitter</span><span class="p">()</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">observed</span><span class="p">)</span>
    <span class="n">surv_km</span> <span class="o">=</span> <span class="n">Surv</span><span class="p">(</span><span class="n">fit</span><span class="o">.</span><span class="n">survival_function_</span><span class="p">[</span><span class="s2">&quot;KM_estimate&quot;</span><span class="p">])</span>

    <span class="n">ci_fit</span> <span class="o">=</span> <span class="n">fit</span><span class="o">.</span><span class="n">confidence_interval_</span>
    <span class="n">surv_low</span> <span class="o">=</span> <span class="n">Surv</span><span class="p">(</span><span class="n">ci_fit</span><span class="p">[</span><span class="s2">&quot;KM_estimate_lower_0.95&quot;</span><span class="p">])</span>
    <span class="n">surv_high</span> <span class="o">=</span> <span class="n">Surv</span><span class="p">(</span><span class="n">ci_fit</span><span class="p">[</span><span class="s2">&quot;KM_estimate_upper_0.95&quot;</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">surv_km</span><span class="p">,</span> <span class="n">surv_low</span><span class="p">,</span> <span class="n">surv_high</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_km</span><span class="p">,</span> <span class="n">surv_low</span><span class="p">,</span> <span class="n">surv_high</span> <span class="o">=</span> <span class="n">km_fit</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">observed</span><span class="p">)</span>
<span class="n">surv_km</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>probs</th>
    </tr>
    <tr>
      <th>timeline</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.00</th>
      <td>1.00000</td>
    </tr>
    <tr>
      <th>0.25</th>
      <td>0.97667</td>
    </tr>
    <tr>
      <th>0.50</th>
      <td>0.95130</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_fit</span><span class="p">(</span><span class="n">surv_km</span><span class="p">,</span> <span class="n">surv_low</span><span class="p">,</span> <span class="n">surv_high</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot an estimated survival curve with error bounds.</span>
<span class="sd">    </span>
<span class="sd">    surv_km: estimated Surv</span>
<span class="sd">    surv_low, surv_high: lower and upper bounds</span>
<span class="sd">    options: passed to Series.plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">surv_low</span><span class="o">.</span><span class="n">index</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">surv_low</span><span class="p">,</span> <span class="n">surv_high</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    <span class="n">surv_km</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows the result on a log scale, plotted in the familiar form of a CDF and in a new form called a survival curve.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ax1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
<span class="n">surv_km</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Survival curve&quot;</span><span class="p">)</span>
<span class="n">h1</span><span class="p">,</span> <span class="n">l1</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Survival time (months)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>

<span class="n">ax2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">cdf</span> <span class="o">=</span> <span class="n">surv_km</span><span class="o">.</span><span class="n">make_cdf</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">cdf</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;CDF&quot;</span><span class="p">)</span>
<span class="n">h2</span><span class="p">,</span> <span class="n">l2</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend_handles_labels</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">h1</span> <span class="o">+</span> <span class="n">h2</span><span class="p">,</span> <span class="n">l1</span> <span class="o">+</span> <span class="n">l2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;center right&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Percentile rank&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Survival curve and CDF for patients with glioblastoma&quot;</span><span class="p">)</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue5.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8bf23a1369a6c5b32106685863bc947c62a346d07047e96664cba3b4aec35a37.png" src="_images/8bf23a1369a6c5b32106685863bc947c62a346d07047e96664cba3b4aec35a37.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_km</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Survival curve&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="n">labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">labels</span><span class="p">);</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">,</span>
         <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Survival time (months)&quot;</span><span class="p">)</span>

<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue5a.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c0bcf207772bc314583205ad134382814553823cfb7cc5f9d140dbda3c96ebe4.png" src="_images/c0bcf207772bc314583205ad134382814553823cfb7cc5f9d140dbda3c96ebe4.png" />
</div>
</div>
<p>The survival curve shows the probability of survival past a given time on a scale from 0 to 1.
It is the complement of the CDF, so as the CDF increases from left to right, the survival curve decreases.
The two curves contain the same information; the only reason to use one or the other is convention.
Survival curves are used more often in medicine and reliability engineering, CDFs in many other fields.</p>
<p>One thing that is apparent – from either curve – is that glioblastoma is a serious diagnosis.
The median survival time after diagnosis is less than 9 months, and only about 16% of patients survive more than two years.</p>
<p>Please keep in mind that this curve lumps together people of different ages with different health conditions, diagnosed at different stages of disease over a period of about 16 years.
Survival times depend on all of these factors, so this curve does not provide a prognosis for any specific patient.
In particular, as treatment has gradually improved, the prognosis is better for someone with a more recent diagnosis.
If you or someone you know is diagnosed with glioblastoma, you should get a prognosis from a doctor, based on specifics of the case, not from aggregated data in a book demonstrating basic statistical methods.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_km</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">surv_km</span><span class="p">(</span><span class="mi">24</span><span class="p">),</span> <span class="n">surv_km</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span><span class="o">/</span><span class="n">surv_km</span><span class="p">(</span><span class="mi">12</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array(0.38549537), array(0.16368232), 0.42460256589027323)
</pre></div>
</div>
</div>
</div>
<p>As we did with light bulbs and pregnancy lengths, we can use this distribution to compute the average remaining survival time for patients at each time after diagnosis.
The following figure shows the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">remaining_lifetimes_pmf</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">165</span><span class="p">,</span> <span class="mi">101</span><span class="p">)</span>
<span class="n">rem_seq</span> <span class="o">=</span> <span class="p">[]</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">101</span><span class="p">):</span>
    <span class="n">sample</span> <span class="o">=</span> <span class="n">brain</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">observed</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;observed&quot;</span><span class="p">]</span>
    <span class="n">duration</span> <span class="o">=</span> <span class="n">sample</span><span class="p">[</span><span class="s2">&quot;duration&quot;</span><span class="p">]</span>
    <span class="n">surv_km</span><span class="p">,</span> <span class="n">surv_high</span><span class="p">,</span> <span class="n">surv_low</span> <span class="o">=</span> <span class="n">km_fit</span><span class="p">(</span><span class="n">duration</span><span class="p">,</span> <span class="n">observed</span><span class="p">)</span>
    <span class="n">rem</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">surv_km</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">(),</span> <span class="n">qs</span><span class="p">)</span>
    <span class="c1"># rem.plot(color=&quot;gray&quot;, alpha=0.01)</span>
    <span class="n">rem_seq</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rem</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gray_box</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_max</span><span class="o">=</span><span class="mi">170</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a gray box that spans the y-axis.</span>

<span class="sd">    x_max: location of the right bound</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvspan</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">([</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x_max</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_percentiles</span><span class="p">(</span><span class="n">rem_seq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>
<span class="n">gray_box</span><span class="p">(</span><span class="mi">125</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">14</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">60</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time since diagnosis (months)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining survival&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average remaining survival for patients with glioblastoma&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue6.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3ebef59ca22c885aac9c7ca6d5e75aea5cff56684de26a9c2be7fe6dc0602a32.png" src="_images/3ebef59ca22c885aac9c7ca6d5e75aea5cff56684de26a9c2be7fe6dc0602a32.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">165</span><span class="p">)</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">surv_km</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">(),</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">milestones</span> <span class="o">=</span> <span class="n">series</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">60</span><span class="p">]]</span>
<span class="n">milestones</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     13.773990
14    17.069424
32    24.735119
60    27.839032
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.05</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">]</span>
<span class="n">xs</span><span class="p">,</span> <span class="n">rows</span> <span class="o">=</span> <span class="n">percentile_rows</span><span class="p">(</span><span class="n">rem_seq</span><span class="p">,</span> <span class="n">ps</span><span class="p">)</span>
<span class="n">low</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">rows</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">letter</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="s1">&#39;abcd&#39;</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">med</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.7</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">)</span>
    <span class="n">gray_box</span><span class="p">(</span><span class="mi">125</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">milestones</span><span class="o">.</span><span class="n">cumsum</span><span class="p">()[:</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="n">decorate</span><span class="p">(</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time since diagnosis (months)&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining survival&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">savefig</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;nbue6</span><span class="si">{</span><span class="n">letter</span><span class="si">}</span><span class="s1">.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>13.773989705091937
13.773989705091937
30.843413403818417
13.773989705091937
30.843413403818417
55.578532081470954
13.773989705091937
30.843413403818417
55.578532081470954
83.41756386272576
</pre></div>
</div>
<img alt="_images/9153ea24047b9ca4ee8696e43c0d12f26771b5ce3fcfba2a2be53f5b37c30acf.png" src="_images/9153ea24047b9ca4ee8696e43c0d12f26771b5ce3fcfba2a2be53f5b37c30acf.png" />
<img alt="_images/8a43dcb912b41212a0c47e407285749ac1912456b1a53e49c5fb8d49a956ba78.png" src="_images/8a43dcb912b41212a0c47e407285749ac1912456b1a53e49c5fb8d49a956ba78.png" />
<img alt="_images/bb45c316723b184ce2ce9f606ec570612a205d2d5f312ba082e47d41b27ceb5a.png" src="_images/bb45c316723b184ce2ce9f606ec570612a205d2d5f312ba082e47d41b27ceb5a.png" />
<img alt="_images/2a58667589f577994919f297b9d5ffb4480397db6f119ba06c331c86c1219b0b.png" src="_images/2a58667589f577994919f297b9d5ffb4480397db6f119ba06c331c86c1219b0b.png" />
</div>
</div>
<p>At the time of diagnosis, the average survival time is about 14 months.
That is certainly a bleak prognosis, but there is some good news to follow.
If a patient survives the first 14 months, we expect them to survive another 18 months, on average.
If they survive those 18 months, for a total of 32, we expect them to survive another 28 months.
And if they survive those 28 months, for a total of 60 months (five years), we expect them to survive another 35 months (almost three years).
The vertical lines indicate these milestones.
It’s like running a race where the finish line keeps moving, and the farther you go, the faster it retreats.</p>
<p>If you hear that the average survival time after diagnosis is 14 months, you might imagine a Gaussian distribution where 14 months is the most common value and an equal number of patients live more or less than 14 months.
But that would be a very misleading picture.</p>
<p>To show how bad it would be, I chose a Gaussian distribution that matches the distribution of survival times as well as possible – which is not very well – and used it to compute average remaining survival times.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">make_normal_model</span>

<span class="n">pmf_km</span> <span class="o">=</span> <span class="n">surv_km</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
<span class="n">pmf_normal</span> <span class="o">=</span> <span class="n">make_normal_model</span><span class="p">(</span><span class="n">pmf_km</span><span class="p">)</span>

<span class="n">pmf_km</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;data&#39;</span><span class="p">)</span>
<span class="n">pmf_normal</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;model&#39;</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time since diagnosis (months)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;PMF&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;The normal model does not fit the data&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/bbd14011adea96b830de2feead3b8180a821a098cdfeb55c089b11049d5b11c0.png" src="_images/bbd14011adea96b830de2feead3b8180a821a098cdfeb55c089b11049d5b11c0.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf_normal</span><span class="p">)</span>
<span class="n">series</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>197.694724    0.972382
198.708543    0.829894
199.722362    0.630459
200.736181    0.358620
201.750000    0.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>As a result, the remaining lifetimes from the model don’t resemble the remaining lifetimes from the data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_percentiles</span><span class="p">(</span><span class="n">rem_seq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual data&quot;</span><span class="p">)</span>
<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Gaussian model&quot;</span><span class="p">)</span>

<span class="n">gray_box</span><span class="p">(</span><span class="mi">125</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time since diagnosis (months)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining time&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average remaining time compared to Gaussian model&quot;</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16e98206aa29ce37968b4c3e5fd15535b256ccc060e219843df09534334249ba.png" src="_images/16e98206aa29ce37968b4c3e5fd15535b256ccc060e219843df09534334249ba.png" />
</div>
</div>
<p>With the Gaussian model, the average remaining survival time starts around 20 months,
drops quickly at first, and levels off around 5 months.
So it behaves nothing like the actual averages.</p>
<p>On the other hand, if your mental model of the distribution is lognormal, you would get it about right.
To demonstrate, I chose a lognormal distribution that fits the actual distribution of survival times and used it to compute average remaining lifetimes.</p>
<p>Here’s the function that fits the distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">least_squares</span>


<span class="k">def</span> <span class="nf">fit_lognormal</span><span class="p">(</span><span class="n">surv</span><span class="p">,</span> <span class="n">xs</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fit a lognormal distribution to a survival function.</span>
<span class="sd">    </span>
<span class="sd">    surv: Surv object</span>
<span class="sd">    xs: places to evaluate the survival function</span>
<span class="sd">    </span>
<span class="sd">    returns: Surv</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">error_func</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">params</span>
        <span class="c1"># just fit over the range from 0 to 120 months</span>
        <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">120</span><span class="p">))</span>

        <span class="n">ps</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
        <span class="n">error</span> <span class="o">=</span> <span class="n">ps</span> <span class="o">-</span> <span class="n">surv_km</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">error</span>

    <span class="n">pmf</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
    <span class="n">pmf</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="n">params</span> <span class="o">=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pmf</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">error_func</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>

    <span class="n">xs</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">index</span> <span class="k">if</span> <span class="n">xs</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">xs</span>
    <span class="n">ps</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">xs</span><span class="p">),</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">Surv</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_lognormal</span> <span class="o">=</span> <span class="n">fit_lognormal</span><span class="p">(</span><span class="n">surv_km</span><span class="p">)</span>
<span class="n">pmf_lognormal</span> <span class="o">=</span> <span class="n">surv_lognormal</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf_lognormal</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows the result.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_percentiles</span><span class="p">(</span><span class="n">rem_seq</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Actual data&quot;</span><span class="p">)</span>
<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lognormal model&quot;</span><span class="p">)</span>
<span class="n">gray_box</span><span class="p">(</span><span class="mi">125</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Time since diagnosis (months)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining time&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average remaining time compared to lognormal model&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower left&quot;</span><span class="p">)</span>
<span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b1e53c8f4543517b82cd621207b60128438c3de30e1ec8bd799ab3c4c7e46daf.png" src="_images/b1e53c8f4543517b82cd621207b60128438c3de30e1ec8bd799ab3c4c7e46daf.png" />
</div>
</div>
<p>During the first 24 months, the model is a little too optimistic, and after 120 months it is much too optimistic.
But the lognormal model gets the shape of the curve right: if your mental model of the distribution is lognormal, you would have a reasonably accurate understanding of the situation.</p>
</section>
<section id="life-expectancy-at-birth">
<h2>Life Expectancy At Birth<a class="headerlink" href="#life-expectancy-at-birth" title="Permalink to this heading">#</a></h2>
<p>In 2012, a team of demographers at the University of Southern California estimated life expectancy for people born in Sweden in the early 1800s and 1900s.
They chose Sweden because it “has the deepest historical record of high-quality [demographic] data.”</p>
<p>For ages from 0 to 91 years, they estimated the mortality rate, which is the fraction of people at each age who die.</p>
<p>I used an online graph digitizer to get the data from the figure in their paper and store it in a CSV file.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;mortality_rates_beltran2012.csv&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mortality</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
<span class="n">mortality</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">1905</th>
      <th colspan="2" halign="left">1800</th>
    </tr>
    <tr>
      <th></th>
      <th>X</th>
      <th>Y</th>
      <th>X</th>
      <th>Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.056633</td>
      <td>-2.685744</td>
      <td>0.066515</td>
      <td>-1.541222</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.175223</td>
      <td>-2.866213</td>
      <td>0.224635</td>
      <td>-1.692583</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.293812</td>
      <td>-3.043189</td>
      <td>0.362990</td>
      <td>-1.890516</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.412402</td>
      <td>-3.216672</td>
      <td>0.481580</td>
      <td>-2.052938</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.530992</td>
      <td>-3.390155</td>
      <td>0.623887</td>
      <td>-2.239811</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_series</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a pandas Series.</span>
<span class="sd">    </span>
<span class="sd">    x: values for the index</span>
<span class="sd">    y: values of the series</span>
<span class="sd">    </span>
<span class="sd">    returns: Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mort1800</span> <span class="o">=</span> <span class="n">make_series</span><span class="p">(</span><span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;1800&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">],</span> <span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;1800&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">mort1800</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1800, X)
0.066515   -1.541222
0.224635   -1.692583
0.362990   -1.890516
0.481580   -2.052938
0.623887   -2.239811
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mort1905</span> <span class="o">=</span> <span class="n">make_series</span><span class="p">(</span><span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;1905&quot;</span><span class="p">,</span> <span class="s2">&quot;X&quot;</span><span class="p">],</span> <span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;1905&quot;</span><span class="p">,</span> <span class="s2">&quot;Y&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">mort1905</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1905, X)
0.056633   -2.685744
0.175223   -2.866213
0.293812   -3.043189
0.412402   -3.216672
0.530992   -3.390155
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mort1800</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mort1905</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.21411938757305218, 0.06817045483264002)
</pre></div>
</div>
</div>
</div>
<p>The following function interpolates the data from the figure and puts it in a Hazard function.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>
<span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Hazard</span>


<span class="k">def</span> <span class="nf">make_hazard</span><span class="p">(</span><span class="n">series</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a Hazard function by interpolating a Series.</span>
<span class="sd">    </span>
<span class="sd">    series: Series</span>
<span class="sd">    </span>
<span class="sd">    returns: Hazard</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">108</span><span class="p">)</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">interp</span><span class="p">(</span><span class="n">xs</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">Hazard</span><span class="p">(</span><span class="n">ys</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">haz1800</span> <span class="o">=</span> <span class="n">make_hazard</span><span class="p">(</span><span class="n">mort1800</span><span class="p">)</span>
<span class="n">haz1905</span> <span class="o">=</span> <span class="n">make_hazard</span><span class="p">(</span><span class="n">mort1905</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows the results for two cohorts: people born between 1800 and 1810, and people born between 1905 and 1915.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">haz1800</span><span class="p">[:</span><span class="mi">91</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Born 1800–1810&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">haz1905</span><span class="p">[:</span><span class="mi">91</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Born 1905–1915&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Mortality rate&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Historic mortality rates in Sweden&quot;</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue7.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3732e4da66ac3d3ea34fa526fad8b28816c097f28b21fd3d3512db2651cc5d22.png" src="_images/3732e4da66ac3d3ea34fa526fad8b28816c097f28b21fd3d3512db2651cc5d22.png" />
</div>
</div>
<p>The notable feature is that mortality rates were lower for the later cohort at every age.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">haz1800</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">haz1905</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.2281961996457684, 0.07430619990025686)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">haz1800</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">haz1800</span><span class="o">.</span><span class="n">idxmin</span><span class="p">(),</span> <span class="n">haz1905</span><span class="p">[</span><span class="mi">14</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.004624153294009557, 14, 0.0019040788545011136)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">haz1800</span><span class="p">[</span><span class="mi">80</span><span class="p">],</span> <span class="n">haz1905</span><span class="p">[</span><span class="mi">80</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.13156208289057392, 0.06441158462898641)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf1800</span> <span class="o">=</span> <span class="n">haz1800</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
<span class="n">pmf1800</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999999998644409
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf1905</span> <span class="o">=</span> <span class="n">haz1905</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
<span class="n">pmf1905</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9999711879585407
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf1800</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pmf1905</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(36.473535530889244, 65.67277539967878)
</pre></div>
</div>
</div>
</div>
<p>The following figure shows life expectancy as a function of age for people born in Sweden around 1800 and 1905.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
<span class="n">series1905</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf1905</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">series1905</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 1905&quot;</span><span class="p">)</span>

<span class="n">series1800</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf1800</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">series1800</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 1800&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining lifetime&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Remaining lifetime vs age&quot;</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue8a.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8c48209c115cda78a6716161ae2abf9093933ff5265a1dc22cff22f305b95258.png" src="_images/8c48209c115cda78a6716161ae2abf9093933ff5265a1dc22cff22f305b95258.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">draw_lines</span><span class="p">(</span><span class="n">pmf</span><span class="p">,</span> <span class="n">series</span><span class="p">):</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">pmf</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">series</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">))]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">91</span><span class="p">)</span>
<span class="n">series1905</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf1905</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">draw_lines</span><span class="p">(</span><span class="n">pmf1905</span><span class="p">,</span> <span class="n">series1905</span><span class="p">)</span>
<span class="n">series1905</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 1905&quot;</span><span class="p">)</span>

<span class="n">series1800</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf1800</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">draw_lines</span><span class="p">(</span><span class="n">pmf1800</span><span class="p">,</span> <span class="n">series1800</span><span class="p">)</span>
<span class="n">series1800</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 1800&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining lifetime&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Remaining lifetime vs age&quot;</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue8b.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c7a018f88467823657db8e6fa0b8ff307ebc016c8fe520a61fb2729cfa59ecac.png" src="_images/c7a018f88467823657db8e6fa0b8ff307ebc016c8fe520a61fb2729cfa59ecac.png" />
</div>
</div>
<p>In both cohorts, used was better than new, at least for the first few years of life.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series1800</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">series1800</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">series1800</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(36.473535530889244, 5, 49.9171982587444)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series1905</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">series1905</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">series1905</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(65.67277539967881, 2, 70.18860681489375)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series1800</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">series1800</span><span class="p">[</span><span class="mi">36</span><span class="p">],</span> <span class="n">series1800</span><span class="p">[</span><span class="mi">65</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(36.473535530889244, 29.241600197695945, 11.018435234417836)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series1905</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>68.80456362586426
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series1905</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">series1905</span><span class="p">[</span><span class="mi">66</span><span class="p">],</span> <span class="n">series1905</span><span class="p">[</span><span class="mi">82</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(65.67277539967881, 16.058634133594552, 6.471530454841982)
</pre></div>
</div>
</div>
</div>
</section>
<section id="child-mortality">
<h2>Child mortality<a class="headerlink" href="#child-mortality" title="Permalink to this heading">#</a></h2>
<p>The following figure shows the percentage of children who die before age 5 for four geographical regions, from 1900 to 2019.
These data were combined from several sources by Gapminder, a foundation based in Sweden that “promotes sustainable global development […] by increased use and understanding of statistics.”</p>
<p>Documentation of the data is at <a class="reference external" href="https://www.gapminder.org/data/documentation/gd005">https://www.gapminder.org/data/documentation/gd005</a></p>
<p>The data is in <a class="reference external" href="https://docs.google.com/spreadsheets/d/1Av7eps_zEK73-AdbFYEmtTrwFKlfruBYXdrnXAOFVpM/edit#gid=501532268">this online spreadsheet</a>, which I downloaded in August 2022.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;GM-ChildMortality-Dataset-v11.xlsx&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gm</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;data-for-regions-by-year&quot;</span><span class="p">)</span>
<span class="n">gm</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>geo</th>
      <th>name</th>
      <th>time</th>
      <th>Child mortality</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1199</th>
      <td>americas</td>
      <td>The Americas</td>
      <td>2096</td>
      <td>2.70</td>
    </tr>
    <tr>
      <th>1200</th>
      <td>americas</td>
      <td>The Americas</td>
      <td>2097</td>
      <td>2.67</td>
    </tr>
    <tr>
      <th>1201</th>
      <td>americas</td>
      <td>The Americas</td>
      <td>2098</td>
      <td>2.63</td>
    </tr>
    <tr>
      <th>1202</th>
      <td>americas</td>
      <td>The Americas</td>
      <td>2099</td>
      <td>2.60</td>
    </tr>
    <tr>
      <th>1203</th>
      <td>americas</td>
      <td>The Americas</td>
      <td>2100</td>
      <td>2.59</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">grouped</span> <span class="o">=</span> <span class="n">gm</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;geo&quot;</span><span class="p">)</span>
<span class="n">line_styles</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;africa&quot;</span><span class="p">:</span> <span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="s2">&quot;asia&quot;</span><span class="p">:</span> <span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;americas&quot;</span><span class="p">:</span> <span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="s2">&quot;europe&quot;</span><span class="p">:</span> <span class="s2">&quot;-.&quot;</span><span class="p">}</span>

<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1918</span><span class="p">,</span> <span class="mi">1942</span><span class="p">,</span> <span class="mi">1960</span><span class="p">]:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;africa&quot;</span><span class="p">,</span> <span class="s2">&quot;asia&quot;</span><span class="p">,</span> <span class="s2">&quot;americas&quot;</span><span class="p">,</span> <span class="s2">&quot;europe&quot;</span><span class="p">]:</span>
    <span class="n">group</span> <span class="o">=</span> <span class="n">grouped</span><span class="o">.</span><span class="n">get_group</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="s2">&quot;Child mortality&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="mi">10</span><span class="p">,</span> <span class="n">group</span><span class="p">[</span><span class="s2">&quot;time&quot;</span><span class="p">])</span>
    <span class="n">series</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1900</span><span class="p">:</span><span class="mi">2019</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="n">name</span><span class="o">.</span><span class="n">title</span><span class="p">(),</span> <span class="n">ls</span><span class="o">=</span><span class="n">line_styles</span><span class="p">[</span><span class="n">name</span><span class="p">])</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent who die before age 5&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Child mortality by region&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1e6745df0790d08aa5010eaba965b2b778fdcdd289d64ba50504f7b39ec68974.png" src="_images/1e6745df0790d08aa5010eaba965b2b778fdcdd289d64ba50504f7b39ec68974.png" />
</div>
</div>
<p>In every region, child mortality has decreased consistently and substantially.</p>
<p>I collected recent mortality data from the <a class="reference external" href="https://apps.who.int/gho/data/node.main.LIFECOUNTRY?lang=en">Global Health Observatory</a> of the World Health Organization (WHO).
For people born in 2019, we don’t know what their future lifetimes will be, but we can estimate it if we assume that the mortality rate in each age group will not change over their lifetimes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">read_hazard</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Read age-specific death rates and make a Hazard object.</span>

<span class="sd">    filename: string</span>

<span class="sd">    returns: Hazard</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

    <span class="n">query</span> <span class="o">=</span> <span class="s1">&#39;Indicator == &quot;nMx - age-specific death rate between ages x and x+n&quot;&#39;</span>
    <span class="n">nmx</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">query</span><span class="p">)</span>

    <span class="n">index</span> <span class="o">=</span> <span class="n">nmx</span><span class="p">[</span><span class="s2">&quot;Age Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">ages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
    <span class="n">age_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
    <span class="n">age_series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>

    <span class="n">rate</span> <span class="o">=</span> <span class="n">nmx</span><span class="p">[</span><span class="s2">&quot;Both sexes&quot;</span><span class="p">]</span>
    <span class="n">rate</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">age_series</span><span class="o">.</span><span class="n">values</span>
    <span class="n">hazard</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">111</span><span class="p">))</span><span class="o">.</span><span class="n">ffill</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">Hazard</span><span class="p">(</span><span class="n">hazard</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="s2">&quot;life_table_sweden_2019.csv&quot;</span><span class="p">)</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="s2">&quot;life_table_nigeria_2019.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;life_table_sweden_2019.csv&quot;</span>
<span class="n">hazard</span> <span class="o">=</span> <span class="n">read_hazard</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

<span class="n">pmf_swe</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
<span class="n">pmf_swe</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">pmf_swe</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>81.6599453119953
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;../data/life_table_nigeria_2019.csv&quot;</span>
<span class="n">hazard</span> <span class="o">=</span> <span class="n">read_hazard</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">hazard</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>probs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.077958</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.011613</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.011613</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_nga</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
<span class="n">pmf_nga</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
<span class="n">pmf_nga</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>61.59620754538476
</pre></div>
</div>
</div>
</div>
<p>Based on that simplification, the following figure shows average remaining lifetime as a function of age for Sweden and Nigeria in 2019, compared to Sweden in 1905.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rem_swe</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf_swe</span><span class="p">)</span>
<span class="n">rem_nga</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">pmf_nga</span><span class="p">)</span>
<span class="n">rem_swe</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>81.6599453119953
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rem_swe</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">91</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 2019&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>
<span class="n">series1905</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 1905&quot;</span><span class="p">)</span>
<span class="n">rem_nga</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">91</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Nigeria 2019&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining lifetime&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average remaining lifetime vs age&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1dff0920a360a8345361b10fd442826c34aaac7d6d33df19d6b60c32afb8db47.png" src="_images/1dff0920a360a8345361b10fd442826c34aaac7d6d33df19d6b60c32afb8db47.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rem_swe</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">91</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 2019&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">)</span>

<span class="n">series1905</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 1905&quot;</span><span class="p">)</span>

<span class="n">series1800</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Sweden 1800&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining lifetime&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Remaining lifetime vs age&quot;</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue9.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/16397d5e9e73bcee272b3b9d7f0ccc44637e06b9b50982b18cf0e687433f5b16.png" src="_images/16397d5e9e73bcee272b3b9d7f0ccc44637e06b9b50982b18cf0e687433f5b16.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rem_nga</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.000000    61.596208
0.552764    66.256747
1.105528    66.478013
1.658291    65.925249
2.211055    66.143866
dtype: float64
</pre></div>
</div>
</div>
</div>
</section>
<section id="the-immortal-swede">
<h2>The Immortal Swede<a class="headerlink" href="#the-immortal-swede" title="Permalink to this heading">#</a></h2>
<p>Going back to the data from Sweden, the following figure shows the mortality rate for each age group, updated every ten years from 2000 to 2019.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="s2">&quot;life_table_sweden.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Indicator&quot;</span><span class="p">,</span> <span class="s2">&quot;Age Group&quot;</span><span class="p">,</span> <span class="mi">2019</span><span class="p">,</span> <span class="mi">2015</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2005</span><span class="p">,</span> <span class="mi">2000</span><span class="p">]</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;life_table_sweden.csv&quot;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Indicator</th>
      <th>Age Group</th>
      <th>2019</th>
      <th>2015</th>
      <th>2010</th>
      <th>2005</th>
      <th>2000</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>nMx - age-specific death rate between ages x a...</td>
      <td>&lt;1 year</td>
      <td>0.002042</td>
      <td>0.002452</td>
      <td>0.002579</td>
      <td>0.002448</td>
      <td>0.003451</td>
    </tr>
    <tr>
      <th>1</th>
      <td>nMx - age-specific death rate between ages x a...</td>
      <td>1-4 years</td>
      <td>0.000121</td>
      <td>0.000127</td>
      <td>0.000150</td>
      <td>0.000211</td>
      <td>0.000123</td>
    </tr>
    <tr>
      <th>2</th>
      <td>nMx - age-specific death rate between ages x a...</td>
      <td>5-9 years</td>
      <td>0.000061</td>
      <td>0.000068</td>
      <td>0.000063</td>
      <td>0.000102</td>
      <td>0.000097</td>
    </tr>
    <tr>
      <th>3</th>
      <td>nMx - age-specific death rate between ages x a...</td>
      <td>10-14 years</td>
      <td>0.000081</td>
      <td>0.000110</td>
      <td>0.000090</td>
      <td>0.000101</td>
      <td>0.000134</td>
    </tr>
    <tr>
      <th>4</th>
      <td>nMx - age-specific death rate between ages x a...</td>
      <td>15-19  years</td>
      <td>0.000217</td>
      <td>0.000230</td>
      <td>0.000271</td>
      <td>0.000262</td>
      <td>0.000355</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Age Group&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">ages</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">90</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">age_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ages</span><span class="p">,</span> <span class="n">index</span><span class="p">)</span>
<span class="n">age_series</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">age_series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;1 year          0
1-4 years        1
5-9 years        5
10-14 years     10
15-19  years    15
20-24 years     20
25-29 years     25
30-34 years     30
35-39 years     35
40-44 years     40
45-49 years     45
50-54 years     50
55-59 years     55
60-64 years     60
65-69 years     65
70-74 years     70
75-79 years     75
80-84 years     80
85+ years       85
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Indicator&quot;</span><span class="p">,</span> <span class="s2">&quot;Age Group&quot;</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">age_series</span><span class="o">.</span><span class="n">values</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>2019</th>
      <th>2015</th>
      <th>2010</th>
      <th>2005</th>
      <th>2000</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.002042</td>
      <td>0.002452</td>
      <td>0.002579</td>
      <td>0.002448</td>
      <td>0.003451</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.000121</td>
      <td>0.000127</td>
      <td>0.000150</td>
      <td>0.000211</td>
      <td>0.000123</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0.000061</td>
      <td>0.000068</td>
      <td>0.000063</td>
      <td>0.000102</td>
      <td>0.000097</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0.000081</td>
      <td>0.000110</td>
      <td>0.000090</td>
      <td>0.000101</td>
      <td>0.000134</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.000217</td>
      <td>0.000230</td>
      <td>0.000271</td>
      <td>0.000262</td>
      <td>0.000355</td>
    </tr>
    <tr>
      <th>20</th>
      <td>0.000407</td>
      <td>0.000457</td>
      <td>0.000458</td>
      <td>0.000472</td>
      <td>0.000511</td>
    </tr>
    <tr>
      <th>25</th>
      <td>0.000549</td>
      <td>0.000575</td>
      <td>0.000498</td>
      <td>0.000500</td>
      <td>0.000499</td>
    </tr>
    <tr>
      <th>30</th>
      <td>0.000598</td>
      <td>0.000563</td>
      <td>0.000505</td>
      <td>0.000498</td>
      <td>0.000524</td>
    </tr>
    <tr>
      <th>35</th>
      <td>0.000631</td>
      <td>0.000604</td>
      <td>0.000570</td>
      <td>0.000710</td>
      <td>0.000827</td>
    </tr>
    <tr>
      <th>40</th>
      <td>0.000836</td>
      <td>0.000860</td>
      <td>0.000916</td>
      <td>0.001102</td>
      <td>0.001240</td>
    </tr>
    <tr>
      <th>45</th>
      <td>0.001285</td>
      <td>0.001348</td>
      <td>0.001581</td>
      <td>0.001838</td>
      <td>0.002161</td>
    </tr>
    <tr>
      <th>50</th>
      <td>0.002087</td>
      <td>0.002457</td>
      <td>0.002690</td>
      <td>0.003153</td>
      <td>0.003394</td>
    </tr>
    <tr>
      <th>55</th>
      <td>0.003508</td>
      <td>0.004089</td>
      <td>0.004410</td>
      <td>0.005092</td>
      <td>0.005415</td>
    </tr>
    <tr>
      <th>60</th>
      <td>0.006164</td>
      <td>0.006585</td>
      <td>0.007485</td>
      <td>0.007953</td>
      <td>0.008854</td>
    </tr>
    <tr>
      <th>65</th>
      <td>0.010054</td>
      <td>0.010798</td>
      <td>0.011625</td>
      <td>0.013320</td>
      <td>0.014281</td>
    </tr>
    <tr>
      <th>70</th>
      <td>0.016627</td>
      <td>0.018914</td>
      <td>0.019199</td>
      <td>0.021721</td>
      <td>0.024041</td>
    </tr>
    <tr>
      <th>75</th>
      <td>0.028767</td>
      <td>0.031977</td>
      <td>0.034546</td>
      <td>0.037426</td>
      <td>0.041425</td>
    </tr>
    <tr>
      <th>80</th>
      <td>0.053991</td>
      <td>0.058500</td>
      <td>0.062250</td>
      <td>0.068268</td>
      <td>0.074020</td>
    </tr>
    <tr>
      <th>85</th>
      <td>0.156954</td>
      <td>0.156715</td>
      <td>0.156301</td>
      <td>0.161742</td>
      <td>0.167294</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">Re70</span><span class="p">,</span> <span class="n">Or70</span><span class="p">,</span> <span class="n">Gr60</span><span class="p">,</span> <span class="n">Bl50</span><span class="p">,</span> <span class="n">Pu40</span>


<span class="k">def</span> <span class="nf">plot_mortality</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot columns from a mortality DataFrame.</span>
<span class="sd">    </span>
<span class="sd">    df: DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">df</span><span class="p">[</span><span class="mi">2000</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;x-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Re70</span><span class="p">)</span>
    <span class="c1"># df[2005].plot(lw=1, ms=4, style=&quot;^--&quot;, color=Or70)</span>
    <span class="n">df</span><span class="p">[</span><span class="mi">2010</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;s--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Gr60</span><span class="p">)</span>
    <span class="c1"># df[2015].plot(lw=1, ms=4, style=&quot;*--&quot;, color=Bl50)</span>
    <span class="n">df</span><span class="p">[</span><span class="mi">2019</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;o-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Pu40</span><span class="p">)</span>

    <span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Mortality rate&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_mortality</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1/10&quot;</span><span class="p">,</span> <span class="s2">&quot;1/100&quot;</span><span class="p">,</span> <span class="s2">&quot;1/1000&quot;</span><span class="p">,</span> <span class="s2">&quot;1/10000&quot;</span><span class="p">]</span>
<span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>
<span class="c1">#decorate(title=&quot;Mortality rates in Sweden&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue10.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/60170c391c9f7b6471352b4972f4147298e6f963857a2dc168895747738e22b2.png" src="_images/60170c391c9f7b6471352b4972f4147298e6f963857a2dc168895747738e22b2.png" />
</div>
</div>
<p>The straight-line increase after age 35 was described by Benjamin Gompertz in 1825, so this phenomenon is called the Gompertz Law.
It is an empirical law, which is to say that it names a pattern we see in nature, but at this point we don’t have an explanation of why it’s true, or whether it is certain to be true in the future.
Nevertheless, the data in this example fall in a remarkably straight line.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">50</span><span class="p">],</span> <span class="mi">2019</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0     0.204202
50    0.208688
Name: 2019, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">85</span><span class="p">],</span> <span class="mi">2019</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10     0.008100
40     0.083590
65     1.005406
85    15.695439
Name: 2019, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The previous figure also shows that mortality rates decreased between 2000 and 2019 in almost every age group.
If we zoom in on the age range from 40 to 80, we can see the changes in adult mortality more clearly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">40</span><span class="p">:</span><span class="mi">80</span><span class="p">]</span>
<span class="n">plot_mortality</span><span class="p">(</span><span class="n">subset</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">add_yticks</span><span class="p">():</span>
    <span class="n">labels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;1/10&quot;</span><span class="p">,</span> <span class="s2">&quot;3/100&quot;</span><span class="p">,</span> <span class="s2">&quot;1/100&quot;</span><span class="p">,</span> <span class="s2">&quot;3/1000&quot;</span><span class="p">,</span> <span class="s2">&quot;1/1000&quot;</span><span class="p">]</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1e-1</span><span class="p">,</span> <span class="mf">3e-2</span><span class="p">,</span> <span class="mf">1e-2</span><span class="p">,</span> <span class="mf">3e-3</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">ticks</span><span class="p">,</span> <span class="n">labels</span><span class="p">)</span>


<span class="n">add_yticks</span><span class="p">()</span>
<span class="c1">#decorate(title=&quot;Mortality rates for adults in Sweden&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue11.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/17d939d3b988c341b78ce0fc9437c7fc12cfa8ffb7b3548b4478ecf94499ecd2.png" src="_images/17d939d3b988c341b78ce0fc9437c7fc12cfa8ffb7b3548b4478ecf94499ecd2.png" />
</div>
</div>
<p>In these age groups, the decreases in mortality have been remarkably consistent.
By fitting a model to this data, we can estimate the rate of change as a function of both age and time.
According to the model, as you move from one age group to the next, your mortality rate increases by about 11% per year.
At the same time, for the reasons I just mentioned, the mortality rate in every age group decreases by about 2% per year.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">,</span> <span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="s2">&quot;rate&quot;</span><span class="p">]</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;log_rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>age</th>
      <th>year</th>
      <th>rate</th>
      <th>log_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>40</td>
      <td>2019</td>
      <td>0.000836</td>
      <td>-3.077846</td>
    </tr>
    <tr>
      <th>1</th>
      <td>40</td>
      <td>2015</td>
      <td>0.000860</td>
      <td>-3.065354</td>
    </tr>
    <tr>
      <th>2</th>
      <td>40</td>
      <td>2010</td>
      <td>0.000916</td>
      <td>-3.038094</td>
    </tr>
    <tr>
      <th>3</th>
      <td>40</td>
      <td>2005</td>
      <td>0.001102</td>
      <td>-2.957944</td>
    </tr>
    <tr>
      <th>4</th>
      <td>40</td>
      <td>2000</td>
      <td>0.001240</td>
      <td>-2.906429</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">statsmodels.formula.api</span> <span class="k">as</span> <span class="nn">smf</span>

<span class="n">formula</span> <span class="o">=</span> <span class="s2">&quot;log_rate ~ age + year&quot;</span>

<span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">results</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><table class="simpletable">
<caption>OLS Regression Results</caption>
<tr>
  <th>Dep. Variable:</th>        <td>log_rate</td>     <th>  R-squared:         </th> <td>   0.999</td> 
</tr>
<tr>
  <th>Model:</th>                   <td>OLS</td>       <th>  Adj. R-squared:    </th> <td>   0.999</td> 
</tr>
<tr>
  <th>Method:</th>             <td>Least Squares</td>  <th>  F-statistic:       </th> <td>1.581e+04</td>
</tr>
<tr>
  <th>Date:</th>             <td>Sun, 18 Feb 2024</td> <th>  Prob (F-statistic):</th> <td>3.78e-61</td> 
</tr>
<tr>
  <th>Time:</th>                 <td>17:29:03</td>     <th>  Log-Likelihood:    </th> <td>  109.74</td> 
</tr>
<tr>
  <th>No. Observations:</th>      <td>    45</td>      <th>  AIC:               </th> <td>  -213.5</td> 
</tr>
<tr>
  <th>Df Residuals:</th>          <td>    42</td>      <th>  BIC:               </th> <td>  -208.1</td> 
</tr>
<tr>
  <th>Df Model:</th>              <td>     2</td>      <th>                     </th>     <td> </td>    
</tr>
<tr>
  <th>Covariance Type:</th>      <td>nonrobust</td>    <th>                     </th>     <td> </td>    
</tr>
</table>
<table class="simpletable">
<tr>
      <td></td>         <th>coef</th>     <th>std err</th>      <th>t</th>      <th>P>|t|</th>  <th>[0.025</th>    <th>0.975]</th>  
</tr>
<tr>
  <th>Intercept</th> <td>   13.5134</td> <td>    0.964</td> <td>   14.017</td> <td> 0.000</td> <td>   11.568</td> <td>   15.459</td>
</tr>
<tr>
  <th>age</th>       <td>    0.0446</td> <td>    0.000</td> <td>  176.799</td> <td> 0.000</td> <td>    0.044</td> <td>    0.045</td>
</tr>
<tr>
  <th>year</th>      <td>   -0.0091</td> <td>    0.000</td> <td>  -19.003</td> <td> 0.000</td> <td>   -0.010</td> <td>   -0.008</td>
</tr>
</table>
<table class="simpletable">
<tr>
  <th>Omnibus:</th>       <td> 2.326</td> <th>  Durbin-Watson:     </th> <td>   1.177</td>
</tr>
<tr>
  <th>Prob(Omnibus):</th> <td> 0.313</td> <th>  Jarque-Bera (JB):  </th> <td>   2.195</td>
</tr>
<tr>
  <th>Skew:</th>          <td> 0.507</td> <th>  Prob(JB):          </th> <td>   0.334</td>
</tr>
<tr>
  <th>Kurtosis:</th>      <td> 2.623</td> <th>  Cond. No.          </th> <td>5.95e+05</td>
</tr>
</table><br/><br/>Notes:<br/>[1] Standard Errors assume that the covariance matrix of the errors is correctly specified.<br/>[2] The condition number is large, 5.95e+05. This might indicate that there are<br/>strong multicollinearity or other numerical problems.</div></div>
</div>
<p>These results imply that the life expectancies we computed in the previous section are too pessimistic because they take into account only the first effect – the increase with age – and not the second – the decrease over time.
So let’s see what happens if we include the second effect as well, that is, if we assume that mortality rates will continue to decrease.</p>
<p>The following figure shows the actual mortality rates for 2000 and 2019 again, along with predictions for 2040 and 2060.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ratios</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">results</span><span class="o">.</span><span class="n">params</span>
<span class="n">ratios</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">ratios</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.10821618126745203, -0.02076728510750292)
</pre></div>
</div>
</div>
</div>
<p>The following function uses the results from the model to generate predictions – assuming future trends at current rates.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">pred_hazard</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">pred_frame</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Predict hazard rates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hazard</span> <span class="o">=</span> <span class="n">Hazard</span><span class="p">(</span><span class="mi">10</span> <span class="o">**</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pred_frame</span><span class="p">))</span>
    <span class="n">hazard</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">hazard</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">105</span><span class="p">)</span>
<span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2019</span>
<span class="n">hazard_no_progress</span> <span class="o">=</span> <span class="n">pred_hazard</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">pred_frame</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pred_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2019</span> <span class="o">+</span> <span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">40</span>
<span class="n">hazard_progress</span> <span class="o">=</span> <span class="n">pred_hazard</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">pred_frame</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_pred</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="n">year</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use a regression model to generate predictions.</span>
<span class="sd">    </span>
<span class="sd">    subset: DataFrame</span>
<span class="sd">    results: RegressionResults</span>
<span class="sd">    year: int</span>
<span class="sd">    </span>
<span class="sd">    returns: Hazard</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">pred_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">values</span>
    <span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">year</span>

    <span class="n">pred</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">results</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">pred_frame</span><span class="p">)</span>
    <span class="n">pred</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">subset</span><span class="o">.</span><span class="n">index</span>
    <span class="k">return</span> <span class="n">Hazard</span><span class="p">(</span><span class="n">pred</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span><span class="p">[</span><span class="mi">2000</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;x-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Re70</span><span class="p">)</span>
<span class="n">subset</span><span class="p">[</span><span class="mi">2019</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">ms</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;o-&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Pu40</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">make_pred</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="mi">2040</span><span class="p">)</span>
<span class="n">pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">make_pred</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="n">results</span><span class="p">,</span> <span class="mi">2060</span><span class="p">)</span>
<span class="n">pred</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">marker</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">80</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="s2">&quot;s&quot;</span><span class="p">]):</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">hazard_progress</span><span class="p">[</span><span class="n">x</span><span class="p">]</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">marker</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">)</span>

<span class="n">hazard_progress</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">80</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">lw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With current progress&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Mortality rate&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">add_yticks</span><span class="p">()</span>
<span class="c1">#decorate(title=&quot;Mortality rate in Sweden with continued progress&quot;, loc=&quot;lower right&quot;)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue12.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/fd0c4a9894e29c297153dc2ce08e8f1fd2f4f5024eebb1c4e3262b4531b93d48.png" src="_images/fd0c4a9894e29c297153dc2ce08e8f1fd2f4f5024eebb1c4e3262b4531b93d48.png" />
</div>
</div>
<p>The line labeled “With current progress” indicates the mortality rates we expect for a hypothetical Swede who was 40 in 2020.
When they are 60, it will be 2040, so we expect them to have the mortality rate of a 60-year-old in 2040, indicated by a triangle.
And when they are 80, it will be 2060, so we expect them to have the mortality rate of an 80-year-old in 2060, indicated by a square.</p>
<p>We can use these mortality rates to compute survival curves, as shown in the following figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_no_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Without progress&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">,</span>
    <span class="c1">#title=&quot;Survival curve, Sweden 2019&quot;,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue12a.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f0189a491896fb5c4c7480e5e0e5fe8d00642b3867c08aad90f53211f692046b.png" src="_images/f0189a491896fb5c4c7480e5e0e5fe8d00642b3867c08aad90f53211f692046b.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_no_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Without progress&quot;</span><span class="p">)</span>
<span class="n">hazard_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With current progress&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">,</span>
    <span class="c1">#title=&quot;Survival curves with and without progress&quot;,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue12b.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1d637ecd39e35e43b567bde3f3c76d0bfa28d057c431fc7ea85da394abbd245a.png" src="_images/1d637ecd39e35e43b567bde3f3c76d0bfa28d057c431fc7ea85da394abbd245a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hypothetical_results</span><span class="p">(</span><span class="n">b2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make RegressionResults with a counterfactual slope.</span>
<span class="sd">    </span>
<span class="sd">    b2: slope</span>
<span class="sd">    </span>
<span class="sd">    returns: RegressionResults</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">results</span> <span class="o">=</span> <span class="n">smf</span><span class="o">.</span><span class="n">ols</span><span class="p">(</span><span class="n">formula</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">)</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
    <span class="n">i1</span><span class="p">,</span> <span class="n">a1</span><span class="p">,</span> <span class="n">b1</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span>
    <span class="n">i2</span> <span class="o">=</span> <span class="n">i1</span> <span class="o">+</span> <span class="p">(</span><span class="n">b1</span> <span class="o">-</span> <span class="n">b2</span><span class="p">)</span> <span class="o">*</span> <span class="mi">2019</span>
    <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;Intercept&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">i2</span>
    <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">b2</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">hazard_hypo_progress</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">upper</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute a Hazard function with hypothetical progress.</span>

<span class="sd">    b2: slope</span>
<span class="sd">    upper: upper end of the qs</span>

<span class="sd">    returns: Hazard</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hypo</span> <span class="o">=</span> <span class="n">hypothetical_results</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span>
    <span class="n">pred_frame</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">upper</span><span class="p">)</span>
    <span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2019</span> <span class="o">+</span> <span class="n">pred_frame</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="mi">40</span>
    <span class="k">return</span> <span class="n">pred_hazard</span><span class="p">(</span><span class="n">hypo</span><span class="p">,</span> <span class="n">pred_frame</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b2</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span>
<span class="n">hazard_progress2</span> <span class="o">=</span> <span class="n">hazard_hypo_progress</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="mi">145</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b3</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">hazard_progress3</span> <span class="o">=</span> <span class="n">hazard_hypo_progress</span><span class="p">(</span><span class="n">b3</span><span class="p">,</span> <span class="mi">180</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b4</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mi">4</span>
<span class="n">hazard_progress4</span> <span class="o">=</span> <span class="n">hazard_hypo_progress</span><span class="p">(</span><span class="n">b4</span><span class="p">,</span> <span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-4.89621102405056
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b49</span> <span class="o">=</span> <span class="o">-</span><span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;age&quot;</span><span class="p">]</span>
<span class="n">hazard_progress49</span> <span class="o">=</span> <span class="n">hazard_hypo_progress</span><span class="p">(</span><span class="n">b49</span><span class="p">,</span> <span class="mi">8000</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_progress</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">hazard_progress2</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">hazard_progress3</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">hazard_progress4</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">hazard_progress49</span><span class="o">.</span><span class="n">loc</span><span class="p">[:</span><span class="mi">140</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/56e8b40796dd308475b3ed657b70db30a44a8412bb672e46e1ad81dccc0c0709.png" src="_images/56e8b40796dd308475b3ed657b70db30a44a8412bb672e46e1ad81dccc0c0709.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_no_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Without progress&quot;</span><span class="p">)</span>
<span class="n">hazard_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With current progress&quot;</span><span class="p">)</span>
<span class="n">hazard_progress2</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress x2&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">,</span>
    <span class="c1">#title=&quot;Survival curves with different rates of progress&quot;,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue13.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b21869feff2244a0d7e0b6f25a79594a01c615e2f52012314ae58b8fcb923c4b.png" src="_images/b21869feff2244a0d7e0b6f25a79594a01c615e2f52012314ae58b8fcb923c4b.png" />
</div>
</div>
<p>The dashed line on the left shows the survival curve we expect if there is no further decrease in mortality rates; in that scenario, life expectancy at age 40 is 82 years and the probability of living to 100 is only 1.4%.</p>
<p>The solid line shows the survival curve if mortality continues to decrease at the current rate; in that case, life expectancy for the same 40-year-old is 90 years and the chance of living to 100 is 25%.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">hazard</span><span class="p">):</span>
    <span class="n">pmf</span> <span class="o">=</span> <span class="n">hazard</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">()</span>
    <span class="n">pmf</span><span class="o">.</span><span class="n">normalize</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">pmf</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span><span class="p">(</span><span class="n">hazard_no_progress</span><span class="p">),</span> <span class="n">mean</span><span class="p">(</span><span class="n">hazard_progress</span><span class="p">),</span> <span class="n">mean</span><span class="p">(</span><span class="n">hazard_progress2</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(81.88119575997098, 90.01328388938188, 102.72010650635067)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mean</span><span class="p">(</span><span class="n">hazard_progress3</span><span class="p">),</span> <span class="n">mean</span><span class="p">(</span><span class="n">hazard_progress4</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(125.65619219578866, 185.38884205632206)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_no_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array(0.01353305)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()(</span><span class="mi">100</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array(0.24964025)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_progress2</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()([</span><span class="mi">100</span><span class="p">,</span> <span class="mi">120</span><span class="p">,</span> <span class="mi">130</span><span class="p">,</span> <span class="mi">140</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.60379629, 0.17113289, 0.03569291, 0.00159352])
</pre></div>
</div>
</div>
</div>
<p>Finally, the dotted line on the right shows the survival curve if mortality decreases at twice the current rate.
Life expectancy at age 40 would be 102 and the probability of living to 100 would be 60%.</p>
<p>The following figure shows the survival curve under the assumption that mortality rates, starting in 2019, decrease at four times the current rate.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_progress4</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×4&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Survival curve with progress ×4&quot;,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/09e29efa5d170048fcfe9469353fb0bd7fe84fa03a670c022d69c54daa25fe10.png" src="_images/09e29efa5d170048fcfe9469353fb0bd7fe84fa03a670c022d69c54daa25fe10.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">hazard_no_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Without progress&quot;</span><span class="p">)</span>
<span class="n">hazard_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With current progress&quot;</span><span class="p">)</span>
<span class="n">hazard_progress2</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×2&quot;</span><span class="p">)</span>
<span class="n">hazard_progress4</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×4&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Survival curve with 4x rate of progress&quot;,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue14.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4301166e53e433663d11bf7cb6fb354a3d170e79c201c333b474c46d5ccdfa2d.png" src="_images/4301166e53e433663d11bf7cb6fb354a3d170e79c201c333b474c46d5ccdfa2d.png" />
</div>
</div>
<p>In this scenario, some people live to be 300 years old!
However, even with these optimistic assumptions, the shape of the curve is similar to what we get with slower rates of progress.
And, as shown in the following figure, average remaining lifetimes decrease with almost the same slope.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">hazard_progress4</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">rem_progress4</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">hazard_progress4</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">(),</span> <span class="n">qs</span><span class="p">)</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="n">hazard_progress3</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
<span class="n">rem_progress3</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">hazard_progress3</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">(),</span> <span class="n">qs</span><span class="p">)</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">140</span><span class="p">)</span>
<span class="n">rem_progress2</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">hazard_progress2</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">(),</span> <span class="n">qs</span><span class="p">)</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">120</span><span class="p">)</span>
<span class="n">rem_progress</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">hazard_progress</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">(),</span> <span class="n">qs</span><span class="p">)</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">rem_no_progress</span> <span class="o">=</span> <span class="n">remaining_lifetimes_pmf</span><span class="p">(</span><span class="n">hazard_no_progress</span><span class="o">.</span><span class="n">make_pmf</span><span class="p">(),</span> <span class="n">qs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rem_progress4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×4&quot;</span><span class="p">)</span>
<span class="c1"># rem_progress3.plot(ls=&#39;:&#39;, label=&#39;With progress ×3&#39;)</span>
<span class="n">rem_progress2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×2&quot;</span><span class="p">)</span>
<span class="n">rem_progress</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With current progress&quot;</span><span class="p">)</span>
<span class="n">rem_no_progress</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Without progress&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Average remaining lifetime&quot;</span><span class="p">,</span>
    <span class="c1"># title=&quot;Average remaining lifetime with different rates of progress&quot;,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue15.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/02df8ec36775f1e078fe05d90da78ff435e6bb403cf7fc45584c0b8920f67dda.png" src="_images/02df8ec36775f1e078fe05d90da78ff435e6bb403cf7fc45584c0b8920f67dda.png" />
</div>
</div>
<p>With faster progress, people live longer, but they still have the new-better-than-used property: as each year passes, they get closer to the grave, on average.</p>
<p>However, something remarkable happens if progress accelerates by a factor of 4.9.
At that speed, the increase in mortality due to aging by one year is exactly offset by the decrease due to progress.
That means that the probability of dying is the same from one year to the next, forever.
The result is a survival curve that looks like this.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dashdotdot</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>

<span class="n">hazard_no_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Without progress&quot;</span><span class="p">)</span>
<span class="n">hazard_progress</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With current progress&quot;</span><span class="p">)</span>
<span class="n">hazard_progress2</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×2&quot;</span><span class="p">)</span>
<span class="n">hazard_progress4</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C3&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-.&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×4&quot;</span><span class="p">)</span>

<span class="n">hazard_progress49</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="n">dashdotdot</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;With progress ×4.9&quot;</span>
<span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Probability of survival&quot;</span><span class="p">,</span>
<span class="c1">#    title=&quot;Survival curves with progress ×4 and ×4.9 progress&quot;,</span>
<span class="p">)</span>
<span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;nbue15.png&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d36d7a6cbf552f52b6328efec366105e8b4e4e77312839e2e624a731fb34ed38.png" src="_images/d36d7a6cbf552f52b6328efec366105e8b4e4e77312839e2e624a731fb34ed38.png" />
</div>
</div>
<p>The difference between 4 and 4.9 is qualitative.
At a factor of 4, the survival curve plummets toward an inevitable end; at a factor of 4.9, it extends out to ages that are beyond biblical.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lam</span> <span class="o">=</span> <span class="n">hazard_no_progress</span><span class="p">[</span><span class="mi">40</span><span class="p">]</span>
<span class="n">lam</span> <span class="o">*</span> <span class="mf">1e4</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7.888830027209969
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">/</span> <span class="n">lam</span><span class="p">,</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">lam</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1267.6150919094762, 2535.2301838189524)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">expon</span>

<span class="n">dist</span> <span class="o">=</span> <span class="n">expon</span><span class="p">(</span><span class="n">scale</span><span class="o">=</span><span class="mi">1</span> <span class="o">/</span> <span class="n">lam</span><span class="p">)</span>
<span class="n">dist</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">dist</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1267.6150919094762, 878.6438269922893)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="o">.</span><span class="n">sf</span><span class="p">([</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">4000</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.20643576, 0.04261572])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">7e9</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>28735.7893553912
</pre></div>
</div>
</div>
</div>
<p>In the near future, if child mortality continues to decrease, everyone will be better new than used.
But eventually, if adult mortality decreases fast enough, everyone will have the same remaining time, on average: new, used, or in between.</p>
<p>Probably Overthinking It</p>
<p>Copyright 2022 Allen Downey</p>
<p>The code in this notebook and <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> is under the <a class="reference external" href="https://mit-license.org/">MIT license</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="lognormal.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Extremes, Outliers, and GOATs</p>
      </div>
    </a>
    <a class="right-next"
       href="berkson.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Jumping to Conclusions</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#light-bulbs">Light Bulbs</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#any-day-now">Any day now</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cancer-survival-times">Cancer survival times</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#life-expectancy-at-birth">Life Expectancy At Birth</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#child-mortality">Child mortality</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-immortal-swede">The Immortal Swede</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen B. Downey
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>