

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Penguins, Pessimists, and Paradoxes &#8212; Probably Overthinking It</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'simpson';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Changing Hearts and Minds" href="progress.html" />
    <link rel="prev" title="Fairness and Fallacy" href="base_rate.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">Probably Overthinking It</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Probably Overthinking It
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gaussian.html">Are You Normal? Hint: No.</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspection.html">Relay Races and Revolving Doors</a></li>
<li class="toctree-l1"><a class="reference internal" href="preston.html">Defy Tradition, Save the World</a></li>
<li class="toctree-l1"><a class="reference internal" href="lognormal.html">Extremes, Outliers, and GOATs</a></li>
<li class="toctree-l1"><a class="reference internal" href="nbue.html">Better Than New</a></li>
<li class="toctree-l1"><a class="reference internal" href="berkson.html">Jumping to Conclusions</a></li>
<li class="toctree-l1"><a class="reference internal" href="birthweight.html">Causation, Collision, and Confusion</a></li>
<li class="toctree-l1"><a class="reference internal" href="longtail.html">The Long Tail of Disaster</a></li>
<li class="toctree-l1"><a class="reference internal" href="base_rate.html">Fairness and Fallacy</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Penguins, Pessimists, and Paradoxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="progress.html">Changing Hearts and Minds</a></li>
<li class="toctree-l1"><a class="reference internal" href="overton.html">Chasing the Overton Window</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ansur_pca.html">The Principal Components of Anthropometry</a></li>
<li class="toctree-l1"><a class="reference internal" href="bertrand.html">Bertrand’s Boxes</a></li>
<li class="toctree-l1"><a class="reference internal" href="ideology_gap.html">Is the Ideology Gap Growing?</a></li>
<li class="toctree-l1"><a class="reference internal" href="migration.html">Population Growth and Migration</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AllenDowney/ProbablyOverthinkingIt" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/simpson.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Penguins, Pessimists, and Paradoxes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#old-optimists-young-pessimists">Old Optimists, Young Pessimists</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-wages">Real Wages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#penguins">Penguins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simpsons-prescription">Simpson’s Prescription</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#do-vaccines-work-hint-yes">Do vaccines work? Hint: yes.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debunk-redux">Debunk Redux</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lives-saved">Lives saved</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sources-and-related-reading">Sources and related reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#israeli-data">Israeli Data</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="penguins-pessimists-and-paradoxes">
<h1>Penguins, Pessimists, and Paradoxes<a class="headerlink" href="#penguins-pessimists-and-paradoxes" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/ProbablyOverthinkingIt/blob/book/notebooks/simpson.ipynb">Click here to run this notebook on Colab</a>.</p>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install empiricaldist if we don&#39;t already have it</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">empiricaldist</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>empiricaldist
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># download utils.py</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">exists</span>

<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>
        <span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Downloaded &#39;</span> <span class="o">+</span> <span class="n">local</span><span class="p">)</span>
        
<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ProbablyOverthinkingIt/raw/book/notebooks/utils.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell tag_hide-cell docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell content</span>
<span class="expanded">Hide code cell content</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">decorate</span>

<span class="c1"># Set the random seed so we get the same results every time</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
<p>In 2021, the journalist I mentioned in the previous chapter wrote a series of misleading articles about the COVID pandemic.
I won’t name him, but on April 1, appropriately, <em>The Atlantic</em> magazine identified him as “The Pandemic’s Wrongest Man”.</p>
<p>In November, this journalist posted an online newsletter with the title “Vaccinated English adults under 60 are dying at twice the rate of unvaccinated people the same age”.
It includes a graph showing that the overall death rate among young, vaccinated people increased between April and September, 2021, and was actually higher among the vaccinated than among the unvaccinated.</p>
<p>As you might expect, this newsletter got a lot of attention. Among skeptics, it seemed like proof that vaccines were not just ineffective, but harmful. And among people who were counting on vaccines to end the pandemic, it seemed like a devastating setback.</p>
<p>Many people fact-checked the article, and at first the results held up to scrutiny: the graph accurately represented data published by the U.K. Office for National Statistics.
Specifically, it showed death rates, from any cause, for people in England between 10 and 59 years old, from March to September 2021.
And between April and September, these rates were higher among the fully vaccinated, compared to the unvaccinated, by a factor of almost 2.
So the journalist’s description of the results was correct.</p>
<p>However, his conclusion that vaccines were causing increased mortality was completely wrong.
In fact, the data he reported shows that vaccines were safe and effective in this population, and demonstrably saved many lives.</p>
<p>How, you might ask, can increased mortality be evidence of saved lives?
The answer is Simpson’s paradox.
If you have not seen it before, Simpson’s paradox can seem impossible, but as I will try to show you, it is not just possible but ordinary – and once you’ve seen enough examples, it is not even surprising.</p>
<p>We’ll start with an easy case and work our way up.</p>
<section id="old-optimists-young-pessimists">
<h2>Old Optimists, Young Pessimists<a class="headerlink" href="#old-optimists-young-pessimists" title="Permalink to this heading">#</a></h2>
<p>Would you say that most of the time people try to be helpful, or that they are mostly just looking out for themselves? Almost every year since 1972, the General Social Survey (GSS) has posed that question to a representative sample of adult residents of the United States.</p>
<p>The following figure shows how the responses have changed over time.
The circles show the percentage of people in each survey who said that people try to be helpful.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://gssdataexplorer.norc.org/variables/439/vshow</span>

<span class="c1"># 1 = helpful</span>
<span class="c1"># 2 = look out for themselves</span>
<span class="c1"># 3 = depends</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This dataset is prepared in clean_simpson.ipynb</span>

<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/AllenDowney/ProbablyOverthinkingIt/raw/book/data/&quot;</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;gss_simpson.hdf&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;gss&quot;</span><span class="p">)</span>
<span class="n">gss</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(68846, 214)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1978</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="s2">&quot;helpful&quot;</span><span class="p">]</span>
<span class="n">series</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1520.000000
mean        1.474342
std         0.605548
min         1.000000
25%         1.000000
50%         1.000000
75%         2.000000
max         3.000000
Name: helpful, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0    888
2.0    543
3.0     89
Name: helpful, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Pmf</span>

<span class="n">Pmf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>probs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>0.584211</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.357237</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>0.058553</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1987</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">year</span><span class="p">,</span> <span class="s2">&quot;helpful&quot;</span><span class="p">]</span>
<span class="n">series</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1809.000000
mean        1.606965
std         0.571034
min         1.000000
25%         1.000000
50%         2.000000
75%         2.000000
max         3.000000
Name: helpful, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.0    940
1.0    790
3.0     79
Name: helpful, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Pmf</span>

<span class="n">Pmf</span><span class="o">.</span><span class="n">from_seq</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>probs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1.0</th>
      <td>0.436705</td>
    </tr>
    <tr>
      <th>2.0</th>
      <td>0.519624</td>
    </tr>
    <tr>
      <th>3.0</th>
      <td>0.043671</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;helpful&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">xtab</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">series</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;helpful&quot;</span>
<span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">idxmax</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(58.42105263157895, 1978, 40.243902439024396, 1996)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Would you say that most of the time people try to be helpful, </span>
<span class="s2">or that they are mostly just looking out for themselves?</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="n">short_title</span> <span class="o">=</span> <span class="s2">&quot;Would people be helpful or look out for themselves?&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">plot_series_lowess</span>

<span class="n">plot_series_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">plot_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1"># plt.title(title, loc=&quot;left&quot;, fontdict=dict(fontsize=12))</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year of survey&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percent saying &#39;helpful&#39; vs year of survey&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/1d83836b8bf724a133b857794905c586ae7434e47e9dca0841467dfed18cfce6.png" src="_images/1d83836b8bf724a133b857794905c586ae7434e47e9dca0841467dfed18cfce6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">make_lowess</span>

<span class="n">make_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1972.0    46.399992
1973.0    46.804000
1975.0    47.621057
1976.0    48.027929
1978.0    48.815860
1980.0    49.546170
1983.0    50.731526
1984.0    51.032275
1986.0    51.262427
1987.0    51.154733
1988.0    51.145142
1989.0    50.812748
1990.0    50.518220
1991.0    50.078283
1993.0    49.243129
1994.0    48.868180
1996.0    48.351256
1998.0    48.030031
2000.0    47.515587
2002.0    47.034961
2004.0    46.911821
2006.0    46.962785
2008.0    47.104853
2010.0    47.228283
2012.0    47.357632
2014.0    47.510421
2016.0    47.688959
2018.0    47.887754
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The percentages vary from year to year, in part because the GSS surveys a different group of people for each survey.
Looking at the extremes: in 1978, about 58% said “helpful”; in 1996, it was only 40%.</p>
<p>The solid line in the figure shows a LOWESS curve, which is a statistical way to smooth out short-term variation and show the long-term trend.
Putting aside the extreme highs and lows, it looks like the fraction of optimists has decreased since 1990, from about 51% to 48%.</p>
<p>These results don’t just depend on when you ask; they also depend on who you ask.
In particular, they depend strongly on when the respondents were born, as shown in the following figure.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">prepare_yvar</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">chunk_series</span>

<span class="n">xvarname</span> <span class="o">=</span> <span class="s2">&quot;cohort&quot;</span>
<span class="n">yvarname</span> <span class="o">=</span> <span class="s2">&quot;helpful&quot;</span>
<span class="n">yvalue</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">prepare_yvar</span><span class="p">(</span><span class="n">gss</span><span class="p">,</span> <span class="n">yvarname</span><span class="p">,</span> <span class="n">yvalue</span><span class="p">)</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">chunk_series</span><span class="p">(</span><span class="n">gss</span><span class="p">,</span> <span class="n">xvarname</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">plot_series_lowess</span><span class="p">(</span>
    <span class="n">series</span><span class="p">,</span>
    <span class="n">plot_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span>
    <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;dashed&quot;</span><span class="p">,</span>
    <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="c1"># plt.title(title, loc=&quot;left&quot;, fontdict=dict(fontsize=11))</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year of birth&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percent saying &#39;helpful&#39; vs year of birth&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3296d143df2b14b204f96acc990fa21724a3ed446a5175f7c8661ff4cbe96610.png" src="_images/3296d143df2b14b204f96acc990fa21724a3ed446a5175f7c8661ff4cbe96610.png" />
</div>
</div>
<p>Notice that the x-axis here is the respondent’s year of birth, not the year they participated in the survey.
The oldest person to participate in the GSS was born in 1883.
Because the GSS only surveys adults, the youngest, as of 2021, was born in 2003.
Again, the markers show variability in the survey results; the dashed line shows the long-term trend.</p>
<p>Starting with people born in the 1940s, Americans’ faith in humanity has been declining consistently, from about 55% for people born before 1930 to about 30% for people born after 1990.
That is a substantial decrease!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">make_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1897.305000    52.120319
1905.215000    53.284864
1909.190000    53.858843
1912.293333    54.306193
1914.818333    54.665509
                 ...    
1980.853333    36.307102
1983.280000    35.352350
1986.106667    34.266167
1989.426667    33.030785
1994.888325    31.071020
Length: 68, dtype: float64
</pre></div>
</div>
</div>
</div>
<p>To get an idea of what’s happening, let’s zoom in on people born in the 1940s.
The following figure shows the fraction of people in this cohort who said people would try to be helpful, plotted over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">subset</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;cohort10&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">subset</span><span class="p">[</span><span class="s2">&quot;cohort10&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subset</span><span class="p">[</span><span class="s2">&quot;cohort10&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">make_table</span>

<span class="n">xvarname</span> <span class="o">=</span> <span class="s2">&quot;year&quot;</span>
<span class="n">yvarname</span> <span class="o">=</span> <span class="s2">&quot;helpful&quot;</span>
<span class="n">gvarname</span> <span class="o">=</span> <span class="s2">&quot;cohort10&quot;</span>
<span class="n">yvalue</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">prepare_yvar</span><span class="p">(</span><span class="n">gss</span><span class="p">,</span> <span class="n">yvarname</span><span class="p">,</span> <span class="n">yvalue</span><span class="p">)</span>
<span class="n">overall</span> <span class="o">=</span> <span class="n">chunk_series</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="n">xvarname</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">table</span> <span class="o">=</span> <span class="n">make_table</span><span class="p">(</span><span class="n">subset</span><span class="p">,</span> <span class="n">xvarname</span><span class="p">,</span> <span class="n">yvarname</span><span class="p">,</span> <span class="n">gvarname</span><span class="p">,</span> <span class="n">yvalue</span><span class="p">)</span>
<span class="k">del</span> <span class="n">table</span><span class="p">[</span><span class="mi">1900</span><span class="p">]</span>
<span class="k">del</span> <span class="n">table</span><span class="p">[</span><span class="mi">1910</span><span class="p">]</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="mi">1940</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">make_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1972.000000    45.969222
1972.853333    46.838756
1974.640000    48.553441
1975.906667    49.690533
1977.753333    51.209736
1979.553333    52.588674
1982.690000    52.934442
1983.920000    52.947150
1986.003333    52.592398
1987.000000    52.654427
1988.333333    53.031651
1989.936667    53.287806
1992.193333    53.422913
1993.943333    53.406083
1995.486667    53.295321
1997.220000    52.995021
1999.373333    53.017955
2001.793333    53.620756
2005.806667    55.357242
2009.146667    56.867664
2013.180000    58.812900
2016.970370    60.725940
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot_series_lowess</span><span class="p">(</span><span class="n">series</span><span class="p">,</span> <span class="n">plot_series</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Born in the 1940s&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year of survey&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percent saying &#39;helpful&#39; vs year of survey&quot;</span><span class="p">,</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;lower right&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f2d90eae8ecf35ea375495d3f5d2184e15e6ff7eb995277e8d6d4996692629ad.png" src="_images/f2d90eae8ecf35ea375495d3f5d2184e15e6ff7eb995277e8d6d4996692629ad.png" />
</div>
</div>
<p>Again, different people were surveyed each year, so there is a lot of variability. Nevertheless, there is a clear increasing trend.
When this cohort was interviewed in the 1970s, about 46% of them gave a positive response; when they were interviewed in the 2010s, about 61% did.</p>
<p>The following figure shows the responses to this question grouped by decade of birth and plotted over time.
For clarity, I’ve dropped the circles showing the annual results and plotted only the smoothed lines.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">visualize_table</span><span class="p">,</span> <span class="n">label_table</span>

<span class="n">visualize_table</span><span class="p">(</span>
    <span class="n">overall</span><span class="p">,</span>
    <span class="n">table</span><span class="p">,</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year of survey&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percent saying &#39;helpful&#39; vs year of survey&quot;</span><span class="p">,</span>
    <span class="n">plot_series</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">nudge</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;1900s&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1910s&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;1920s&quot;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">label_table</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">nudge</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/61f8150f534073a28c40bb6832528e00ae089d2c6b221660f31cd61e57a18927.png" src="_images/61f8150f534073a28c40bb6832528e00ae089d2c6b221660f31cd61e57a18927.png" />
</div>
</div>
<p>The solid lines show the trends within each cohort: people generally become more optimistic as they age.
The dashed line shows the overall trend: on average, people are becoming less optimistic over time.</p>
<p>In this example, the explanation is <em>generational replacement</em>; as the oldest, more optimistic cohort dies off, it is replaced by the youngest, more pessimistic cohort.</p>
<p>The differences between these generations are substantial.
In the most recent data, only 39% of respondents born in the 1990s said people would try to be helpful, compared to 51% of those born in the 1960s and 64% of those born in the 1920s.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="p">[</span><span class="mi">1920</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>64.21052631578948
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="p">[</span><span class="mi">1960</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>50.847457627118644
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="p">[</span><span class="mi">1990</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>38.864628820960704
</pre></div>
</div>
</div>
</div>
<p>And the composition of the population has changed a lot over 50 years.
The following figure shows the distribution of birth years for the respondents at the beginning of the survey in 1973, near the middle in 1990, and most recently in 2018.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;cohort10&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

<span class="n">Pmf</span><span class="p">(</span><span class="n">xtab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1973</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1973&quot;</span><span class="p">)</span>
<span class="n">Pmf</span><span class="p">(</span><span class="n">xtab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1990</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1990&quot;</span><span class="p">)</span>
<span class="n">Pmf</span><span class="p">(</span><span class="n">xtab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2018</span><span class="p">])</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;2018&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year of birth&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fraction of sample&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c30e455ea9cc3876d14209037275ab91b0002fb8b96d987ca18811d95a17c60d.png" src="_images/c30e455ea9cc3876d14209037275ab91b0002fb8b96d987ca18811d95a17c60d.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">seaborn</span> <span class="kn">import</span> <span class="n">kdeplot</span>

<span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">bw_adjust</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">kdeplot</span><span class="p">(</span><span class="n">gss</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year==1973&quot;</span><span class="p">)[</span><span class="s2">&quot;cohort&quot;</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1973&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="n">kdeplot</span><span class="p">(</span><span class="n">gss</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year==1990&quot;</span><span class="p">)[</span><span class="s2">&quot;cohort&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;1990&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
<span class="n">kdeplot</span><span class="p">(</span><span class="n">gss</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year==2018&quot;</span><span class="p">)[</span><span class="s2">&quot;cohort&quot;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;2018&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year of birth&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Relative likelihood&quot;</span><span class="p">,</span>
    <span class="n">yticks</span><span class="o">=</span><span class="p">[],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of birth year&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d2abcbc5c26e177f0df209c120e107191cc8b230b2322854cd045d9e8e1013fb.png" src="_images/d2abcbc5c26e177f0df209c120e107191cc8b230b2322854cd045d9e8e1013fb.png" />
</div>
</div>
<p>In the earliest years of the survey, most the the respondents were born between 1890 and 1950.
In the 1990 survey, most were born between 1901 and 1972.
In the 2018 survey, most were born between 1929 and 2000.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year==1973&quot;</span><span class="p">)[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span>
<span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1888.0, 1955.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year==1990&quot;</span><span class="p">)[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span>
<span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1901.0, 1972.0)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="s2">&quot;year==2018&quot;</span><span class="p">)[</span><span class="s2">&quot;cohort&quot;</span><span class="p">]</span>
<span class="n">series</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">series</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1929.0, 2000.0)
</pre></div>
</div>
</div>
</div>
<p>With this explanation, I hope Simpson’s paradox no longer seems impossible.
But if it is still surprising, let’s look at another example.</p>
</section>
<section id="real-wages">
<h2>Real Wages<a class="headerlink" href="#real-wages" title="Permalink to this heading">#</a></h2>
<p>In April 2013 Floyd Norris, chief financial correspondent of <em>The New York Times</em>, wrote an article with the headline “Median Pay in U.S. Is Stagnant, but Low-Paid Workers Lose”.
Using data from the U.S. Bureau of Labor Statistics, he computed the following changes in median real wages between 2000 and 2013, grouped by level of education:</p>
<ul class="simple">
<li><p>High School Dropouts: -7.9%</p></li>
<li><p>High School Graduates, No College: -4.7%</p></li>
<li><p>Some College: -7.6%</p></li>
<li><p>Bachelor’s or Higher: -1.2%</p></li>
</ul>
<p>In all groups, real wages were lower in 2013 than in 2000, which is what the article was about.
But Norris also reported the overall change in the median real wage: during the same period, it <em>increased</em> by 0.9%.
Several readers wrote to say he had made a mistake.
If wages in all groups were doing down, how could overall wages go up?</p>
<p>To explain what’s going on, I will replicate the results from Norris’s article using data from the Current Population Survey (CPS) conducted by the U.S. Census Bureau and the Bureau of Labor Statistics.
This dataset includes real wages and education levels for almost 1.9 million participants between 1996 and 2021.
Real wages are adjusted for inflation and reported in constant 1999 dollars.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># this dataset is prepared in clean_cps.ipynb</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;ipums_cps.hdf&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ipums_cps</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;ipums_cps&quot;</span><span class="p">)</span>
<span class="n">ipums_cps</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>degree</th>
      <th>real_wage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>4</th>
      <td>1970</td>
      <td>hs</td>
      <td>19068.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1970</td>
      <td>nohs</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1970</td>
      <td>hs</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>1970</td>
      <td>nohs</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1970</td>
      <td>nohs</td>
      <td>908.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">d</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;nohs&quot;</span><span class="p">:</span> <span class="s2">&quot;No diploma&quot;</span><span class="p">,</span>
    <span class="s2">&quot;hs&quot;</span><span class="p">:</span> <span class="s2">&quot;High school&quot;</span><span class="p">,</span>
    <span class="s2">&quot;bach&quot;</span><span class="p">:</span> <span class="s2">&quot;Bachelor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;assc&quot;</span><span class="p">:</span> <span class="s2">&quot;Associate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;college&quot;</span><span class="p">:</span> <span class="s2">&quot;Some college&quot;</span><span class="p">,</span>
    <span class="s2">&quot;adv&quot;</span><span class="p">:</span> <span class="s2">&quot;Advanced&quot;</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">ipums_cps</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="mi">1996</span>
<span class="n">recent</span> <span class="o">=</span> <span class="n">ipums_cps</span><span class="p">[</span><span class="n">ipums_cps</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">start</span><span class="p">]</span>
<span class="n">recent</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year</th>
      <th>degree</th>
      <th>real_wage</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>3990996</th>
      <td>1996</td>
      <td>No diploma</td>
      <td>67766.0</td>
    </tr>
    <tr>
      <th>3991000</th>
      <td>1996</td>
      <td>Some college</td>
      <td>3060.4</td>
    </tr>
    <tr>
      <th>3991003</th>
      <td>1996</td>
      <td>No diploma</td>
      <td>0.0</td>
    </tr>
    <tr>
      <th>3991004</th>
      <td>1996</td>
      <td>Advanced</td>
      <td>17488.0</td>
    </tr>
    <tr>
      <th>3991008</th>
      <td>1996</td>
      <td>Bachelor</td>
      <td>14209.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recent</span><span class="p">[</span><span class="s2">&quot;real_wage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1.896422e+06
mean     2.043957e+04
std      3.659772e+04
min      0.000000e+00
25%      0.000000e+00
50%      9.022000e+03
75%      2.963200e+04
max      1.303999e+06
Name: real_wage, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recent</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count         1896422
unique              6
top       High school
freq           582123
Name: degree, dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recent</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1.896422e+06
mean     2.008845e+03
std      7.023367e+00
min      1.996000e+03
25%      2.003000e+03
50%      2.009000e+03
75%      2.015000e+03
max      2.021000e+03
Name: year, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xvarname</span> <span class="o">=</span> <span class="s2">&quot;year&quot;</span>
<span class="n">yvarname</span> <span class="o">=</span> <span class="s2">&quot;real_wage&quot;</span>
<span class="n">gvarname</span> <span class="o">=</span> <span class="s2">&quot;degree&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">overall</span> <span class="o">=</span> <span class="n">recent</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;year&quot;</span><span class="p">)[</span><span class="s2">&quot;real_wage&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">overall</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;overall&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>

<span class="n">res</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">overall</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">overall</span><span class="p">)</span>
<span class="n">res</span><span class="o">.</span><span class="n">slope</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>77.26163851752604
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">recent</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="s2">&quot;year&quot;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s2">&quot;degree&quot;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s2">&quot;real_wage&quot;</span><span class="p">,</span> <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;mean&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">column</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">res</span><span class="o">.</span><span class="n">slope</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Advanced -150.74230565418188
Associate -188.32190788749065
Bachelor -53.36321685585188
High school -89.6395950955906
No diploma -26.70858108935015
Some college -148.96847910461423
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Advanced&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Bachelor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Associate&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Some college&quot;</span><span class="p">,</span>
    <span class="s2">&quot;High school&quot;</span><span class="p">,</span>
    <span class="s2">&quot;No diploma&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows average real wages for each level of education over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># figwidth = 3.835</span>
<span class="c1"># plt.figure(figsize=(figwidth, 0.6 * figwidth))</span>

<span class="n">nudge</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;High school&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.7</span><span class="p">}</span>

<span class="n">table2</span> <span class="o">=</span> <span class="n">table</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">table2</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">table2</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
    <span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.5</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nudge</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">column</span><span class="p">)</span>

<span class="n">overall2</span> <span class="o">=</span> <span class="n">overall</span> <span class="o">/</span> <span class="mi">1000</span>
<span class="n">overall2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;1999 dollars (thousands)&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Average real wage income by education level&quot;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">1996</span><span class="p">,</span> <span class="mi">2022</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2020</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">50</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>([&lt;matplotlib.axis.YTick at 0x7f5299f1caf0&gt;,
  &lt;matplotlib.axis.YTick at 0x7f5299f1c490&gt;,
  &lt;matplotlib.axis.YTick at 0x7f5297d60310&gt;],
 [Text(0, 10, &#39;10&#39;), Text(0, 30, &#39;30&#39;), Text(0, 50, &#39;50&#39;)])
</pre></div>
</div>
<img alt="_images/00851ee879e008dda37a704b01d21c3fa9f800e1a0af52a7ec96822f543a542d.png" src="_images/00851ee879e008dda37a704b01d21c3fa9f800e1a0af52a7ec96822f543a542d.png" />
</div>
</div>
<p>These results are consistent with Norris’s: real wages in every group decreased over this period.
The decrease was steepest among people with an associate degree, by about $190 per year over 26 years.</p>
<p>The decrease was smallest among people with no high school diploma, about $30 per year.</p>
<p>However, if we combine the groups, real wages increased during the same period by about $80 per year, as shown by the dotted line in the figure.
Again, this seems like a contradiction.</p>
<p>In this example, the explanation is that levels of education changed substantially during this period.
The following figure shows the fraction of the population at each educational level, plotted over time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">recent</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">recent</span><span class="p">[</span><span class="s2">&quot;degree&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">xtab</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>degree</th>
      <th>Advanced</th>
      <th>Associate</th>
      <th>Bachelor</th>
      <th>High school</th>
      <th>No diploma</th>
      <th>Some college</th>
    </tr>
    <tr>
      <th>year</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1996</th>
      <td>6.407083</td>
      <td>6.425194</td>
      <td>13.955126</td>
      <td>32.711540</td>
      <td>22.181306</td>
      <td>18.319750</td>
    </tr>
    <tr>
      <th>1997</th>
      <td>6.413669</td>
      <td>6.337339</td>
      <td>14.177790</td>
      <td>33.135006</td>
      <td>21.450660</td>
      <td>18.485536</td>
    </tr>
    <tr>
      <th>1998</th>
      <td>6.561266</td>
      <td>6.693503</td>
      <td>14.246543</td>
      <td>33.138868</td>
      <td>21.130622</td>
      <td>18.229197</td>
    </tr>
    <tr>
      <th>1999</th>
      <td>6.731085</td>
      <td>6.553290</td>
      <td>14.739588</td>
      <td>32.882404</td>
      <td>20.543048</td>
      <td>18.550585</td>
    </tr>
    <tr>
      <th>2000</th>
      <td>7.237661</td>
      <td>6.802157</td>
      <td>15.022058</td>
      <td>32.606237</td>
      <td>19.940802</td>
      <td>18.391086</td>
    </tr>
    <tr>
      <th>2001</th>
      <td>7.242623</td>
      <td>7.279962</td>
      <td>15.264699</td>
      <td>32.047467</td>
      <td>19.786234</td>
      <td>18.379015</td>
    </tr>
    <tr>
      <th>2002</th>
      <td>7.554037</td>
      <td>7.265446</td>
      <td>15.546263</td>
      <td>31.826374</td>
      <td>19.745568</td>
      <td>18.062312</td>
    </tr>
    <tr>
      <th>2003</th>
      <td>7.619399</td>
      <td>7.385120</td>
      <td>15.668110</td>
      <td>31.453953</td>
      <td>19.497431</td>
      <td>18.375987</td>
    </tr>
    <tr>
      <th>2004</th>
      <td>8.010435</td>
      <td>7.387682</td>
      <td>15.799661</td>
      <td>31.305979</td>
      <td>19.099773</td>
      <td>18.396470</td>
    </tr>
    <tr>
      <th>2005</th>
      <td>7.982642</td>
      <td>7.603384</td>
      <td>15.930032</td>
      <td>31.509980</td>
      <td>18.947074</td>
      <td>18.026888</td>
    </tr>
    <tr>
      <th>2006</th>
      <td>8.034985</td>
      <td>7.982532</td>
      <td>15.817465</td>
      <td>31.691043</td>
      <td>18.469364</td>
      <td>18.004611</td>
    </tr>
    <tr>
      <th>2007</th>
      <td>8.141195</td>
      <td>7.759157</td>
      <td>16.636356</td>
      <td>31.313698</td>
      <td>18.050995</td>
      <td>18.098598</td>
    </tr>
    <tr>
      <th>2008</th>
      <td>8.681550</td>
      <td>7.725637</td>
      <td>17.020391</td>
      <td>30.919684</td>
      <td>17.194194</td>
      <td>18.458544</td>
    </tr>
    <tr>
      <th>2009</th>
      <td>8.832957</td>
      <td>8.086253</td>
      <td>16.873073</td>
      <td>30.600277</td>
      <td>17.113475</td>
      <td>18.493966</td>
    </tr>
    <tr>
      <th>2010</th>
      <td>8.734951</td>
      <td>8.249743</td>
      <td>16.902414</td>
      <td>30.866961</td>
      <td>16.782624</td>
      <td>18.463307</td>
    </tr>
    <tr>
      <th>2011</th>
      <td>9.223517</td>
      <td>8.532432</td>
      <td>17.356106</td>
      <td>30.139945</td>
      <td>16.330585</td>
      <td>18.417415</td>
    </tr>
    <tr>
      <th>2012</th>
      <td>9.224073</td>
      <td>8.566742</td>
      <td>17.470351</td>
      <td>30.036588</td>
      <td>15.963916</td>
      <td>18.738330</td>
    </tr>
    <tr>
      <th>2013</th>
      <td>9.542894</td>
      <td>8.829571</td>
      <td>17.472620</td>
      <td>29.659596</td>
      <td>15.559504</td>
      <td>18.935814</td>
    </tr>
    <tr>
      <th>2014</th>
      <td>9.884352</td>
      <td>8.814772</td>
      <td>18.153473</td>
      <td>29.687560</td>
      <td>15.184972</td>
      <td>18.274871</td>
    </tr>
    <tr>
      <th>2015</th>
      <td>10.178812</td>
      <td>8.615827</td>
      <td>18.279681</td>
      <td>29.828693</td>
      <td>14.816013</td>
      <td>18.280975</td>
    </tr>
    <tr>
      <th>2016</th>
      <td>10.609366</td>
      <td>9.099067</td>
      <td>18.717212</td>
      <td>29.282401</td>
      <td>14.255343</td>
      <td>18.036612</td>
    </tr>
    <tr>
      <th>2017</th>
      <td>10.867206</td>
      <td>9.224281</td>
      <td>19.028257</td>
      <td>29.072627</td>
      <td>13.952498</td>
      <td>17.855131</td>
    </tr>
    <tr>
      <th>2018</th>
      <td>11.060441</td>
      <td>9.157266</td>
      <td>19.624730</td>
      <td>28.841294</td>
      <td>13.617304</td>
      <td>17.698965</td>
    </tr>
    <tr>
      <th>2019</th>
      <td>11.569439</td>
      <td>9.485989</td>
      <td>20.147939</td>
      <td>28.543263</td>
      <td>13.304715</td>
      <td>16.948655</td>
    </tr>
    <tr>
      <th>2020</th>
      <td>11.918015</td>
      <td>9.704302</td>
      <td>20.940185</td>
      <td>28.368030</td>
      <td>12.315390</td>
      <td>16.754078</td>
    </tr>
    <tr>
      <th>2021</th>
      <td>12.275914</td>
      <td>9.430825</td>
      <td>21.071535</td>
      <td>28.516758</td>
      <td>12.343355</td>
      <td>16.361612</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns2</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;High school&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Bachelor&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Some college&quot;</span><span class="p">,</span>
    <span class="s2">&quot;No diploma&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Advanced&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Associate&quot;</span><span class="p">,</span>
<span class="p">]</span>

<span class="n">left</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;High school&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Some college&quot;</span><span class="p">,</span>
    <span class="s2">&quot;No diploma&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nudge</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;No diploma&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;Advanced&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="s2">&quot;Associate&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">}</span>

<span class="k">for</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">xtab</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
    <span class="n">series</span> <span class="o">=</span> <span class="n">xtab</span><span class="p">[</span><span class="n">column</span><span class="p">]</span>
    <span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">column</span> <span class="ow">in</span> <span class="n">left</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="mf">0.3</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">nudge</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mf">0.3</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">series</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">nudge</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">column</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;left&quot;</span><span class="p">)</span>


<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Year&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent&quot;</span><span class="p">,</span>
    <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="mi">1988</span><span class="p">,</span> <span class="mi">2022</span><span class="p">],</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Percent of labor force at each education level&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">2000</span><span class="p">,</span> <span class="mi">2010</span><span class="p">,</span> <span class="mi">2020</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>([&lt;matplotlib.axis.XTick at 0x7f5299ef3370&gt;,
  &lt;matplotlib.axis.XTick at 0x7f5299ef0280&gt;,
  &lt;matplotlib.axis.XTick at 0x7f529b856020&gt;],
 [Text(2000, 0, &#39;2000&#39;), Text(2010, 0, &#39;2010&#39;), Text(2020, 0, &#39;2020&#39;)])
</pre></div>
</div>
<img alt="_images/a3e1a71824b7f51ff43c54066925ba7bf71fe9973c9c9bcf1bc8686bcd5b45f4.png" src="_images/a3e1a71824b7f51ff43c54066925ba7bf71fe9973c9c9bcf1bc8686bcd5b45f4.png" />
</div>
</div>
<p>Compared to 1996, people in 2021 have more education.
The groups with associate degrees, bachelor’s degrees, or advanced degrees have grown by 3-7 percentage points.
Meanwhile, the groups with no diploma, high school, or some college have shrunk by 2-10 percentage points.</p>
<p>So the overall increase in real wages is driven by changes in education levels, not by higher wages at any level.
For example, a person with a bachelor’s degree in 2021 makes less money, on average, than a person with a bachelor’s degree in 1996.
But a random person in 2021 is more likely to have a bachelor’s degree (or more) than a person in 1996, so they make more money, on average.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">2021</span><span class="p">]</span> <span class="o">-</span> <span class="n">xtab</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">1996</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>degree
Advanced        5.868831
Associate       3.005632
Bachelor        7.116409
High school    -4.194782
No diploma     -9.837951
Some college   -1.958139
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>Simpson’s paradox does not require the variable on the <span class="math notranslate nohighlight">\(x\)</span> axis to be time.
More generally, it can happen with any variables on the <span class="math notranslate nohighlight">\(x\)</span> and <span class="math notranslate nohighlight">\(y\)</span> axes and any set of groups.
To demonstrate, let’s look at an example that doesn’t depend on time.</p>
</section>
<section id="penguins">
<h2>Penguins<a class="headerlink" href="#penguins" title="Permalink to this heading">#</a></h2>
<p>In 2014 a team of biologists published measurements they collected from three species of penguins living near Palmer Station in Antarctica.
For 344 penguins, the dataset includes body mass, flipper length, and the length and depth of their beaks: more specifically, the part of the beak called the culmen.</p>
<p>This dataset has become popular with machine learning experts because it is a fun way to demonstrate all kinds of statistical methods, especially classification algorithms.</p>
<p>Allison Horst, an environmental scientist who helped make this dataset freely available, used it to demonstrate Simpson’s paradox.
The following figure shows the example she discovered:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;penguins_raw.csv&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(344, 17)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">shorten</span><span class="p">(</span><span class="n">species</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select the first word from a string.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">species</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>


<span class="n">df</span><span class="p">[</span><span class="s2">&quot;Species2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Species&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">shorten</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">var1</span> <span class="o">=</span> <span class="s2">&quot;Flipper Length (mm)&quot;</span>
<span class="n">var2</span> <span class="o">=</span> <span class="s2">&quot;Culmen Length (mm)&quot;</span>
<span class="n">var3</span> <span class="o">=</span> <span class="s2">&quot;Culmen Depth (mm)&quot;</span>
<span class="n">var4</span> <span class="o">=</span> <span class="s2">&quot;Body Mass (g)&quot;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">Or70</span><span class="p">,</span> <span class="n">Pu50</span><span class="p">,</span> <span class="n">Gr30</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="n">Or70</span><span class="p">,</span> <span class="n">Pu50</span><span class="p">,</span> <span class="n">Gr30</span><span class="p">]</span>
<span class="n">markers</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="s2">&quot;o&quot;</span><span class="p">,</span> <span class="s2">&quot;^&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">scatterplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">var1</span><span class="p">,</span> <span class="n">var2</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Make a scatter plot.&quot;&quot;&quot;</span>
    <span class="n">grouped</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Species2&quot;</span><span class="p">)</span>
    <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
        <span class="n">style</span> <span class="o">=</span> <span class="s2">&quot;s&quot;</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">group</span><span class="p">[</span><span class="n">var1</span><span class="p">],</span>
            <span class="n">group</span><span class="p">[</span><span class="n">var2</span><span class="p">],</span>
            <span class="n">markers</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
            <span class="n">label</span><span class="o">=</span><span class="n">species</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">var1</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">var2</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper left&quot;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.98</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">))</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_line</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot a linear regression line.</span>

<span class="sd">    group: DataFrame</span>
<span class="sd">    result: linear regression result</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xs</span> <span class="o">=</span> <span class="n">group</span><span class="p">[</span><span class="n">var2</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">group</span><span class="p">[</span><span class="n">var2</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">ys</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span> <span class="o">*</span> <span class="n">result</span><span class="o">.</span><span class="n">slope</span> <span class="o">+</span> <span class="n">result</span><span class="o">.</span><span class="n">intercept</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>

<span class="n">scatterplot</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">var2</span><span class="p">,</span> <span class="n">var3</span><span class="p">)</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">var2</span><span class="p">,</span> <span class="n">var3</span><span class="p">])</span>
<span class="n">grouped</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;Species2&quot;</span><span class="p">)</span>
<span class="n">i</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">var2</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="n">var3</span><span class="p">])</span>
    <span class="n">plot_line</span><span class="p">(</span><span class="n">group</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">i</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">var2</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">var3</span><span class="p">])</span>
<span class="n">plot_line</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/29bd4c27e9044823ac421f1b56dca2322015dece9a9f45b22e459017c245b33b.png" src="_images/29bd4c27e9044823ac421f1b56dca2322015dece9a9f45b22e459017c245b33b.png" />
</div>
</div>
<p>Each marker represents the culmen length and depth of an individual penguin.
The different marker shapes represent different species: Adélie, Chinstrap, and Gentoo.
The solid lines are the lines of best fit within each species; in all three, there is a positive correlation between length and depth.
The dotted line shows the line of best fit among all of the penguins; between species, there is a negative correlation between length and depth.</p>
<p>In this example, the correlation within species has some meaning: most likely, length and depth are correlated because both are correlated with body size.
Bigger penguins have bigger beaks.</p>
<p>However, when we combine samples from different species and find that the correlation of these variables is negative, that’s a statistical artifact.
It depends on the species we choose and how many penguins of each species we measure.
So it doesn’t really mean anything.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">species</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">grouped</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">group</span><span class="p">[</span><span class="n">var2</span><span class="p">],</span> <span class="n">group</span><span class="p">[</span><span class="n">var3</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">species</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">slope</span><span class="p">)</span>

<span class="n">result</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">var2</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="n">var3</span><span class="p">])</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;overall&quot;</span><span class="p">,</span> <span class="n">result</span><span class="o">.</span><span class="n">slope</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Adelie 0.178834349642578
Chinstrap 0.2222117240036715
Gentoo 0.20484434062147577
overall -0.08502128077717656
</pre></div>
</div>
</div>
</div>
<p>These results are puzzling only if you think the trend within groups is necessarily the same as the the trend between groups.
Once you realize that’s not true, the paradox is resolved.</p>
</section>
<section id="simpsons-prescription">
<h2>Simpson’s Prescription<a class="headerlink" href="#simpsons-prescription" title="Permalink to this heading">#</a></h2>
<p>Some of the most bewildering examples of Simpson’s paradox come up in medicine, where a treatment might prove to be effective for men, effective for women, and ineffective or harmful for people.
To understand examples like that, let’s start with an analogous example from the General Social Survey.</p>
<p>Since 1973, the GSS has asked respondents, “Is there any area right around here–that is, within a mile–where you would be afraid to walk alone at night?”
Out of more than 37,000 people who have answered this question, about 38% said “Yes”.</p>
<p>Since 1974, they have also asked, “Should divorce in this country be easier or more difficult to obtain than it is now?”
About 49% of the respondents said it should be more difficult.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;divlaw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>37489
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;divlaw&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.48926351729840756
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;divlaw&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="n">plot_series_lowess</span><span class="p">(</span><span class="n">xtab</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b03246af7f52c7aa7de58ecd0857552f248e8e3ed3ae1e9bf34853e78a4413f6.png" src="_images/b03246af7f52c7aa7de58ecd0857552f248e8e3ed3ae1e9bf34853e78a4413f6.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fear&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">notna</span><span class="p">()</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>43573
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fear&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.38328781584926447
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">gss</span><span class="p">[</span><span class="s2">&quot;year&quot;</span><span class="p">],</span> <span class="n">gss</span><span class="p">[</span><span class="s2">&quot;fear&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="n">plot_series_lowess</span><span class="p">(</span><span class="n">xtab</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05df5d147c27b0d1dd0d3f2f04ab91e50359508ab7e1830f5ca991d3eaff7472.png" src="_images/05df5d147c27b0d1dd0d3f2f04ab91e50359508ab7e1830f5ca991d3eaff7472.png" />
</div>
</div>
<p>Now, if you had to guess, would you expect these responses to be correlated; that is, do you think someone who says they are afraid to walk alone at night might be more likely to say divorce should be more difficult?
As it turns out, they are slightly correlated:</p>
<ul class="simple">
<li><p>Of people who said they are afraid, about 50% said divorce should be more difficult.</p></li>
<li><p>Of people who said they are not afraid, about 49% said divorce should be more difficult.</p></li>
</ul>
<p>However, there are several reasons we should not take this correlation too seriously:</p>
<ul class="simple">
<li><p>The difference between the groups is too small to make any real difference, even if it were valid;</p></li>
<li><p>It combines results from 1974 to 2018, so it ignores the changes in both responses over that time; and</p></li>
<li><p>It is actually an artifact of Simpson’s paradox.</p></li>
</ul>
<p>To explain the third point, let’s look at responses from men and women separately. The following figure shows this breakdown.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This example doesn&#39;t work with the new 2021 data.</span>
<span class="c1"># Examples of Simpson&#39;s paradox are not always robust, but the</span>
<span class="c1"># point of this example is that it existed at a point in time.</span>

<span class="n">gss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="s2">&quot;gss_simpson.hdf&quot;</span><span class="p">,</span> <span class="s2">&quot;gss&quot;</span><span class="p">)</span>
<span class="n">gss</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(68846, 214)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="n">gss</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;fear&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fear&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;fear&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0    26872
1.0    16701
Name: fear, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">({</span><span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Male&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Female&quot;</span><span class="p">},</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">data</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Female    23420
Male      20011
Name: sex, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">make_pivot_table</span>

<span class="n">xvarname</span> <span class="o">=</span> <span class="s2">&quot;fear&quot;</span>
<span class="n">yvarname</span> <span class="o">=</span> <span class="s2">&quot;divlaw&quot;</span>
<span class="n">gvarname</span> <span class="o">=</span> <span class="s2">&quot;sex&quot;</span>
<span class="n">yvalue</span> <span class="o">=</span> <span class="mi">2</span>

<span class="n">series</span><span class="p">,</span> <span class="n">table</span> <span class="o">=</span> <span class="n">make_pivot_table</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">xvarname</span><span class="p">,</span> <span class="n">yvarname</span><span class="p">,</span> <span class="n">gvarname</span><span class="p">,</span> <span class="n">yvalue</span><span class="p">)</span>
<span class="n">series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fear
0.0    48.567299
1.0    50.683683
Name: all, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>sex</th>
      <th>Female</th>
      <th>Male</th>
    </tr>
    <tr>
      <th>fear</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>50.795290</td>
      <td>47.008671</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>51.736295</td>
      <td>47.706879</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>fear
0.0    48.567299
1.0    50.683683
Name: all, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">anchor_legend</span>

<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Female&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Male&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">)</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Overall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">series</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">series</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="n">title</span> <span class="o">=</span> <span class="s2">&quot;Should divorce be easier to obtain?&quot;</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Afraid at night&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent saying yes&quot;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;No&quot;</span><span class="p">,</span> <span class="s2">&quot;Yes&quot;</span><span class="p">])</span>
<span class="n">anchor_legend</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">)</span>
<span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/23cdd04add2cd42d53aaf9190e1e40858dbebf00349905bf11181368ba6b4cf5.png" src="_images/23cdd04add2cd42d53aaf9190e1e40858dbebf00349905bf11181368ba6b4cf5.png" />
</div>
</div>
<p>Among women, people who are afraid are less likely to say divorce should be difficult.
And among men, people who are afraid are <em>also</em> less likely to say divorce should be difficult (very slightly).
In both groups, the correlation is negative, but when we put them together, the correlation is positive.
People who are afraid are more likely to say divorce should be difficult.</p>
<p>As with the other examples of Simpson’s paradox, this might seem to be impossible.
But as with the other examples, it is not.</p>
<p>The key is to realize that there is a correlation between the sex of the respondent and their responses to both questions.
In particular, of the people who said they are not afraid, 41% are female; of the people who said they <em>are</em> afraid, 74% are female.
You can actually see these proportions in the figure:</p>
<ul class="simple">
<li><p>On the left, the square marker is 41% of the way between the male and female proportions.</p></li>
<li><p>On the right, the triangle marker is 74% of the way between the male and female proportions.</p></li>
</ul>
<p>In both cases, the overall proportion is a mixture of the male and female proportions. But it is a <em>different</em> mixture on the left and right.
That’s why Simpson’s paradox is possible.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xtab</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">crosstab</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;fear&quot;</span><span class="p">],</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;sex&quot;</span><span class="p">],</span> <span class="n">normalize</span><span class="o">=</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
<span class="n">xtab</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>sex</th>
      <th>Female</th>
      <th>Male</th>
    </tr>
    <tr>
      <th>fear</th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.0</th>
      <td>0.420412</td>
      <td>0.579588</td>
    </tr>
    <tr>
      <th>1.0</th>
      <td>0.730517</td>
      <td>0.269483</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>With this example under our belts, we are ready to take on one of the best-known examples of Simpson’s paradox.
It comes from a paper, published in 1986 by researchers at St Paul’s Hospital in London, that compared two treatments for kidney stones: (A) open surgery and (B) percutaneous nephrolithotomy.
For our purposes, it doesn’t matter what these treatments are; I’ll just call them A and B.</p>
<p>Among 350 patients who received Treatment A, 78% had a positive outcome;
among another 350 patients who received Treatment B, 83% had a positive outcome.
So it seems like Treatment B is better.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mi">78</span><span class="p">,</span> <span class="mi">83</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="n">series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    78
1    83
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Small&quot;</span><span class="p">,</span> <span class="s2">&quot;Large&quot;</span><span class="p">]</span>
<span class="n">numer</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">81</span><span class="p">,</span> <span class="mi">192</span><span class="p">],</span> <span class="p">[</span><span class="mi">234</span><span class="p">,</span> <span class="mi">55</span><span class="p">]],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">numer</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Small</th>
      <th>Large</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>81</td>
      <td>192</td>
    </tr>
    <tr>
      <th>1</th>
      <td>234</td>
      <td>55</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">denom</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="mi">87</span><span class="p">,</span> <span class="mi">263</span><span class="p">],</span> <span class="p">[</span><span class="mi">270</span><span class="p">,</span> <span class="mi">80</span><span class="p">]],</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">)</span>
<span class="n">denom</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Small</th>
      <th>Large</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>87</td>
      <td>263</td>
    </tr>
    <tr>
      <th>1</th>
      <td>270</td>
      <td>80</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">denom</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    350
1    350
dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">numer</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">denom</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0    78.000000
1    82.571429
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>However, when they split the patients into groups, they found that the results were reversed:</p>
<ul class="simple">
<li><p>Among patients with relatively small kidney stones, Treatment A was better, with a success rate of 93% compared to 86%.</p></li>
<li><p>Among patients with larger kidney stones, Treatment A was better again, with a success rate of 73% compared to 69%.</p></li>
</ul>
<p>The following figure shows these results in graphical form.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">numer</span> <span class="o">/</span> <span class="n">denom</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Small</th>
      <th>Large</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>93.103448</td>
      <td>73.003802</td>
    </tr>
    <tr>
      <th>1</th>
      <td>86.666667</td>
      <td>68.750000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;Small&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Large&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">)</span>

<span class="n">series</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Overall&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">series</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;s&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">series</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&gt;&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Treatment&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Percent&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Kidney stone positive outcomes&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="s2">&quot;A&quot;</span><span class="p">,</span> <span class="s2">&quot;B&quot;</span><span class="p">])</span>
<span class="n">anchor_legend</span><span class="p">(</span><span class="mf">1.02</span><span class="p">,</span> <span class="mf">1.02</span><span class="p">)</span>
<span class="kc">None</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f6a2aec3eb4d43341232c582e2b630e6edd9a8017c2d26428567a36e45267097.png" src="_images/f6a2aec3eb4d43341232c582e2b630e6edd9a8017c2d26428567a36e45267097.png" />
</div>
</div>
<p>This figure resembles the previous one because the explanation is the same in both cases: the overall percentages, indicated by the square and triangle markers, are mixtures of the percentages from the two groups.
But they are different mixtures on the left and right.</p>
<p>For medical reasons, patients with larger kidney stones were more likely to receive Treatment A; patients with smaller kidney stones were more likely to receive Treatment B.</p>
<p>As a result, among people who received Treatment A, 75% had large kidney stones, which is why the square marker on the left is closer to the Large group.
And among people who received Treatment B, 77% had small kidney stones, which is why the triangle marker is closer to the Small group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">props</span> <span class="o">=</span> <span class="n">denom</span><span class="o">.</span><span class="n">T</span> <span class="o">/</span> <span class="n">denom</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">props</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Small</th>
      <td>0.248571</td>
      <td>0.771429</td>
    </tr>
    <tr>
      <th>Large</th>
      <td>0.751429</td>
      <td>0.228571</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>I hope this explanation makes sense, but even if it does, you might wonder how to choose a treatment.
Suppose you are a patient and your doctor explains:</p>
<ul class="simple">
<li><p>For someone with a small kidney stone, Treatment A is better.</p></li>
<li><p>For someone with a large kidney stone, Treatment A is better.</p></li>
<li><p>But overall, Treatment B is better.</p></li>
</ul>
<p>Which treatment should you choose?
Other considerations being equal, you should choose A because it has a higher chance of success for any patient, regardless of stone size.
The apparent success of B is a statistical artifact, the result of two causal relationships:</p>
<ul class="simple">
<li><p>Smaller stones are more likely to get Treatment B.</p></li>
<li><p>Smaller stones are more likely to lead to a good outcome.</p></li>
</ul>
<p>Looking at the overall results, Treatment B only looks good because it is used for easier cases; Treatment A only looks bad because it is used for the hard cases.
If you are choosing a treatment, you should look at the results within the groups, not between the groups.</p>
</section>
<section id="do-vaccines-work-hint-yes">
<h2>Do vaccines work? Hint: yes.<a class="headerlink" href="#do-vaccines-work-hint-yes" title="Permalink to this heading">#</a></h2>
<p>Now that we have mastered Simpson’s paradox, let’s get back to the example from the beginning of the chapter, the newsletter that went viral with the claim that “Vaccinated English adults under 60 are dying at twice the rate of unvaccinated people the same age”.</p>
<p>The newsletter includes a graph based on data from the U.K. Office for National Statistics.
I downloaded the same data and replicated the graph, which looks like this:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbdca5329-b20b-4518-a733-fff84cc22124_1098x681.png</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/deathsbyvaccinationstatusengland</span>
<span class="c1"># https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/deathsbyvaccinationstatusengland/deathsoccurringbetween2januaryand24september2021/datasetfinalcorrected3.xlsx</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;datasetfinalcorrected3.xlsx&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Table 4&quot;</span><span class="p">,</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
    <span class="n">skipfooter</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Week ending</th>
      <th>Week number</th>
      <th>Vaccination status</th>
      <th>Age group</th>
      <th>Number of deaths</th>
      <th>Population</th>
      <th>Percentage of total age-group population</th>
      <th>Age-specific rate per 100,000</th>
      <th>Unnamed: 8</th>
      <th>Lower confidence limit</th>
      <th>Upper confidence limit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>603</th>
      <td>2021-09-17</td>
      <td>37</td>
      <td>Second dose</td>
      <td>80+</td>
      <td>4000</td>
      <td>2437192</td>
      <td>96.3</td>
      <td>164.1</td>
      <td>NaN</td>
      <td>159.1</td>
      <td>169.3</td>
    </tr>
    <tr>
      <th>604</th>
      <td>2021-09-24</td>
      <td>38</td>
      <td>Second dose</td>
      <td>10-59</td>
      <td>400</td>
      <td>17924346</td>
      <td>66.4</td>
      <td>2.2</td>
      <td>NaN</td>
      <td>2</td>
      <td>2.5</td>
    </tr>
    <tr>
      <th>605</th>
      <td>2021-09-24</td>
      <td>38</td>
      <td>Second dose</td>
      <td>60-69</td>
      <td>638</td>
      <td>4973647</td>
      <td>93.8</td>
      <td>12.8</td>
      <td>NaN</td>
      <td>11.9</td>
      <td>13.9</td>
    </tr>
    <tr>
      <th>606</th>
      <td>2021-09-24</td>
      <td>38</td>
      <td>Second dose</td>
      <td>70-79</td>
      <td>1553</td>
      <td>4171936</td>
      <td>96.3</td>
      <td>37.2</td>
      <td>NaN</td>
      <td>35.4</td>
      <td>39.1</td>
    </tr>
    <tr>
      <th>607</th>
      <td>2021-09-24</td>
      <td>38</td>
      <td>Second dose</td>
      <td>80+</td>
      <td>3839</td>
      <td>2439328</td>
      <td>96.3</td>
      <td>157.4</td>
      <td>NaN</td>
      <td>152.4</td>
      <td>162.4</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Age-specific rate per 100,000&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Week ending&#39;, &#39;Week number&#39;, &#39;Vaccination status&#39;, &#39;Age group&#39;,
       &#39;Number of deaths&#39;, &#39;Population&#39;,
       &#39;Percentage of total age-group population&#39;,
       &#39;Age-specific rate per 100,000&#39;, &#39;Unnamed: 8&#39;, &#39;Lower confidence limit&#39;,
       &#39;Upper confidence limit&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">&quot;Week ending&quot;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Vaccination status&quot;</span><span class="p">,</span> <span class="s2">&quot;Age group&quot;</span><span class="p">],</span>
    <span class="n">values</span><span class="o">=</span><span class="s2">&quot;Age-specific rate per 100,000&quot;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Vaccination status</th>
      <th colspan="4" halign="left">21 days or more after first dose</th>
      <th colspan="4" halign="left">Second dose</th>
      <th colspan="4" halign="left">Unvaccinated</th>
      <th colspan="4" halign="left">Within 21 days of first dose</th>
    </tr>
    <tr>
      <th>Age group</th>
      <th>10-59</th>
      <th>60-69</th>
      <th>70-79</th>
      <th>80+</th>
      <th>10-59</th>
      <th>60-69</th>
      <th>70-79</th>
      <th>80+</th>
      <th>10-59</th>
      <th>60-69</th>
      <th>70-79</th>
      <th>80+</th>
      <th>10-59</th>
      <th>60-69</th>
      <th>70-79</th>
      <th>80+</th>
    </tr>
    <tr>
      <th>Week ending</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-01-08</th>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>190.1</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>8.1</td>
      <td>3.7</td>
      <td>27.3</td>
      <td>69.8</td>
      <td>413.4</td>
      <td>0.7</td>
      <td>10.8</td>
      <td>32.6</td>
      <td>84.5</td>
    </tr>
    <tr>
      <th>2021-01-15</th>
      <td>2.7</td>
      <td>NaN</td>
      <td>104.3</td>
      <td>186.8</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>32.8</td>
      <td>4.0</td>
      <td>30.1</td>
      <td>78.8</td>
      <td>645.1</td>
      <td>1.9</td>
      <td>19.7</td>
      <td>25.8</td>
      <td>100.6</td>
    </tr>
    <tr>
      <th>2021-01-22</th>
      <td>2.0</td>
      <td>7.5</td>
      <td>107.2</td>
      <td>175.7</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>52.8</td>
      <td>4.1</td>
      <td>30.8</td>
      <td>95.5</td>
      <td>1198.0</td>
      <td>1.7</td>
      <td>21.5</td>
      <td>25.4</td>
      <td>122.0</td>
    </tr>
    <tr>
      <th>2021-01-29</th>
      <td>2.3</td>
      <td>14.4</td>
      <td>65.0</td>
      <td>152.3</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>53.4</td>
      <td>3.7</td>
      <td>29.2</td>
      <td>112.2</td>
      <td>1571.9</td>
      <td>1.8</td>
      <td>18.3</td>
      <td>26.3</td>
      <td>180.9</td>
    </tr>
    <tr>
      <th>2021-02-05</th>
      <td>1.5</td>
      <td>15.0</td>
      <td>59.9</td>
      <td>157.5</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>64.7</td>
      <td>3.6</td>
      <td>26.5</td>
      <td>168.2</td>
      <td>1456.1</td>
      <td>3.4</td>
      <td>11.9</td>
      <td>22.8</td>
      <td>223.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">recent</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">index</span> <span class="o">&gt;=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2021-3-19&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="p">[</span><span class="n">recent</span><span class="p">][</span><span class="s2">&quot;Second dose&quot;</span><span class="p">,</span> <span class="s2">&quot;10-59&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="n">recent</span><span class="p">][</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">,</span> <span class="s2">&quot;10-59&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">margins</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">tight</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Weekly deaths per 100k&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;All cause death rates, ages 10–59&quot;</span><span class="p">,</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.6</span><span class="p">],</span>
    <span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/72169abf1be8d0180bdc9fafe97a00ebe84ad027e72ef4d12a18f4cc086402f2.png" src="_images/72169abf1be8d0180bdc9fafe97a00ebe84ad027e72ef4d12a18f4cc086402f2.png" />
</div>
</div>
<p>The lines show weekly death rates from all causes, per 100,000 people age 10-59, from March to September  2021.
The solid line represents people who were fully vaccinated; the dashed line represents people who were unvaccinated.</p>
<p>The journalist I won’t name concludes: “Vaccinated people under 60 are twice as likely to die as unvaccinated people. And overall deaths in Britain are running well above normal. I don’t know how to explain this other than vaccine-caused mortality.”
Well, I do.</p>
<p>There are two things wrong with his interpretation of the data:</p>
<ul class="simple">
<li><p>First, by choosing one age group and time interval, he has cherry-picked data that support his conclusion and ignored data that don’t.</p></li>
<li><p>Second, because the data combine a wide range of ages, from 10 to 59, he has been fooled by Simpson’s paradox.</p></li>
</ul>
<p>Let’s debunk one thing at a time.
First, here’s what the graph looks like if we include the entire dataset, which starts in January:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2021-01-01&quot;</span><span class="p">)</span>
<span class="n">end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2021-09-30&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">options</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Weekly deaths per 100k&quot;</span><span class="p">,</span> <span class="n">xlim</span><span class="o">=</span><span class="p">[</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span><span class="p">[</span><span class="s2">&quot;Second dose&quot;</span><span class="p">,</span> <span class="s2">&quot;10-59&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">,</span> <span class="s2">&quot;10-59&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;All cause death rates, ages 10–59&quot;</span><span class="p">,</span> <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">4.7</span><span class="p">],</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/aa044d2486473d2ecc699ca451b7939ce4926234eedfb79c6fcf76f1e5748162.png" src="_images/aa044d2486473d2ecc699ca451b7939ce4926234eedfb79c6fcf76f1e5748162.png" />
</div>
</div>
<p>Overall death rates were “running well above normal” in January and February, when almost no one in the 10-59 age range had been vaccinated.
Those deaths cannot have been caused by the vaccine; in fact, they were caused by a surge in the Alpha variant of COVID-19.</p>
<p>The unnamed journalist leaves out the time range that contradicts him; he also leaves out the age ranges that contradict him.
In all of the older age ranges, death rates were consistently lower among people who had been vaccinated.
The following figures show death rates for people in their 60s and 70s, and people over 80.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ages</span> <span class="o">=</span> <span class="s2">&quot;60-69&quot;</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Second dose&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;All cause death rates, ages 60–69&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c9a73c388ce3e0d1c85369130d7248674292a40511a68274e9e58be278324b99.png" src="_images/c9a73c388ce3e0d1c85369130d7248674292a40511a68274e9e58be278324b99.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ages</span> <span class="o">=</span> <span class="s2">&quot;70-79&quot;</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Second dose&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;All cause death rates, ages 70–79&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ea2f930cd9c80305c2f42513695552d9fd0c8820795767d5761ba08a2f30beaf.png" src="_images/ea2f930cd9c80305c2f42513695552d9fd0c8820795767d5761ba08a2f30beaf.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ages</span> <span class="o">=</span> <span class="s2">&quot;80+&quot;</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">)</span>
<span class="n">table</span><span class="p">[</span><span class="s2">&quot;Second dose&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;All cause death rates, ages 80+&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/05016f1ecdb0344bba9bf671b3dc20aa7d5acda0b3afd2c592081eca59316fd9.png" src="_images/05016f1ecdb0344bba9bf671b3dc20aa7d5acda0b3afd2c592081eca59316fd9.png" />
</div>
</div>
<p>Notice that the <span class="math notranslate nohighlight">\(y\)</span> axes are on different scales; death rates are much higher in the older age groups.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ages</span> <span class="o">=</span> <span class="s2">&quot;80+&quot;</span>
<span class="n">ratio</span> <span class="o">=</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span> <span class="o">/</span> <span class="n">table</span><span class="p">[</span><span class="s2">&quot;Second dose&quot;</span><span class="p">,</span> <span class="n">ages</span><span class="p">]</span>
<span class="n">ratio</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Week ending
2021-01-08    51.037037
2021-01-15    19.667683
2021-01-22    22.689394
2021-01-29    29.436330
2021-02-05    22.505410
2021-02-12    19.391549
2021-02-19    16.596708
2021-02-26    11.674699
2021-03-05    11.043411
2021-03-12     9.223724
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>In all of these groups, death rates are substantially lower for people who are vaccinated, which is what we expect from a vaccine that has been shown in large clinical trials to be safe and effective.</p>
<p>So what explains the apparent reversal among people between 10 and 59 years old?
It is a statistical artifact caused by Simpson’s paradox.
Specifically, it is caused by two correlations:</p>
<ul class="simple">
<li><p>Within this age group, older people were more likely to be vaccinated, and</p></li>
<li><p>Older people were more likely to die of any cause, just because they are older.</p></li>
</ul>
<p>Both of these correlations are strong.
For example, at the beginning of August, about 88% of people at the high end of this age range had been vaccinated; <em>none</em> of the people at the low end had.
And the death rate for people at the high end was 54 times higher than for people at the low end.</p>
<p>To show that these correlations are strong enough to explain the observed difference in death rates, I will follow an analysis by epidemiologist Jeffrey Morris, who refuted the unreliable journalist’s claims within days of their publication.
He divides the excessively wide 10-59 year age group into 10 groups, each 5 years wide.</p>
<p>To estimate normal, pre-pandemic death rates in these groups, he uses 2019 data from the U.K. Office of National Statistics.
To estimate the vaccination rate in each group, he uses data from the coronavirus dashboard provided by the U.K. Health Security Agency.
Finally, to estimate the fraction of people in each age group, he uses data from a web site called PopulationPyramid, which organizes and publishes data from the United Nations Department of Economic and Social Affairs.
Not to get lost in the details, these are all reliable data sources.</p>
<p>Combining these datasets, Morris is able to compute the distribution of ages in the vaccinated and unvaccinated groups at the beginning of August 2021 (choosing a point near the middle of the interval in the original graph).
The following figure shows the results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;10-14&quot;</span><span class="p">,</span>
    <span class="s2">&quot;15-19&quot;</span><span class="p">,</span>
    <span class="s2">&quot;20-24&quot;</span><span class="p">,</span>
    <span class="s2">&quot;25-29&quot;</span><span class="p">,</span>
    <span class="s2">&quot;30-34&quot;</span><span class="p">,</span>
    <span class="s2">&quot;35-39&quot;</span><span class="p">,</span>
    <span class="s2">&quot;40-44&quot;</span><span class="p">,</span>
    <span class="s2">&quot;45-49&quot;</span><span class="p">,</span>
    <span class="s2">&quot;50-54&quot;</span><span class="p">,</span>
    <span class="s2">&quot;55-59&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate</span> <span class="o">=</span> <span class="p">[</span><span class="mf">8.8</span><span class="p">,</span> <span class="mf">23.1</span><span class="p">,</span> <span class="mf">39.1</span><span class="p">,</span> <span class="mf">48.4</span><span class="p">,</span> <span class="mf">66.9</span><span class="p">,</span> <span class="mf">97.3</span><span class="p">,</span> <span class="mf">143.3</span><span class="p">,</span> <span class="mf">219.6</span><span class="p">,</span> <span class="mf">321.5</span><span class="p">,</span> <span class="mf">478.2</span><span class="p">]</span>
<span class="n">pct_vax</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">26.7</span><span class="p">,</span> <span class="mf">59.6</span><span class="p">,</span> <span class="mf">59.7</span><span class="p">,</span> <span class="mf">63.3</span><span class="p">,</span> <span class="mf">63.3</span><span class="p">,</span> <span class="mf">74.6</span><span class="p">,</span> <span class="mf">80.5</span><span class="p">,</span> <span class="mf">85.6</span><span class="p">,</span> <span class="mf">88.2</span><span class="p">]</span>
<span class="n">pct_pop</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.9</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mf">6.2</span><span class="p">,</span> <span class="mf">6.8</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mf">6.0</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">,</span> <span class="mf">7.0</span><span class="p">,</span> <span class="mf">6.6</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">rate</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>54.340909090909086
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">rate</span><span class="o">=</span><span class="n">rate</span><span class="p">,</span> <span class="n">pct_vax</span><span class="o">=</span><span class="n">pct_vax</span><span class="p">,</span> <span class="n">pct_pop</span><span class="o">=</span><span class="n">pct_pop</span><span class="p">),</span> <span class="n">index</span><span class="p">)</span>
<span class="n">sheet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>pct_vax</th>
      <th>pct_pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10-14</th>
      <td>8.8</td>
      <td>0.0</td>
      <td>5.9</td>
    </tr>
    <tr>
      <th>15-19</th>
      <td>23.1</td>
      <td>26.7</td>
      <td>5.5</td>
    </tr>
    <tr>
      <th>20-24</th>
      <td>39.1</td>
      <td>59.6</td>
      <td>6.2</td>
    </tr>
    <tr>
      <th>25-29</th>
      <td>48.4</td>
      <td>59.7</td>
      <td>6.8</td>
    </tr>
    <tr>
      <th>30-34</th>
      <td>66.9</td>
      <td>63.3</td>
      <td>6.7</td>
    </tr>
    <tr>
      <th>35-39</th>
      <td>97.3</td>
      <td>63.3</td>
      <td>6.6</td>
    </tr>
    <tr>
      <th>40-44</th>
      <td>143.3</td>
      <td>74.6</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>45-49</th>
      <td>219.6</td>
      <td>80.5</td>
      <td>6.6</td>
    </tr>
    <tr>
      <th>50-54</th>
      <td>321.5</td>
      <td>85.6</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>55-59</th>
      <td>478.2</td>
      <td>88.2</td>
      <td>6.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_pop&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_pop&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sheet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>pct_vax</th>
      <th>pct_pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10-14</th>
      <td>8.8</td>
      <td>0.0</td>
      <td>0.092332</td>
    </tr>
    <tr>
      <th>15-19</th>
      <td>23.1</td>
      <td>26.7</td>
      <td>0.086072</td>
    </tr>
    <tr>
      <th>20-24</th>
      <td>39.1</td>
      <td>59.6</td>
      <td>0.097027</td>
    </tr>
    <tr>
      <th>25-29</th>
      <td>48.4</td>
      <td>59.7</td>
      <td>0.106416</td>
    </tr>
    <tr>
      <th>30-34</th>
      <td>66.9</td>
      <td>63.3</td>
      <td>0.104851</td>
    </tr>
    <tr>
      <th>35-39</th>
      <td>97.3</td>
      <td>63.3</td>
      <td>0.103286</td>
    </tr>
    <tr>
      <th>40-44</th>
      <td>143.3</td>
      <td>74.6</td>
      <td>0.093897</td>
    </tr>
    <tr>
      <th>45-49</th>
      <td>219.6</td>
      <td>80.5</td>
      <td>0.103286</td>
    </tr>
    <tr>
      <th>50-54</th>
      <td>321.5</td>
      <td>85.6</td>
      <td>0.109546</td>
    </tr>
    <tr>
      <th>55-59</th>
      <td>478.2</td>
      <td>88.2</td>
      <td>0.103286</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax_age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_pop&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax&quot;</span><span class="p">]</span>
<span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax_age&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax_age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sheet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>pct_vax</th>
      <th>pct_pop</th>
      <th>pct_vax_age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10-14</th>
      <td>8.8</td>
      <td>0.0</td>
      <td>0.092332</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>15-19</th>
      <td>23.1</td>
      <td>26.7</td>
      <td>0.086072</td>
      <td>0.037419</td>
    </tr>
    <tr>
      <th>20-24</th>
      <td>39.1</td>
      <td>59.6</td>
      <td>0.097027</td>
      <td>0.094159</td>
    </tr>
    <tr>
      <th>25-29</th>
      <td>48.4</td>
      <td>59.7</td>
      <td>0.106416</td>
      <td>0.103444</td>
    </tr>
    <tr>
      <th>30-34</th>
      <td>66.9</td>
      <td>63.3</td>
      <td>0.104851</td>
      <td>0.108069</td>
    </tr>
    <tr>
      <th>35-39</th>
      <td>97.3</td>
      <td>63.3</td>
      <td>0.103286</td>
      <td>0.106456</td>
    </tr>
    <tr>
      <th>40-44</th>
      <td>143.3</td>
      <td>74.6</td>
      <td>0.093897</td>
      <td>0.114054</td>
    </tr>
    <tr>
      <th>45-49</th>
      <td>219.6</td>
      <td>80.5</td>
      <td>0.103286</td>
      <td>0.135382</td>
    </tr>
    <tr>
      <th>50-54</th>
      <td>321.5</td>
      <td>85.6</td>
      <td>0.109546</td>
      <td>0.152684</td>
    </tr>
    <tr>
      <th>55-59</th>
      <td>478.2</td>
      <td>88.2</td>
      <td>0.103286</td>
      <td>0.148332</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_novax_age&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_pop&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="mi">100</span> <span class="o">-</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax&quot;</span><span class="p">])</span>
<span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_novax_age&quot;</span><span class="p">]</span> <span class="o">/=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_novax_age&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">sheet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>pct_vax</th>
      <th>pct_pop</th>
      <th>pct_vax_age</th>
      <th>pct_novax_age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10-14</th>
      <td>8.8</td>
      <td>0.0</td>
      <td>0.092332</td>
      <td>0.000000</td>
      <td>0.239297</td>
    </tr>
    <tr>
      <th>15-19</th>
      <td>23.1</td>
      <td>26.7</td>
      <td>0.086072</td>
      <td>0.037419</td>
      <td>0.163513</td>
    </tr>
    <tr>
      <th>20-24</th>
      <td>39.1</td>
      <td>59.6</td>
      <td>0.097027</td>
      <td>0.094159</td>
      <td>0.101592</td>
    </tr>
    <tr>
      <th>25-29</th>
      <td>48.4</td>
      <td>59.7</td>
      <td>0.106416</td>
      <td>0.103444</td>
      <td>0.111147</td>
    </tr>
    <tr>
      <th>30-34</th>
      <td>66.9</td>
      <td>63.3</td>
      <td>0.104851</td>
      <td>0.108069</td>
      <td>0.099730</td>
    </tr>
    <tr>
      <th>35-39</th>
      <td>97.3</td>
      <td>63.3</td>
      <td>0.103286</td>
      <td>0.106456</td>
      <td>0.098241</td>
    </tr>
    <tr>
      <th>40-44</th>
      <td>143.3</td>
      <td>74.6</td>
      <td>0.093897</td>
      <td>0.114054</td>
      <td>0.061812</td>
    </tr>
    <tr>
      <th>45-49</th>
      <td>219.6</td>
      <td>80.5</td>
      <td>0.103286</td>
      <td>0.135382</td>
      <td>0.052199</td>
    </tr>
    <tr>
      <th>50-54</th>
      <td>321.5</td>
      <td>85.6</td>
      <td>0.109546</td>
      <td>0.152684</td>
      <td>0.040883</td>
    </tr>
    <tr>
      <th>55-59</th>
      <td>478.2</td>
      <td>88.2</td>
      <td>0.103286</td>
      <td>0.148332</td>
      <td>0.031587</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Pmf</span>

<span class="n">pmf_novax</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_novax_age&quot;</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">pmf_vax</span> <span class="o">=</span> <span class="n">Pmf</span><span class="p">(</span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax_age&quot;</span><span class="p">],</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">pmf_novax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">)</span>
<span class="n">pmf_vax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age group&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Fraction of population&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of ages&quot;</span><span class="p">,</span>
    <span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.26</span><span class="p">],</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/99bc55e322bfc81a0d20d8135e0228551a101e62b3c6e743affc91cb43eeadaa.png" src="_images/99bc55e322bfc81a0d20d8135e0228551a101e62b3c6e743affc91cb43eeadaa.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">17</span><span class="p">,</span> <span class="mi">22</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">42</span><span class="p">,</span> <span class="mi">47</span><span class="p">,</span> <span class="mi">52</span><span class="p">,</span> <span class="mi">57</span><span class="p">]</span>

<span class="n">ps</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_novax_age&quot;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span>
    <span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C4&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span>
<span class="p">)</span>

<span class="n">ps</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax_age&quot;</span><span class="p">]</span>
<span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">xs</span><span class="p">,</span> <span class="n">weights</span><span class="o">=</span><span class="n">ps</span><span class="p">,</span> <span class="n">cut</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Age group&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Likelihood&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Distribution of ages&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">([</span><span class="mf">0.005</span><span class="p">,</span> <span class="mf">0.015</span><span class="p">,</span> <span class="mf">0.025</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>([&lt;matplotlib.axis.YTick at 0x7f52972af5e0&gt;,
  &lt;matplotlib.axis.YTick at 0x7f52972ad720&gt;,
  &lt;matplotlib.axis.YTick at 0x7f52973ab100&gt;],
 [Text(0, 0.005, &#39;0.005&#39;), Text(0, 0.015, &#39;0.015&#39;), Text(0, 0.025, &#39;0.025&#39;)])
</pre></div>
</div>
<img alt="_images/fadff02b42044f990443986bc9f0b1c54ef5d8e5fa400954a251d0d64cffdfe1.png" src="_images/fadff02b42044f990443986bc9f0b1c54ef5d8e5fa400954a251d0d64cffdfe1.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pmf_vax</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">xs</span>
<span class="n">pmf_novax</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">xs</span>
<span class="n">pmf_vax</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">pmf_novax</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(40.445446993711194, 26.68938091143594)
</pre></div>
</div>
</div>
</div>
<p>At this point during the rollout of the vaccines, people who were vaccinated were more likely to be at the high end of the age range, and people who were unvaccinated were more likely to be at the low end.
Among the vaccinated, the average age was about 40; among the unvaccinated, it was 27.</p>
<p>Now, for the sake of this example, let’s imagine that there are no deaths due to COVID, and no deaths due to the vaccine.
Based only on the distribution of ages and the death rates from 2019, we can compute the expected death rates for the vaccinated and unvaccinated groups.
The ratio of these two rates is about 2.4.</p>
<p>So, prior to the pandemic, we would expect people with the age distribution of the vaccinated to die at a rate 2.4 times higher than people with the age distribution of the unvaccinated, just because they are older.</p>
<p>In reality, the pandemic increased the death rate in both groups, so the actual ratio was smaller, about 1.8.
Thus, the results the journalist presented are not evidence that vaccines are harmful; as Morris concludes, they are “not unexpected, and can be fully explained by the Simpson’s paradox artifact”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>pct_vax</th>
      <th>pct_pop</th>
      <th>pct_vax_age</th>
      <th>pct_novax_age</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10-14</th>
      <td>8.8</td>
      <td>0.0</td>
      <td>0.092332</td>
      <td>0.000000</td>
      <td>0.239297</td>
    </tr>
    <tr>
      <th>15-19</th>
      <td>23.1</td>
      <td>26.7</td>
      <td>0.086072</td>
      <td>0.037419</td>
      <td>0.163513</td>
    </tr>
    <tr>
      <th>20-24</th>
      <td>39.1</td>
      <td>59.6</td>
      <td>0.097027</td>
      <td>0.094159</td>
      <td>0.101592</td>
    </tr>
    <tr>
      <th>25-29</th>
      <td>48.4</td>
      <td>59.7</td>
      <td>0.106416</td>
      <td>0.103444</td>
      <td>0.111147</td>
    </tr>
    <tr>
      <th>30-34</th>
      <td>66.9</td>
      <td>63.3</td>
      <td>0.104851</td>
      <td>0.108069</td>
      <td>0.099730</td>
    </tr>
    <tr>
      <th>35-39</th>
      <td>97.3</td>
      <td>63.3</td>
      <td>0.103286</td>
      <td>0.106456</td>
      <td>0.098241</td>
    </tr>
    <tr>
      <th>40-44</th>
      <td>143.3</td>
      <td>74.6</td>
      <td>0.093897</td>
      <td>0.114054</td>
      <td>0.061812</td>
    </tr>
    <tr>
      <th>45-49</th>
      <td>219.6</td>
      <td>80.5</td>
      <td>0.103286</td>
      <td>0.135382</td>
      <td>0.052199</td>
    </tr>
    <tr>
      <th>50-54</th>
      <td>321.5</td>
      <td>85.6</td>
      <td>0.109546</td>
      <td>0.152684</td>
      <td>0.040883</td>
    </tr>
    <tr>
      <th>55-59</th>
      <td>478.2</td>
      <td>88.2</td>
      <td>0.103286</td>
      <td>0.148332</td>
      <td>0.031587</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;death_vax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_vax_age&quot;</span><span class="p">]</span>
<span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;death_novax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;pct_novax_age&quot;</span><span class="p">]</span>
<span class="n">sheet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>pct_vax</th>
      <th>pct_pop</th>
      <th>pct_vax_age</th>
      <th>pct_novax_age</th>
      <th>death_vax</th>
      <th>death_novax</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10-14</th>
      <td>8.8</td>
      <td>0.0</td>
      <td>0.092332</td>
      <td>0.000000</td>
      <td>0.239297</td>
      <td>0.000000</td>
      <td>2.105810</td>
    </tr>
    <tr>
      <th>15-19</th>
      <td>23.1</td>
      <td>26.7</td>
      <td>0.086072</td>
      <td>0.037419</td>
      <td>0.163513</td>
      <td>0.864387</td>
      <td>3.777140</td>
    </tr>
    <tr>
      <th>20-24</th>
      <td>39.1</td>
      <td>59.6</td>
      <td>0.097027</td>
      <td>0.094159</td>
      <td>0.101592</td>
      <td>3.681603</td>
      <td>3.972229</td>
    </tr>
    <tr>
      <th>25-29</th>
      <td>48.4</td>
      <td>59.7</td>
      <td>0.106416</td>
      <td>0.103444</td>
      <td>0.111147</td>
      <td>5.006692</td>
      <td>5.379523</td>
    </tr>
    <tr>
      <th>30-34</th>
      <td>66.9</td>
      <td>63.3</td>
      <td>0.104851</td>
      <td>0.108069</td>
      <td>0.099730</td>
      <td>7.229811</td>
      <td>6.671929</td>
    </tr>
    <tr>
      <th>35-39</th>
      <td>97.3</td>
      <td>63.3</td>
      <td>0.103286</td>
      <td>0.106456</td>
      <td>0.098241</td>
      <td>10.358164</td>
      <td>9.558886</td>
    </tr>
    <tr>
      <th>40-44</th>
      <td>143.3</td>
      <td>74.6</td>
      <td>0.093897</td>
      <td>0.114054</td>
      <td>0.061812</td>
      <td>16.344008</td>
      <td>8.857590</td>
    </tr>
    <tr>
      <th>45-49</th>
      <td>219.6</td>
      <td>80.5</td>
      <td>0.103286</td>
      <td>0.135382</td>
      <td>0.052199</td>
      <td>29.729969</td>
      <td>11.462921</td>
    </tr>
    <tr>
      <th>50-54</th>
      <td>321.5</td>
      <td>85.6</td>
      <td>0.109546</td>
      <td>0.152684</td>
      <td>0.040883</td>
      <td>49.087972</td>
      <td>13.143951</td>
    </tr>
    <tr>
      <th>55-59</th>
      <td>478.2</td>
      <td>88.2</td>
      <td>0.103286</td>
      <td>0.148332</td>
      <td>0.031587</td>
      <td>70.932358</td>
      <td>15.104973</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;death_vax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;death_novax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(193.23496549826214, 80.03495027498823)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;death_vax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span> <span class="o">/</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;death_novax&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.4143822771718533
</pre></div>
</div>
</div>
</div>
</section>
<section id="debunk-redux">
<h2>Debunk Redux<a class="headerlink" href="#debunk-redux" title="Permalink to this heading">#</a></h2>
<p>So far we have used only data that was publicly available in November 2021, but if we take advantage of more recent data, we can get a clearer picture of what was happening then and what has happened since.</p>
<p>In more recent reports, data from the U.K. Office of National Statistics are broken into smaller age groups.
Instead of one group from ages 10 to 59, we have three groups from 18 to 39, 40 to 49, and 50 to 59.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://www.ons.gov.uk/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/deathsbyvaccinationstatusengland</span>
<span class="c1"># https://www.ons.gov.uk/file?uri=/peoplepopulationandcommunity/birthsdeathsandmarriages/deaths/datasets/deathsbyvaccinationstatusengland/deathsoccurringbetween1january2021and31march2022/referencetable20220516accessiblecorrected.xlsx</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;referencetable20220516accessiblecorrected.xlsx&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Table 2&quot;</span><span class="p">,</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cause of Death</th>
      <th>Year</th>
      <th>Month</th>
      <th>Age group</th>
      <th>Vaccination status</th>
      <th>Count of deaths</th>
      <th>Person-years</th>
      <th>Age-standardised mortality rate / 100,000 person-years</th>
      <th>Noted as Unreliable</th>
      <th>Lower confidence limit</th>
      <th>Upper confidence limit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2200</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>First dose, at least 21 days ago</td>
      <td>57</td>
      <td>191</td>
      <td>29817.6</td>
      <td>NaN</td>
      <td>22582.1</td>
      <td>38633</td>
    </tr>
    <tr>
      <th>2201</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Second dose, less than 21 days ago</td>
      <td>&lt;3</td>
      <td>7</td>
      <td>x</td>
      <td>NaN</td>
      <td>x</td>
      <td>x</td>
    </tr>
    <tr>
      <th>2202</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Second dose, at least 21 days ago</td>
      <td>515</td>
      <td>1415</td>
      <td>36402.2</td>
      <td>NaN</td>
      <td>33325.7</td>
      <td>39686.4</td>
    </tr>
    <tr>
      <th>2203</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Third dose or booster, less than 21 days ago</td>
      <td>20</td>
      <td>67</td>
      <td>29992.6</td>
      <td>NaN</td>
      <td>18312.4</td>
      <td>46323.7</td>
    </tr>
    <tr>
      <th>2204</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Third dose or booster, at least 21 days ago</td>
      <td>7024</td>
      <td>36170</td>
      <td>19419.5</td>
      <td>NaN</td>
      <td>18967.9</td>
      <td>19879</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;Cause of Death&#39;, &#39;Year&#39;, &#39;Month&#39;, &#39;Age group&#39;, &#39;Vaccination status&#39;,
       &#39;Count of deaths&#39;, &#39;Person-years&#39;,
       &#39;Age-standardised mortality rate / 100,000 person-years&#39;,
       &#39;Noted as Unreliable&#39;, &#39;Lower confidence limit&#39;,
       &#39;Upper confidence limit&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate</span> <span class="o">=</span> <span class="s2">&quot;Age-standardised mortality rate / 100,000 person-years&quot;</span>
<span class="n">df</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">rate</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span> <span class="o">/</span> <span class="mi">52</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">count</span> <span class="o">=</span> <span class="s2">&quot;Count of deaths&quot;</span>
<span class="n">df</span><span class="p">[</span><span class="n">count</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;&lt;3&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_cause</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Cause of Death&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;All causes&quot;</span>
<span class="n">all_cause_df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">all_cause</span><span class="p">]</span>
<span class="n">all_cause_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(735, 13)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">all_cause_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Age group&quot;</span><span class="p">,</span> <span class="s2">&quot;Vaccination status&quot;</span><span class="p">],</span>
    <span class="n">values</span><span class="o">=</span><span class="s2">&quot;rate&quot;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">table</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Age group</th>
      <th colspan="7" halign="left">18-39</th>
      <th colspan="3" halign="left">40-49</th>
      <th>...</th>
      <th colspan="3" halign="left">80-89</th>
      <th colspan="7" halign="left">90+</th>
    </tr>
    <tr>
      <th>Vaccination status</th>
      <th>First dose, at least 21 days ago</th>
      <th>First dose, less than 21 days ago</th>
      <th>Second dose, at least 21 days ago</th>
      <th>Second dose, less than 21 days ago</th>
      <th>Third dose or booster, at least 21 days ago</th>
      <th>Third dose or booster, less than 21 days ago</th>
      <th>Unvaccinated</th>
      <th>First dose, at least 21 days ago</th>
      <th>First dose, less than 21 days ago</th>
      <th>Second dose, at least 21 days ago</th>
      <th>...</th>
      <th>Third dose or booster, at least 21 days ago</th>
      <th>Third dose or booster, less than 21 days ago</th>
      <th>Unvaccinated</th>
      <th>First dose, at least 21 days ago</th>
      <th>First dose, less than 21 days ago</th>
      <th>Second dose, at least 21 days ago</th>
      <th>Second dose, less than 21 days ago</th>
      <th>Third dose or booster, at least 21 days ago</th>
      <th>Third dose or booster, less than 21 days ago</th>
      <th>Unvaccinated</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-01-01</th>
      <td>2.305769</td>
      <td>0.886538</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.338462</td>
      <td>1.480769</td>
      <td>1.457692</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>450.526923</td>
      <td>559.213462</td>
      <td>379.090385</td>
      <td>128.263462</td>
      <td>106.234615</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1142.453846</td>
    </tr>
    <tr>
      <th>2021-02-01</th>
      <td>1.313462</td>
      <td>2.232692</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.996154</td>
      <td>2.419231</td>
      <td>3.700000</td>
      <td>NaN</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>994.521154</td>
      <td>439.519231</td>
      <td>460.546154</td>
      <td>148.984615</td>
      <td>300.221154</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1736.271154</td>
    </tr>
    <tr>
      <th>2021-03-01</th>
      <td>1.767308</td>
      <td>0.982692</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.836538</td>
      <td>4.726923</td>
      <td>2.678846</td>
      <td>1.588462</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>478.028846</td>
      <td>414.605769</td>
      <td>628.298077</td>
      <td>191.775000</td>
      <td>197.580769</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>905.005769</td>
    </tr>
    <tr>
      <th>2021-04-01</th>
      <td>2.194231</td>
      <td>0.875000</td>
      <td>0.663462</td>
      <td>1.051923</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.788462</td>
      <td>4.421154</td>
      <td>0.951923</td>
      <td>1.342308</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>310.036538</td>
      <td>722.825000</td>
      <td>622.315385</td>
      <td>274.011538</td>
      <td>223.715385</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>573.459615</td>
    </tr>
    <tr>
      <th>2021-05-01</th>
      <td>1.573077</td>
      <td>0.298077</td>
      <td>1.278846</td>
      <td>0.915385</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.719231</td>
      <td>3.226923</td>
      <td>0.909615</td>
      <td>3.423077</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>205.926923</td>
      <td>1423.846154</td>
      <td>135.448077</td>
      <td>310.394231</td>
      <td>338.209615</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>441.151923</td>
    </tr>
    <tr>
      <th>2021-06-01</th>
      <td>1.353846</td>
      <td>0.226923</td>
      <td>1.398077</td>
      <td>0.457692</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.013462</td>
      <td>2.071154</td>
      <td>2.248077</td>
      <td>3.571154</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>207.298077</td>
      <td>1352.734615</td>
      <td>299.959615</td>
      <td>308.330769</td>
      <td>485.123077</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>436.778846</td>
    </tr>
    <tr>
      <th>2021-07-01</th>
      <td>0.688462</td>
      <td>1.084615</td>
      <td>1.525000</td>
      <td>0.128846</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.200000</td>
      <td>3.688462</td>
      <td>1.842308</td>
      <td>3.251923</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>219.240385</td>
      <td>1203.386538</td>
      <td>NaN</td>
      <td>359.451923</td>
      <td>488.507692</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>451.611538</td>
    </tr>
    <tr>
      <th>2021-08-01</th>
      <td>0.894231</td>
      <td>NaN</td>
      <td>0.982692</td>
      <td>0.280769</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.109615</td>
      <td>8.375000</td>
      <td>5.334615</td>
      <td>2.090385</td>
      <td>...</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>225.351923</td>
      <td>1080.765385</td>
      <td>840.396154</td>
      <td>368.871154</td>
      <td>217.723077</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>485.823077</td>
    </tr>
    <tr>
      <th>2021-09-01</th>
      <td>1.225000</td>
      <td>NaN</td>
      <td>0.751923</td>
      <td>0.234615</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.069231</td>
      <td>9.867308</td>
      <td>6.626923</td>
      <td>2.532692</td>
      <td>...</td>
      <td>NaN</td>
      <td>17.540385</td>
      <td>219.619231</td>
      <td>1101.913462</td>
      <td>NaN</td>
      <td>389.775000</td>
      <td>227.242308</td>
      <td>NaN</td>
      <td>87.246154</td>
      <td>419.742308</td>
    </tr>
    <tr>
      <th>2021-10-01</th>
      <td>1.569231</td>
      <td>NaN</td>
      <td>0.657692</td>
      <td>NaN</td>
      <td>1.409615</td>
      <td>1.025000</td>
      <td>0.971154</td>
      <td>10.359615</td>
      <td>NaN</td>
      <td>2.361538</td>
      <td>...</td>
      <td>57.553846</td>
      <td>51.503846</td>
      <td>209.694231</td>
      <td>1098.215385</td>
      <td>1629.328846</td>
      <td>569.080769</td>
      <td>491.707692</td>
      <td>217.957692</td>
      <td>186.430769</td>
      <td>463.415385</td>
    </tr>
    <tr>
      <th>2021-11-01</th>
      <td>1.407692</td>
      <td>NaN</td>
      <td>0.588462</td>
      <td>0.655769</td>
      <td>1.273077</td>
      <td>0.965385</td>
      <td>0.809615</td>
      <td>5.736538</td>
      <td>NaN</td>
      <td>2.425000</td>
      <td>...</td>
      <td>84.676923</td>
      <td>87.525000</td>
      <td>234.880769</td>
      <td>915.100000</td>
      <td>1682.178846</td>
      <td>854.875000</td>
      <td>870.748077</td>
      <td>306.765385</td>
      <td>293.886538</td>
      <td>469.390385</td>
    </tr>
    <tr>
      <th>2021-12-01</th>
      <td>1.082692</td>
      <td>NaN</td>
      <td>0.492308</td>
      <td>NaN</td>
      <td>1.178846</td>
      <td>0.330769</td>
      <td>1.186538</td>
      <td>7.155769</td>
      <td>NaN</td>
      <td>2.775000</td>
      <td>...</td>
      <td>116.386538</td>
      <td>180.213462</td>
      <td>277.171154</td>
      <td>975.467308</td>
      <td>NaN</td>
      <td>1261.742308</td>
      <td>591.913462</td>
      <td>394.207692</td>
      <td>435.736538</td>
      <td>541.403846</td>
    </tr>
    <tr>
      <th>2022-01-01</th>
      <td>0.861538</td>
      <td>NaN</td>
      <td>0.705769</td>
      <td>NaN</td>
      <td>0.555769</td>
      <td>0.171154</td>
      <td>0.675000</td>
      <td>6.648077</td>
      <td>NaN</td>
      <td>4.094231</td>
      <td>...</td>
      <td>132.209615</td>
      <td>288.563462</td>
      <td>243.730769</td>
      <td>1019.373077</td>
      <td>1488.594231</td>
      <td>1341.825000</td>
      <td>413.482692</td>
      <td>418.669231</td>
      <td>531.225000</td>
      <td>642.796154</td>
    </tr>
    <tr>
      <th>2022-02-01</th>
      <td>0.621154</td>
      <td>NaN</td>
      <td>0.575000</td>
      <td>NaN</td>
      <td>0.471154</td>
      <td>NaN</td>
      <td>0.442308</td>
      <td>7.282692</td>
      <td>NaN</td>
      <td>3.023077</td>
      <td>...</td>
      <td>134.719231</td>
      <td>352.348077</td>
      <td>190.228846</td>
      <td>741.442308</td>
      <td>1879.340385</td>
      <td>921.113462</td>
      <td>986.521154</td>
      <td>420.294231</td>
      <td>639.675000</td>
      <td>469.457692</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>0.944231</td>
      <td>NaN</td>
      <td>0.453846</td>
      <td>NaN</td>
      <td>0.484615</td>
      <td>NaN</td>
      <td>0.486538</td>
      <td>5.673077</td>
      <td>NaN</td>
      <td>2.842308</td>
      <td>...</td>
      <td>132.651923</td>
      <td>248.367308</td>
      <td>177.480769</td>
      <td>653.894231</td>
      <td>NaN</td>
      <td>784.319231</td>
      <td>NaN</td>
      <td>411.732692</td>
      <td>605.619231</td>
      <td>384.192308</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 49 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">weight</span> <span class="o">=</span> <span class="n">all_cause_df</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span>
    <span class="n">index</span><span class="o">=</span><span class="s2">&quot;date&quot;</span><span class="p">,</span>
    <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Age group&quot;</span><span class="p">,</span> <span class="s2">&quot;Vaccination status&quot;</span><span class="p">],</span>
    <span class="n">values</span><span class="o">=</span><span class="s2">&quot;Person-years&quot;</span><span class="p">,</span>
    <span class="n">aggfunc</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">weight</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }

    .dataframe thead tr:last-of-type th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th>Age group</th>
      <th colspan="7" halign="left">18-39</th>
      <th colspan="3" halign="left">40-49</th>
      <th>...</th>
      <th colspan="3" halign="left">80-89</th>
      <th colspan="7" halign="left">90+</th>
    </tr>
    <tr>
      <th>Vaccination status</th>
      <th>First dose, at least 21 days ago</th>
      <th>First dose, less than 21 days ago</th>
      <th>Second dose, at least 21 days ago</th>
      <th>Second dose, less than 21 days ago</th>
      <th>Third dose or booster, at least 21 days ago</th>
      <th>Third dose or booster, less than 21 days ago</th>
      <th>Unvaccinated</th>
      <th>First dose, at least 21 days ago</th>
      <th>First dose, less than 21 days ago</th>
      <th>Second dose, at least 21 days ago</th>
      <th>...</th>
      <th>Third dose or booster, at least 21 days ago</th>
      <th>Third dose or booster, less than 21 days ago</th>
      <th>Unvaccinated</th>
      <th>First dose, at least 21 days ago</th>
      <th>First dose, less than 21 days ago</th>
      <th>Second dose, at least 21 days ago</th>
      <th>Second dose, less than 21 days ago</th>
      <th>Third dose or booster, at least 21 days ago</th>
      <th>Third dose or booster, less than 21 days ago</th>
      <th>Unvaccinated</th>
    </tr>
    <tr>
      <th>date</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2021-01-01</th>
      <td>4652</td>
      <td>26531</td>
      <td>245</td>
      <td>1298</td>
      <td>0</td>
      <td>0</td>
      <td>919726</td>
      <td>3808</td>
      <td>19144</td>
      <td>230</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>73526</td>
      <td>2868</td>
      <td>13697</td>
      <td>435</td>
      <td>2480</td>
      <td>0</td>
      <td>0</td>
      <td>18501</td>
    </tr>
    <tr>
      <th>2021-02-01</th>
      <td>42417</td>
      <td>39726</td>
      <td>1796</td>
      <td>702</td>
      <td>0</td>
      <td>0</td>
      <td>775131</td>
      <td>30464</td>
      <td>30705</td>
      <td>1725</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>9636</td>
      <td>20376</td>
      <td>6965</td>
      <td>3382</td>
      <td>83</td>
      <td>0</td>
      <td>0</td>
      <td>3233</td>
    </tr>
    <tr>
      <th>2021-03-01</th>
      <td>101611</td>
      <td>63998</td>
      <td>3920</td>
      <td>10271</td>
      <td>0</td>
      <td>0</td>
      <td>771499</td>
      <td>77988</td>
      <td>58483</td>
      <td>3546</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>6529</td>
      <td>26123</td>
      <td>698</td>
      <td>4282</td>
      <td>4633</td>
      <td>0</td>
      <td>0</td>
      <td>1970</td>
    </tr>
    <tr>
      <th>2021-04-01</th>
      <td>139889</td>
      <td>32920</td>
      <td>24262</td>
      <td>35289</td>
      <td>0</td>
      <td>0</td>
      <td>687679</td>
      <td>124715</td>
      <td>61689</td>
      <td>18918</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>5050</td>
      <td>7455</td>
      <td>161</td>
      <td>13980</td>
      <td>13616</td>
      <td>0</td>
      <td>0</td>
      <td>1502</td>
    </tr>
    <tr>
      <th>2021-05-01</th>
      <td>113834</td>
      <td>54401</td>
      <td>79347</td>
      <td>52111</td>
      <td>0</td>
      <td>0</td>
      <td>650418</td>
      <td>166754</td>
      <td>84731</td>
      <td>60506</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>4821</td>
      <td>1448</td>
      <td>71</td>
      <td>32341</td>
      <td>2854</td>
      <td>0</td>
      <td>0</td>
      <td>1408</td>
    </tr>
    <tr>
      <th>2021-06-01</th>
      <td>130731</td>
      <td>148028</td>
      <td>153165</td>
      <td>53434</td>
      <td>0</td>
      <td>0</td>
      <td>433521</td>
      <td>164911</td>
      <td>14535</td>
      <td>130976</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>4441</td>
      <td>644</td>
      <td>38</td>
      <td>34772</td>
      <td>412</td>
      <td>0</td>
      <td>0</td>
      <td>1294</td>
    </tr>
    <tr>
      <th>2021-07-01</th>
      <td>277344</td>
      <td>99274</td>
      <td>233284</td>
      <td>61414</td>
      <td>0</td>
      <td>0</td>
      <td>277646</td>
      <td>64268</td>
      <td>4330</td>
      <td>247896</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>4441</td>
      <td>457</td>
      <td>23</td>
      <td>36701</td>
      <td>138</td>
      <td>0</td>
      <td>0</td>
      <td>1295</td>
    </tr>
    <tr>
      <th>2021-08-01</th>
      <td>220983</td>
      <td>20382</td>
      <td>338822</td>
      <td>127408</td>
      <td>0</td>
      <td>0</td>
      <td>240885</td>
      <td>21577</td>
      <td>2046</td>
      <td>355560</td>
      <td>...</td>
      <td>0</td>
      <td>0</td>
      <td>4344</td>
      <td>370</td>
      <td>11</td>
      <td>37036</td>
      <td>62</td>
      <td>0</td>
      <td>0</td>
      <td>1271</td>
    </tr>
    <tr>
      <th>2021-09-01</th>
      <td>94196</td>
      <td>10388</td>
      <td>505837</td>
      <td>88779</td>
      <td>0</td>
      <td>697</td>
      <td>217515</td>
      <td>14395</td>
      <td>1297</td>
      <td>369736</td>
      <td>...</td>
      <td>0</td>
      <td>3627</td>
      <td>4142</td>
      <td>321</td>
      <td>7</td>
      <td>35489</td>
      <td>25</td>
      <td>0</td>
      <td>573</td>
      <td>1214</td>
    </tr>
    <tr>
      <th>2021-10-01</th>
      <td>67311</td>
      <td>6356</td>
      <td>615435</td>
      <td>24779</td>
      <td>3520</td>
      <td>14868</td>
      <td>215324</td>
      <td>12672</td>
      <td>994</td>
      <td>370576</td>
      <td>...</td>
      <td>18622</td>
      <td>62884</td>
      <td>4219</td>
      <td>292</td>
      <td>12</td>
      <td>22415</td>
      <td>31</td>
      <td>3168</td>
      <td>11842</td>
      <td>1237</td>
    </tr>
    <tr>
      <th>2021-11-01</th>
      <td>55034</td>
      <td>4944</td>
      <td>594332</td>
      <td>12667</td>
      <td>26066</td>
      <td>22277</td>
      <td>201381</td>
      <td>10978</td>
      <td>784</td>
      <td>328710</td>
      <td>...</td>
      <td>104487</td>
      <td>32240</td>
      <td>4020</td>
      <td>250</td>
      <td>10</td>
      <td>8868</td>
      <td>27</td>
      <td>19966</td>
      <td>7466</td>
      <td>1172</td>
    </tr>
    <tr>
      <th>2021-12-01</th>
      <td>47569</td>
      <td>6244</td>
      <td>489873</td>
      <td>12516</td>
      <td>63907</td>
      <td>126969</td>
      <td>199821</td>
      <td>9915</td>
      <td>945</td>
      <td>202910</td>
      <td>...</td>
      <td>149236</td>
      <td>9773</td>
      <td>4082</td>
      <td>227</td>
      <td>11</td>
      <td>3605</td>
      <td>29</td>
      <td>30572</td>
      <td>3301</td>
      <td>1186</td>
    </tr>
    <tr>
      <th>2022-01-01</th>
      <td>42878</td>
      <td>6134</td>
      <td>285156</td>
      <td>9038</td>
      <td>286671</td>
      <td>125788</td>
      <td>190750</td>
      <td>9010</td>
      <td>882</td>
      <td>87018</td>
      <td>...</td>
      <td>161790</td>
      <td>2083</td>
      <td>4016</td>
      <td>208</td>
      <td>9</td>
      <td>1845</td>
      <td>19</td>
      <td>34863</td>
      <td>782</td>
      <td>1164</td>
    </tr>
    <tr>
      <th>2022-02-01</th>
      <td>39248</td>
      <td>2948</td>
      <td>232464</td>
      <td>4913</td>
      <td>388129</td>
      <td>19277</td>
      <td>167539</td>
      <td>8078</td>
      <td>405</td>
      <td>68465</td>
      <td>...</td>
      <td>148653</td>
      <td>380</td>
      <td>3598</td>
      <td>179</td>
      <td>4</td>
      <td>1380</td>
      <td>10</td>
      <td>32413</td>
      <td>141</td>
      <td>1036</td>
    </tr>
    <tr>
      <th>2022-03-01</th>
      <td>42386</td>
      <td>1460</td>
      <td>249676</td>
      <td>3968</td>
      <td>454596</td>
      <td>10328</td>
      <td>183341</td>
      <td>8695</td>
      <td>164</td>
      <td>72977</td>
      <td>...</td>
      <td>165318</td>
      <td>201</td>
      <td>3966</td>
      <td>191</td>
      <td>2</td>
      <td>1415</td>
      <td>7</td>
      <td>36170</td>
      <td>67</td>
      <td>1141</td>
    </tr>
  </tbody>
</table>
<p>15 rows × 49 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_cause_df</span><span class="p">[</span><span class="s2">&quot;Vaccination status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Unvaccinated                                    105
First dose, less than 21 days ago               105
First dose, at least 21 days ago                105
Second dose, less than 21 days ago              105
Second dose, at least 21 days ago               105
Third dose or booster, less than 21 days ago    105
Third dose or booster, at least 21 days ago     105
Name: Vaccination status, dtype: int64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">unvax_stat</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">]</span>

<span class="n">vax_stat</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;Second dose, less than 21 days ago&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Second dose, at least 21 days ago&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Third dose or booster, less than 21 days ago&quot;</span><span class="p">,</span>
    <span class="s2">&quot;Third dose or booster, at least 21 days ago&quot;</span><span class="p">,</span>
<span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">weighted_sum</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Weighted sum of table and weight.</span>

<span class="sd">    table: DataFrame</span>
<span class="sd">    weight: DataFrame</span>

<span class="sd">    returns: Series</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># make sure that weight is 0 where table is NaN</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">table</span><span class="o">.</span><span class="n">notna</span><span class="p">(),</span> <span class="n">weight</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">weight</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">weight</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">weight</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>

    <span class="c1"># normalize the weights rowwise</span>
    <span class="n">total</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">weight_norm</span> <span class="o">=</span> <span class="n">weight</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">total</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># compute the weighted sum of table</span>
    <span class="n">prod</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="o">*</span> <span class="n">weight_norm</span>
    <span class="k">return</span> <span class="n">prod</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_groups</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">status</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Select age groups and vax status.</span>

<span class="sd">    frame: DataFrame (table or weights)</span>
<span class="sd">    groups: list of string age group names</span>
<span class="sd">    status: list of string vax status</span>

<span class="sd">    returns: DataFrame</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">seq</span> <span class="o">=</span> <span class="p">[</span><span class="n">frame</span><span class="p">[</span><span class="n">group</span><span class="p">][</span><span class="n">status</span><span class="p">]</span> <span class="k">for</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot mortality for vaxed and unvaxed.</span>

<span class="sd">    table: DataFrame</span>
<span class="sd">    weight: DataFrame</span>
<span class="sd">    groups: list of string age groups</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">t</span> <span class="o">=</span> <span class="n">get_groups</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">unvax_stat</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">get_groups</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">unvax_stat</span><span class="p">)</span>
    <span class="n">unvax</span> <span class="o">=</span> <span class="n">weighted_sum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="n">get_groups</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">vax_stat</span><span class="p">)</span>
    <span class="n">w</span> <span class="o">=</span> <span class="n">get_groups</span><span class="p">(</span><span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">,</span> <span class="n">vax_stat</span><span class="p">)</span>
    <span class="n">vax</span> <span class="o">=</span> <span class="n">weighted_sum</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">w</span><span class="p">)</span>

    <span class="n">ages</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">groups</span><span class="p">)</span>
    <span class="n">unvax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">)</span>
    <span class="n">vax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span><span class="o">=</span><span class="s2">&quot;Vaccinated&quot;</span><span class="p">)</span>

    <span class="n">decorate</span><span class="p">(</span>
        <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
        <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Weekly deaths per 100k&quot;</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;All cause death rates, ages </span><span class="si">{</span><span class="n">ages</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># adjust the axes</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span>
    <span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">high</span><span class="p">)</span>

    <span class="n">start</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2020-12-15&quot;</span><span class="p">)</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s2">&quot;2022-04-01&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlim</span><span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This figure shows what happens if we combine the youngest three groups,</span>
<span class="c1"># as in the original data</span>
<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;18-39&quot;</span><span class="p">,</span> <span class="s2">&quot;40-49&quot;</span><span class="p">,</span> <span class="s2">&quot;50-59&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9613d0ea807c232f0ee709e1895e756e39203fbf464ad75f3b0935676a31b726.png" src="_images/9613d0ea807c232f0ee709e1895e756e39203fbf464ad75f3b0935676a31b726.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the following figures look at the older age groups, which I won&#39;t present again</span>

<span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;90+&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/6509bebc937eba1ff991cfba1d06d72f014aa89de563c16c1c53f8c643c77452.png" src="_images/6509bebc937eba1ff991cfba1d06d72f014aa89de563c16c1c53f8c643c77452.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;80-89&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/dc641e7eaab9c12a00cfaea5d43952952db65ad99a9b5bbe92c5c1d2f0f953cb.png" src="_images/dc641e7eaab9c12a00cfaea5d43952952db65ad99a9b5bbe92c5c1d2f0f953cb.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;70-79&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/752080eba6194fbabeedbd6716c34280ca185e377d33a05cb215598a4c79d260.png" src="_images/752080eba6194fbabeedbd6716c34280ca185e377d33a05cb215598a4c79d260.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;60-69&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a225db7e5ffe294292af0bd547653c3be6d5ce92d2042c8326149fdc8525adf0.png" src="_images/a225db7e5ffe294292af0bd547653c3be6d5ce92d2042c8326149fdc8525adf0.png" />
</div>
</div>
<p>Let’s start with the oldest of these subgroups.
Among people in their 50s, we see that the all-cause death rate was substantially higher among unvaccinated people over the entire interval from March 2021 to April 2022.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;50-59&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">24</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f529563ada0&gt;
</pre></div>
</div>
<img alt="_images/e6214fba5ae2a4f6aa2da84b9f01fe787089bc4127b8a2a06561a3b13ec8f9a5.png" src="_images/e6214fba5ae2a4f6aa2da84b9f01fe787089bc4127b8a2a06561a3b13ec8f9a5.png" />
</div>
</div>
<p>If we select people in their 40s, we see the same thing: death rates were higher for unvaccinated people over the entire interval.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;40-49&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">7.8</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s2">&quot;upper right&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7f529539bee0&gt;
</pre></div>
</div>
<img alt="_images/2ba39391d3d89838c838d1a83061d3d42cc7ec23938217ec587fe656aa87d6ac.png" src="_images/2ba39391d3d89838c838d1a83061d3d42cc7ec23938217ec587fe656aa87d6ac.png" />
</div>
</div>
<p>However, it is notable that death rates in both groups have declined since April or May 2021, and have nearly converged.
Possible explanations include improved treatment for coronavirus disease and the decline of more lethal variants of the COVID virus.
In the U.K., December 2021 is when the Delta variant was largely replaced by the Omicron variant, which is less deadly.</p>
<p>Finally, let’s see what happened in the youngest group, people aged 18 to 39.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;18-39&quot;</span><span class="p">]</span>
<span class="n">make_plot</span><span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="n">weight</span><span class="p">,</span> <span class="n">groups</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/449c7cd1019e488797f3fc79735bc33864c3345d1b596fa93316147cb4eb2048.png" src="_images/449c7cd1019e488797f3fc79735bc33864c3345d1b596fa93316147cb4eb2048.png" />
</div>
</div>
<p>In this age group, like the others, death rates are generally higher among unvaccinated people.
There are a few months where the pattern is reversed, but we should not take it too seriously because:</p>
<ul class="simple">
<li><p>Death rates in this age group are very low, less than 1 per 100,000 per week, vaccinated or not.</p></li>
<li><p>The apparent differences between the groups are even smaller, and might be the result of random variation.</p></li>
<li><p>Finally, this age group is still broad enough that the results are influenced by Simpson’s paradox. The vaccinated people in this group were older than the unvaccinated, and the  older people in this group were about 10 times more likely to die, just because of their age.</p></li>
</ul>
<p>In summary, the excess mortality among vaccinated people in 2021 is entirely explained by Simpson’s paradox.
If we break the dataset into appropriate age groups, we see that death rates were higher among the unvaccinated in all age groups over the entire time from the rollout of the vaccine to the present.
And we can conclude that the vaccine saved many lives.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">may</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">2021</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;May&quot;</span><span class="p">)</span>
<span class="n">may</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>147
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fully</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Vaccination status&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;Second dose, at least 21 days ago&quot;</span>
<span class="n">fully</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>315
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">age</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Age group&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;18-39&quot;</span>
<span class="n">age</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>315
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="n">may</span> <span class="o">&amp;</span> <span class="n">fully</span> <span class="o">&amp;</span> <span class="n">age</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cause of Death</th>
      <th>Year</th>
      <th>Month</th>
      <th>Age group</th>
      <th>Vaccination status</th>
      <th>Count of deaths</th>
      <th>Person-years</th>
      <th>Age-standardised mortality rate / 100,000 person-years</th>
      <th>Noted as Unreliable</th>
      <th>Lower confidence limit</th>
      <th>Upper confidence limit</th>
      <th>date</th>
      <th>rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>200</th>
      <td>All causes</td>
      <td>2021</td>
      <td>May</td>
      <td>18-39</td>
      <td>Second dose, at least 21 days ago</td>
      <td>52.0</td>
      <td>79347</td>
      <td>66.5</td>
      <td>NaN</td>
      <td>48.9</td>
      <td>88.3</td>
      <td>2021-05-01</td>
      <td>1.278846</td>
    </tr>
    <tr>
      <th>935</th>
      <td>Deaths involving COVID-19</td>
      <td>2021</td>
      <td>May</td>
      <td>18-39</td>
      <td>Second dose, at least 21 days ago</td>
      <td>NaN</td>
      <td>79347</td>
      <td>x</td>
      <td>NaN</td>
      <td>x</td>
      <td>x</td>
      <td>2021-05-01</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1670</th>
      <td>Non-COVID-19 deaths</td>
      <td>2021</td>
      <td>May</td>
      <td>18-39</td>
      <td>Second dose, at least 21 days ago</td>
      <td>52.0</td>
      <td>79347</td>
      <td>66.5</td>
      <td>NaN</td>
      <td>48.9</td>
      <td>88.3</td>
      <td>2021-05-01</td>
      <td>1.278846</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rate</th>
      <th>pct_vax</th>
      <th>pct_pop</th>
      <th>pct_vax_age</th>
      <th>pct_novax_age</th>
      <th>death_vax</th>
      <th>death_novax</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>10-14</th>
      <td>8.8</td>
      <td>0.0</td>
      <td>0.092332</td>
      <td>0.000000</td>
      <td>0.239297</td>
      <td>0.000000</td>
      <td>2.105810</td>
    </tr>
    <tr>
      <th>15-19</th>
      <td>23.1</td>
      <td>26.7</td>
      <td>0.086072</td>
      <td>0.037419</td>
      <td>0.163513</td>
      <td>0.864387</td>
      <td>3.777140</td>
    </tr>
    <tr>
      <th>20-24</th>
      <td>39.1</td>
      <td>59.6</td>
      <td>0.097027</td>
      <td>0.094159</td>
      <td>0.101592</td>
      <td>3.681603</td>
      <td>3.972229</td>
    </tr>
    <tr>
      <th>25-29</th>
      <td>48.4</td>
      <td>59.7</td>
      <td>0.106416</td>
      <td>0.103444</td>
      <td>0.111147</td>
      <td>5.006692</td>
      <td>5.379523</td>
    </tr>
    <tr>
      <th>30-34</th>
      <td>66.9</td>
      <td>63.3</td>
      <td>0.104851</td>
      <td>0.108069</td>
      <td>0.099730</td>
      <td>7.229811</td>
      <td>6.671929</td>
    </tr>
    <tr>
      <th>35-39</th>
      <td>97.3</td>
      <td>63.3</td>
      <td>0.103286</td>
      <td>0.106456</td>
      <td>0.098241</td>
      <td>10.358164</td>
      <td>9.558886</td>
    </tr>
    <tr>
      <th>40-44</th>
      <td>143.3</td>
      <td>74.6</td>
      <td>0.093897</td>
      <td>0.114054</td>
      <td>0.061812</td>
      <td>16.344008</td>
      <td>8.857590</td>
    </tr>
    <tr>
      <th>45-49</th>
      <td>219.6</td>
      <td>80.5</td>
      <td>0.103286</td>
      <td>0.135382</td>
      <td>0.052199</td>
      <td>29.729969</td>
      <td>11.462921</td>
    </tr>
    <tr>
      <th>50-54</th>
      <td>321.5</td>
      <td>85.6</td>
      <td>0.109546</td>
      <td>0.152684</td>
      <td>0.040883</td>
      <td>49.087972</td>
      <td>13.143951</td>
    </tr>
    <tr>
      <th>55-59</th>
      <td>478.2</td>
      <td>88.2</td>
      <td>0.103286</td>
      <td>0.148332</td>
      <td>0.031587</td>
      <td>70.932358</td>
      <td>15.104973</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mortality</span> <span class="o">=</span> <span class="n">sheet</span><span class="p">[</span><span class="s2">&quot;rate&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">52</span>
<span class="n">mortality</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>10-14    0.169231
15-19    0.444231
20-24    0.751923
25-29    0.930769
30-34    1.286538
35-39    1.871154
40-44    2.755769
45-49    4.223077
50-54    6.182692
55-59    9.196154
Name: rate, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;55-59&quot;</span><span class="p">],</span> <span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;20-24&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(9.196153846153846, 0.7519230769230769)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;55-59&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">mortality</span><span class="p">[</span><span class="s2">&quot;20-24&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>12.230179028132993
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;55-59&quot;</span><span class="p">,</span> <span class="s2">&quot;pct_vax&quot;</span><span class="p">],</span> <span class="n">sheet</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;20-24&quot;</span><span class="p">,</span> <span class="s2">&quot;pct_vax&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(88.2, 59.6)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sheet</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;55-59&quot;</span><span class="p">,</span> <span class="s2">&quot;pct_vax&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">sheet</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s2">&quot;20-24&quot;</span><span class="p">,</span> <span class="s2">&quot;pct_vax&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.4798657718120805
</pre></div>
</div>
</div>
</div>
</section>
<section id="lives-saved">
<h2>Lives saved<a class="headerlink" href="#lives-saved" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;referencetable20220516accessiblecorrected.xlsx&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span>
    <span class="n">filename</span><span class="p">,</span>
    <span class="n">sheet_name</span><span class="o">=</span><span class="s2">&quot;Table 2&quot;</span><span class="p">,</span>
    <span class="n">skiprows</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Cause of Death</th>
      <th>Year</th>
      <th>Month</th>
      <th>Age group</th>
      <th>Vaccination status</th>
      <th>Count of deaths</th>
      <th>Person-years</th>
      <th>Age-standardised mortality rate / 100,000 person-years</th>
      <th>Noted as Unreliable</th>
      <th>Lower confidence limit</th>
      <th>Upper confidence limit</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2200</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>First dose, at least 21 days ago</td>
      <td>57</td>
      <td>191</td>
      <td>29817.6</td>
      <td>NaN</td>
      <td>22582.1</td>
      <td>38633</td>
    </tr>
    <tr>
      <th>2201</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Second dose, less than 21 days ago</td>
      <td>&lt;3</td>
      <td>7</td>
      <td>x</td>
      <td>NaN</td>
      <td>x</td>
      <td>x</td>
    </tr>
    <tr>
      <th>2202</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Second dose, at least 21 days ago</td>
      <td>515</td>
      <td>1415</td>
      <td>36402.2</td>
      <td>NaN</td>
      <td>33325.7</td>
      <td>39686.4</td>
    </tr>
    <tr>
      <th>2203</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Third dose or booster, less than 21 days ago</td>
      <td>20</td>
      <td>67</td>
      <td>29992.6</td>
      <td>NaN</td>
      <td>18312.4</td>
      <td>46323.7</td>
    </tr>
    <tr>
      <th>2204</th>
      <td>Non-COVID-19 deaths</td>
      <td>2022</td>
      <td>March</td>
      <td>90+</td>
      <td>Third dose or booster, at least 21 days ago</td>
      <td>7024</td>
      <td>36170</td>
      <td>19419.5</td>
      <td>NaN</td>
      <td>18967.9</td>
      <td>19879</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;Year&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Month&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_cause</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;Cause of Death&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;All causes&quot;</span>
<span class="n">all_cause</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>735
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rate_col</span> <span class="o">=</span> <span class="s2">&quot;Age-standardised mortality rate / 100,000 person-years&quot;</span>
<span class="n">df</span><span class="p">[</span><span class="n">rate_col</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">rate_col</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count     1447.000000
mean      6413.953766
std      12747.774742
min          0.900000
25%        122.400000
50%        835.700000
75%       6364.750000
max      97725.700000
Name: Age-standardised mortality rate / 100,000 person-years, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">estimate_saved_lives</span><span class="p">(</span><span class="n">period</span><span class="p">):</span>
    <span class="n">index</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="s2">&quot;Vaccination status&quot;</span><span class="p">]</span>
    <span class="n">deaths</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="s2">&quot;Count of deaths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">pop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="s2">&quot;Person-years&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
    <span class="n">rate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rate_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>

    <span class="c1"># choose the minimum rate among the fully vaccinated / boosted</span>
    <span class="n">possible_rate</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e5</span>
    <span class="n">actual_deaths</span> <span class="o">=</span> <span class="n">deaths</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">]</span>
    <span class="n">possible_deaths</span> <span class="o">=</span> <span class="n">possible_rate</span> <span class="o">*</span> <span class="n">pop</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">actual_deaths</span> <span class="o">-</span> <span class="n">possible_deaths</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">res</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">all_cause</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">([</span><span class="s2">&quot;Age group&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">]):</span>
    <span class="n">saved</span> <span class="o">=</span> <span class="n">estimate_saved_lives</span><span class="p">(</span><span class="n">period</span><span class="p">)</span>
    <span class="n">res</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">name</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">name</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">saved</span><span class="p">))</span>

<span class="n">saved_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;Age group&quot;</span><span class="p">,</span> <span class="s2">&quot;date&quot;</span><span class="p">,</span> <span class="s2">&quot;saved&quot;</span><span class="p">])</span>
<span class="n">saved_df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Age group</th>
      <th>date</th>
      <th>saved</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>18-39</td>
      <td>2021-01-01</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>18-39</td>
      <td>2021-02-01</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>18-39</td>
      <td>2021-03-01</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>18-39</td>
      <td>2021-04-01</td>
      <td>31.750745</td>
    </tr>
    <tr>
      <th>4</th>
      <td>18-39</td>
      <td>2021-05-01</td>
      <td>-207.527970</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>100</th>
      <td>90+</td>
      <td>2021-11-01</td>
      <td>106.893788</td>
    </tr>
    <tr>
      <th>101</th>
      <td>90+</td>
      <td>2021-12-01</td>
      <td>90.884232</td>
    </tr>
    <tr>
      <th>102</th>
      <td>90+</td>
      <td>2022-01-01</td>
      <td>135.587888</td>
    </tr>
    <tr>
      <th>103</th>
      <td>90+</td>
      <td>2022-02-01</td>
      <td>26.579092</td>
    </tr>
    <tr>
      <th>104</th>
      <td>90+</td>
      <td>2022-03-01</td>
      <td>-16.289241</td>
    </tr>
  </tbody>
</table>
<p>105 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">series</span> <span class="o">=</span> <span class="n">saved_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;date&quot;</span><span class="p">)[</span><span class="s2">&quot;saved&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>date
2021-01-01    25602.785167
2021-02-01    14539.347887
2021-03-01     5751.205365
2021-04-01     2371.099972
2021-05-01     1081.724156
2021-06-01      904.974268
2021-07-01      922.228068
2021-08-01     1075.862092
2021-09-01     1603.805799
2021-10-01     1530.583100
2021-11-01     1353.284205
2021-12-01     1445.124507
2022-01-01     1108.678014
2022-02-01      469.170039
2022-03-01      286.239461
Name: saved, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">period</span><span class="p">[</span><span class="s2">&quot;Vaccination status&quot;</span><span class="p">]</span>
<span class="n">deaths</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="s2">&quot;Count of deaths&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="n">deaths</span>

<span class="n">pop</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="s2">&quot;Person-years&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="n">pop</span>

<span class="n">rate</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">period</span><span class="p">[</span><span class="n">rate_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">index</span><span class="p">)</span>
<span class="n">rate</span>

<span class="n">boosted</span> <span class="o">=</span> <span class="s2">&quot;Third dose or booster, at least 21 days ago&quot;</span>
<span class="n">possible_rate</span> <span class="o">=</span> <span class="n">rate</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">/</span> <span class="mf">1e5</span>
<span class="n">possible_rate</span>

<span class="n">pop</span><span class="p">[</span><span class="n">boosted</span><span class="p">]</span> <span class="o">*</span> <span class="n">possible_rate</span>

<span class="n">deaths</span><span class="p">[</span><span class="n">boosted</span><span class="p">]</span>

<span class="n">actual_deaths</span> <span class="o">=</span> <span class="n">deaths</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">]</span>

<span class="n">possible_deaths</span> <span class="o">=</span> <span class="n">possible_rate</span> <span class="o">*</span> <span class="n">pop</span><span class="p">[</span><span class="s2">&quot;Unvaccinated&quot;</span><span class="p">]</span>
<span class="n">actual_deaths</span><span class="p">,</span> <span class="n">possible_deaths</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(228, 244.28924099999998)
</pre></div>
</div>
</div>
</div>
</section>
<section id="sources-and-related-reading">
<h2>Sources and related reading<a class="headerlink" href="#sources-and-related-reading" title="Permalink to this heading">#</a></h2>
<ul class="simple">
<li><p>The General Social Survey (GSS) is a project of the University of Chicago’s independent research organization NORC, with primary financing from the National Science Foundation. Data is available from the GSS website \cite{gss2022}.</p></li>
<li><p>Floyd Norris wrote about changes in real wages in <em>The New York Times</em> \cite{norris2013}. The following week, he wrote a blog article to respond to readers who thought he had made a mistake \cite{norris2013blog}.</p></li>
<li><p>The IPUMS CPS data is from the U.S. Census Bureau: Sarah Flood, Miriam King, Renae Rodgers, Steven Ruggles, J. Robert Warren, Daniel Backman, Annie Chen, Grace Cooper, Stephanie Richards, Megan Schouweiler, and Michael Westberry. Integrated Public Use Microdata Series, Current Population Survey: Version 11.0 [dataset]. Minneapolis, MN: IPUMS, 2023. <a class="reference external" href="https://doi.org/10.18128/D030.V11.0">https://doi.org/10.18128/D030.V11.0</a></p></li>
<li><p>The penguin dataset was reported in “Ecological sexual dimorphism and environmental variability within a community of Antarctic penguins” \cite{gorman2014ecological}. Allison Horst pointed out the penguin paradox in the online documentation of the dataset \cite{horst2022}.</p></li>
<li><p>The nested Simpson’s paradox among dog breeds is described in “Do large dogs die young?”
\cite{galis2007large}.</p></li>
<li><p>The paper that evaluates treatments for kidney stones was published in 1986 in the <em>British Medical Journal</em> \cite{charig1986comparison}.</p></li>
<li><p>Derek Thompson wrote about the misleading journalist in <em>The Atlantic</em> \cite{thompson2021}. Jeffrey Morris debunks the misleading newsletter in a series of blog articles \cite{morris2021}.</p></li>
<li><p>Information about the prevalence of different COVID variants is from the U.K. Health Security Agency \cite{ukhsa2022}.</p></li>
<li><p>The COVID data I used is from the U.K. Office for National Statistics \cite{ukons2022}.</p></li>
</ul>
</section>
<section id="israeli-data">
<h2>Israeli Data<a class="headerlink" href="#israeli-data" title="Permalink to this heading">#</a></h2>
<p>This is an analysis I started with another dataset that demonstrates a Simpson’s paradox if you don’t separate age groups.</p>
<p>Downloaded from <a class="reference external" href="https://www.covid-datascience.com/post/israeli-data-how-can-efficacy-vs-severe-disease-be-strong-when-60-of-hospitalized-are-vaccinated">https://www.covid-datascience.com/post/israeli-data-how-can-efficacy-vs-severe-disease-be-strong-when-60-of-hospitalized-are-vaccinated</a></p>
<p>Originally from an <a class="reference external" href="https://datadashboard.health.gov.il/COVID-19/general">Israeli government COVID dashboard</a> with headings translated by Jeffrey S. Morris, director of the Biostatistics Division at the University of Pennsylvania.</p>
<p><a class="reference external" href="https://www.dbei.med.upenn.edu/bio/jeffrey-s-morris-phd">https://www.dbei.med.upenn.edu/bio/jeffrey-s-morris-phd</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;Israeli_data_August_15_2021.xlsx&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_excel</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age group&quot;</span><span class="p">]</span>
<span class="k">del</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;age group&quot;</span><span class="p">]</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>population unvax</th>
      <th>population vax</th>
      <th>population partial</th>
      <th>proportion unvax</th>
      <th>proportion vax</th>
      <th>proportion partial</th>
      <th>not vax</th>
      <th>vax</th>
      <th>partial vax</th>
      <th>not vax per 100k</th>
      <th>...</th>
      <th>proportion of unvax</th>
      <th>severe unvax</th>
      <th>severe vax</th>
      <th>severe partial vax</th>
      <th>severe unvax per 100k</th>
      <th>risk severe 20-29</th>
      <th>severe vax 100k</th>
      <th>severe parital vax per 1`00k</th>
      <th>Efficacy severe</th>
      <th>Efficacy severe partial</th>
    </tr>
    <tr>
      <th>age group</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>12-15</th>
      <td>383648.581384</td>
      <td>184549.356223</td>
      <td>49986.229689</td>
      <td>0.620606</td>
      <td>0.298535</td>
      <td>0.080860</td>
      <td>3083.0</td>
      <td>172.0</td>
      <td>363.0</td>
      <td>803.6</td>
      <td>...</td>
      <td>0.294455</td>
      <td>1</td>
      <td>0</td>
      <td>0.0</td>
      <td>0.3</td>
      <td>0.048387</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>16-19</th>
      <td>127745.045528</td>
      <td>429109.159348</td>
      <td>26662.484316</td>
      <td>0.218923</td>
      <td>0.735385</td>
      <td>0.045693</td>
      <td>954.0</td>
      <td>1710.0</td>
      <td>85.0</td>
      <td>746.8</td>
      <td>...</td>
      <td>0.098046</td>
      <td>2</td>
      <td>0</td>
      <td>0.0</td>
      <td>1.6</td>
      <td>0.258065</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>20-29</th>
      <td>265871.262336</td>
      <td>991408.292865</td>
      <td>43064.876957</td>
      <td>0.204462</td>
      <td>0.762420</td>
      <td>0.033118</td>
      <td>1805.0</td>
      <td>5308.0</td>
      <td>154.0</td>
      <td>678.9</td>
      <td>...</td>
      <td>0.204059</td>
      <td>4</td>
      <td>0</td>
      <td>0.0</td>
      <td>1.5</td>
      <td>0.241935</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.000000</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>30-39</th>
      <td>194213.423919</td>
      <td>968837.047354</td>
      <td>33911.882510</td>
      <td>0.162255</td>
      <td>0.809413</td>
      <td>0.028332</td>
      <td>1658.0</td>
      <td>5565.0</td>
      <td>127.0</td>
      <td>853.7</td>
      <td>...</td>
      <td>0.149061</td>
      <td>12</td>
      <td>2</td>
      <td>0.0</td>
      <td>6.2</td>
      <td>1.000000</td>
      <td>0.2</td>
      <td>0.0</td>
      <td>0.967742</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>40-49</th>
      <td>145355.468255</td>
      <td>927214.116050</td>
      <td>26025.236593</td>
      <td>0.132310</td>
      <td>0.844000</td>
      <td>0.023690</td>
      <td>1147.0</td>
      <td>5465.0</td>
      <td>66.0</td>
      <td>789.1</td>
      <td>...</td>
      <td>0.111562</td>
      <td>24</td>
      <td>9</td>
      <td>1.0</td>
      <td>16.5</td>
      <td>2.661290</td>
      <td>1.0</td>
      <td>3.8</td>
      <td>0.939394</td>
      <td>0.769697</td>
    </tr>
    <tr>
      <th>50-59</th>
      <td>84545.028143</td>
      <td>747949.291573</td>
      <td>17472.118959</td>
      <td>0.099469</td>
      <td>0.879975</td>
      <td>0.020556</td>
      <td>721.0</td>
      <td>4012.0</td>
      <td>47.0</td>
      <td>852.8</td>
      <td>...</td>
      <td>0.064889</td>
      <td>34</td>
      <td>22</td>
      <td>0.0</td>
      <td>40.2</td>
      <td>6.483871</td>
      <td>2.9</td>
      <td>0.0</td>
      <td>0.927861</td>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>60-69</th>
      <td>65204.929779</td>
      <td>665716.790881</td>
      <td>10668.163953</td>
      <td>0.087926</td>
      <td>0.897689</td>
      <td>0.014386</td>
      <td>455.0</td>
      <td>3037.0</td>
      <td>19.0</td>
      <td>697.8</td>
      <td>...</td>
      <td>0.050046</td>
      <td>50</td>
      <td>58</td>
      <td>3.0</td>
      <td>76.7</td>
      <td>12.370968</td>
      <td>8.7</td>
      <td>28.1</td>
      <td>0.886571</td>
      <td>0.633638</td>
    </tr>
    <tr>
      <th>70-79</th>
      <td>20512.376666</td>
      <td>464336.324988</td>
      <td>5885.500268</td>
      <td>0.041799</td>
      <td>0.946207</td>
      <td>0.011993</td>
      <td>237.0</td>
      <td>1966.0</td>
      <td>22.0</td>
      <td>1155.4</td>
      <td>...</td>
      <td>0.015743</td>
      <td>39</td>
      <td>92</td>
      <td>2.0</td>
      <td>190.1</td>
      <td>30.661290</td>
      <td>19.8</td>
      <td>34.0</td>
      <td>0.895844</td>
      <td>0.821147</td>
    </tr>
    <tr>
      <th>80-89</th>
      <td>12683.457148</td>
      <td>208911.307272</td>
      <td>3924.366750</td>
      <td>0.056241</td>
      <td>0.926357</td>
      <td>0.017401</td>
      <td>140.0</td>
      <td>994.0</td>
      <td>11.0</td>
      <td>1103.8</td>
      <td>...</td>
      <td>0.009735</td>
      <td>32</td>
      <td>100</td>
      <td>2.0</td>
      <td>252.3</td>
      <td>40.693548</td>
      <td>47.9</td>
      <td>51.0</td>
      <td>0.810147</td>
      <td>0.797860</td>
    </tr>
    <tr>
      <th>90+</th>
      <td>3132.059971</td>
      <td>46601.941748</td>
      <td>1764.112903</td>
      <td>0.060819</td>
      <td>0.904925</td>
      <td>0.034256</td>
      <td>61.0</td>
      <td>264.0</td>
      <td>7.0</td>
      <td>1947.6</td>
      <td>...</td>
      <td>0.002404</td>
      <td>16</td>
      <td>18</td>
      <td>2.0</td>
      <td>510.9</td>
      <td>82.403226</td>
      <td>38.6</td>
      <td>113.4</td>
      <td>0.924447</td>
      <td>0.778039</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 24 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;population unvax&#39;, &#39;population vax&#39;, &#39;population partial&#39;,
       &#39;proportion unvax&#39;, &#39;proportion vax&#39;, &#39;proportion partial&#39;, &#39;not vax&#39;,
       &#39;vax&#39;, &#39;partial vax&#39;, &#39;not vax per 100k&#39;, &#39;vax per 100k&#39;,
       &#39;partial vax 100k&#39;, &#39;Efficacy&#39;, &#39;Efficacy partial&#39;,
       &#39;proportion of unvax&#39;, &#39;severe unvax&#39;, &#39;severe vax&#39;,
       &#39;severe partial vax&#39;, &#39;severe unvax per 100k&#39;, &#39;risk severe 20-29&#39;,
       &#39;severe vax 100k&#39;, &#39;severe parital vax per 1`00k&#39;, &#39;Efficacy severe&#39;,
       &#39;Efficacy severe partial&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">overall</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">overall</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>population unvax                1302911.633129
population vax                  5634633.628302
population partial               219364.972898
proportion unvax                       1.68481
proportion vax                        8.004906
proportion partial                    0.310284
not vax                                10261.0
vax                                    28493.0
partial vax                              901.0
not vax per 100k                        9629.5
vax per 100k                            4649.2
partial vax 100k                        3528.7
Efficacy                              4.770884
Efficacy partial                      6.030771
proportion of unvax                        1.0
severe unvax                               214
severe vax                                 301
severe partial vax                        10.0
severe unvax per 100k                   1096.3
risk severe 20-29                   176.822581
severe vax 100k                          119.1
severe parital vax per 1`00k             230.3
Efficacy severe                       9.352006
Efficacy severe partial                8.80038
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">overall_risk_vax</span> <span class="o">=</span> <span class="n">overall</span><span class="p">[</span><span class="s2">&quot;severe vax&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">overall</span><span class="p">[</span><span class="s2">&quot;population vax&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e5</span>
<span class="n">overall_risk_vax</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.341962226046172
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">overall_risk_unvax</span> <span class="o">=</span> <span class="n">overall</span><span class="p">[</span><span class="s2">&quot;severe unvax&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">overall</span><span class="p">[</span><span class="s2">&quot;population unvax&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="mf">1e5</span>
<span class="n">overall_risk_unvax</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>16.4247516530378
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">age_group</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span>
<span class="n">risk_vax</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;severe vax 100k&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">age_group</span><span class="p">)</span>
<span class="n">risk_unvax</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s2">&quot;severe unvax per 100k&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">age_group</span><span class="p">)</span>
<span class="n">risk_vax</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>age group
12-15     0.0
16-19     0.0
20-29     0.0
30-39     0.2
40-49     1.0
50-59     2.9
60-69     8.7
70-79    19.8
80-89    47.9
90+      38.6
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;age_group&quot;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Probably Overthinking It</p>
<p>Copyright 2022 Allen Downey</p>
<p>The code in this notebook and <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> is under the <a class="reference external" href="https://mit-license.org/">MIT license</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="base_rate.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Fairness and Fallacy</p>
      </div>
    </a>
    <a class="right-next"
       href="progress.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Changing Hearts and Minds</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#old-optimists-young-pessimists">Old Optimists, Young Pessimists</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#real-wages">Real Wages</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#penguins">Penguins</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#simpsons-prescription">Simpson’s Prescription</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#do-vaccines-work-hint-yes">Do vaccines work? Hint: yes.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#debunk-redux">Debunk Redux</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lives-saved">Lives saved</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#sources-and-related-reading">Sources and related reading</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#israeli-data">Israeli Data</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen B. Downey
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>