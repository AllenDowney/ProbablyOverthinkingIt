

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>The Long Tail of Disaster &#8212; Probably Overthinking It</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" href="_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.4045f2051d55cab465a707391d5b2007.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script src="_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]]}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'longtail';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Chasing the Overton Window" href="overton.html" />
    <link rel="prev" title="Causation, Collision, and Confusion" href="birthweight.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="intro.html">
  
  
  
  
  
    <p class="title logo__title">Probably Overthinking It</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="intro.html">
                    Probably Overthinking It
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Chapters</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="gaussian.html">Are You Normal? Hint: No.</a></li>
<li class="toctree-l1"><a class="reference internal" href="inspection.html">Relay Races and Revolving Doors</a></li>
<li class="toctree-l1"><a class="reference internal" href="preston.html">Defy Tradition, Save the World</a></li>
<li class="toctree-l1"><a class="reference internal" href="lognormal.html">Extremes, Outliers, and GOATs</a></li>
<li class="toctree-l1"><a class="reference internal" href="nbue.html">Better Than New</a></li>
<li class="toctree-l1"><a class="reference internal" href="berkson.html">Jumping to Conclusions</a></li>
<li class="toctree-l1"><a class="reference internal" href="birthweight.html">Causation, Collision, and Confusion</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">The Long Tail of Disaster</a></li>
<li class="toctree-l1"><a class="reference internal" href="overton.html">Chasing the Overton Window</a></li>

</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="ansur_pca.html">The Principal Components of Anthropometry</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">


<a href="https://github.com/AllenDowney/ProbablyOverthinkingIt" target="_blank"
   class="btn btn-sm btn-source-repository-button"
   title="Source repository"
   data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>

</a>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="_sources/longtail.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>The Long Tail of Disaster</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-distribution-of-disaster">The Distribution of Disaster</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#earthquakes">Earthquakes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solar-flares">Solar Flares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lunar-craters">Lunar Craters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asteroids">Asteroids</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#origins-of-long-tailed-distributions">Origins of Long-Tailed Distributions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-market-crashes">Stock Market Crashes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-and-gray-swans">Black and Gray Swans</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-a-long-tailed-world">In a Long-Tailed World</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
</pre></div>
</div>
</div>
</div>
<section id="the-long-tail-of-disaster">
<h1>The Long Tail of Disaster<a class="headerlink" href="#the-long-tail-of-disaster" title="Permalink to this heading">#</a></h1>
<p><a class="reference external" href="https://colab.research.google.com/github/AllenDowney/ProbablyOverthinkingIt/blob/book/notebooks/longtail.ipynb">Click here to run this notebook on Colab</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Install empiricaldist if we don&#39;t already have it</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">import</span> <span class="nn">empiricaldist</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>empiricaldist
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># download utils.py</span>

<span class="kn">from</span> <span class="nn">os.path</span> <span class="kn">import</span> <span class="n">basename</span><span class="p">,</span> <span class="n">exists</span>

<span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="n">url</span><span class="p">):</span>
    <span class="n">filename</span> <span class="o">=</span> <span class="n">basename</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">exists</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">urlretrieve</span>
        <span class="n">local</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">urlretrieve</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Downloaded &#39;</span> <span class="o">+</span> <span class="n">local</span><span class="p">)</span>
        
<span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://github.com/AllenDowney/ProbablyOverthinkingIt/raw/book/notebooks/utils.py&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">decorate</span><span class="p">,</span> <span class="n">set_pyplot_params</span>

<span class="n">set_pyplot_params</span><span class="p">()</span>

<span class="c1"># Set the random seed so we get the same results every time</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">empiricaldist</span> <span class="kn">import</span> <span class="n">Surv</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">plot_error_bounds</span>


<span class="k">def</span> <span class="nf">plot_two</span><span class="p">(</span><span class="n">surv</span><span class="p">,</span> <span class="n">surv_model</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plots tail distributions on linear-y and log-y scales</span>
<span class="sd">    </span>
<span class="sd">    surv: Surv</span>
<span class="sd">    surv_model: Surv</span>
<span class="sd">    n: sample size passed to plot_error_bounds</span>
<span class="sd">    hatch: string passed to fill_between</span>
<span class="sd">    title: string title</span>
<span class="sd">    </span>
<span class="sd">    Uses global variables model_label, ylabel, xlabel, xticks, yticks, xlabels, ylabels</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">surv_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">model_label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="n">plot_error_bounds</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">surv_model</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
    <span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
    <span class="n">decorate</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">sca</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">surv_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">model_label</span><span class="p">)</span>
    <span class="n">plot_error_bounds</span><span class="p">(</span><span class="n">Surv</span><span class="p">(</span><span class="n">surv_model</span><span class="p">),</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">hatch</span><span class="o">=</span><span class="n">hatch</span><span class="p">)</span>
    <span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
    <span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">axs</span>
</pre></div>
</div>
</div>
</div>
<p>You would think we’d be better prepared for disaster.
But events like Hurricane Katrina in 2005, which caused catastrophic flooding in New Orleans,
and Hurricane Maria in 2017, which caused damage in Puerto Rico that has still not been repaired,
show that large-scale disaster response is often inadequate.
Even wealthy countries – with large government agencies that respond to emergencies and well-funded organizations that provide disaster relief – have been caught unprepared time and again.</p>
<p>The are many reasons for these failures, but one of them is that rare, large events are fundamentally hard to comprehend.
Because they are rare, it is hard to get the data we need to estimate precisely how rare.
And because they are large, they challenge our ability to imagine quantities that are orders of magnitude bigger than what we experience in ordinary life.</p>
<p>My goal in this chapter is to present the tools we need to comprehend the small probabilities of large events so that, maybe, we will be better prepared next time.</p>
<section id="the-distribution-of-disaster">
<h2>The Distribution of Disaster<a class="headerlink" href="#the-distribution-of-disaster" title="Permalink to this heading">#</a></h2>
<p>Natural and human-caused disasters are highly variable.
The worst disasters, in terms of both lives lost and property destroyed, are thousands of times bigger than smaller, more common disasters.</p>
<p>That fact might not be surprising, but there is a pattern to these costs that is less obvious.
One way to see this pattern is to plot the magnitudes of the biggest disasters on a logarithmic scale.
To demonstrate, I’ll use the estimated costs from a list of 125 disasters on Wikipedia.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># I archived a copy of https://en.wikipedia.org/wiki/List_of_disasters_by_cost</span>
<span class="c1"># on June 3, 2022</span>

<span class="n">DATA_PATH</span> <span class="o">=</span> <span class="s2">&quot;https://github.com/AllenDowney/ProbablyOverthinkingIt/raw/book/data/&quot;</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;List_of_disasters_by_cost.html&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you want a more recent list, try this, but it might not work if the</span>
<span class="c1"># page has been reorganized.</span>

<span class="c1"># download(&quot;https://en.wikipedia.org/wiki/List_of_disasters_by_cost&quot;)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">tables</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_html</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disasters</span> <span class="o">=</span> <span class="n">tables</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">disasters</span><span class="p">))</span>
<span class="n">disasters</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>125
</pre></div>
</div>
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Cost ($billions)</th>
      <th>Fatalities</th>
      <th>Event</th>
      <th>Type</th>
      <th>Year</th>
      <th>Nation</th>
    </tr>
    <tr>
      <th></th>
      <th>Unnamed: 0_level_1</th>
      <th>(2021)[5]</th>
      <th>Fatalities</th>
      <th>Event</th>
      <th>Type</th>
      <th>Year</th>
      <th>Nation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[2]</td>
      <td>NaN</td>
      <td>4000 - 200000[6]</td>
      <td>Chernobyl disaster [1]</td>
      <td>Contamination (Radioactive)</td>
      <td>1986</td>
      <td>Soviet Union (, )</td>
    </tr>
    <tr>
      <th>1</th>
      <td>$360[7][8][4]</td>
      <td>$423.7 (2021)</td>
      <td>19747</td>
      <td>2011 Tōhoku earthquake and tsunami</td>
      <td>Earthquake, Tsunami, Contamination (Radioactive)</td>
      <td>2011</td>
      <td>Japan</td>
    </tr>
    <tr>
      <th>2</th>
      <td>$197[9]</td>
      <td>$344.7 (2021)</td>
      <td>NaN</td>
      <td>Great Hanshin earthquake</td>
      <td>Earthquake</td>
      <td>1995</td>
      <td>Japan</td>
    </tr>
    <tr>
      <th>3</th>
      <td>$148[10]</td>
      <td>$179.7 (2021)</td>
      <td>87587</td>
      <td>2008 Sichuan earthquake</td>
      <td>Earthquake</td>
      <td>2008</td>
      <td>China</td>
    </tr>
    <tr>
      <th>4</th>
      <td>$125[11]</td>
      <td>$167.4 (2021)</td>
      <td>NaN</td>
      <td>Hurricane Katrina</td>
      <td>Tropical cyclone</td>
      <td>2005</td>
      <td>United States</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Most of the disasters on the list are natural, including 56 tropical cyclones and other windstorms, 16 earthquakes, 8 wildfires, 8 floods, and 6 tornadoes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">disasters</span><span class="p">[</span><span class="s2">&quot;Type&quot;</span><span class="p">,</span> <span class="s2">&quot;Type&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(Type, Type)
Tropical cyclone                                    49
Earthquake                                          16
Wildfire                                             8
Flood                                                8
European windstorm                                   7
Tornado                                              6
Space flight accident                                3
Drought                                              3
Hailstorm                                            3
Structure failure                                    2
Contamination (Oil)                                  2
Terror attack                                        2
Volcano                                              2
Winter storm                                         2
Explosion                                            2
Contamination (Radioactive)                          1
Contamination (Radiation)                            1
Maritime disaster                                    1
Severe Thunderstorm                                  1
Drought, Wildfire                                    1
Severe storm                                         1
Earthquake, Tsunami, Contamination (Radioactive)     1
Earthquake, Tsunami                                  1
Winter storm, power outage                           1
Fire                                                 1
Name: count, dtype: int64
</pre></div>
</div>
</div>
</div>
<p>Some of the costs are reported as a range, so I compute the midpoints.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">costs</span> <span class="o">=</span> <span class="n">disasters</span><span class="p">[</span><span class="s2">&quot;Cost ($billions)&quot;</span><span class="p">,</span> <span class="s2">&quot;(2021)[5]&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">774.9</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">72.2</span> <span class="o">+</span> <span class="mf">120.4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">56.9</span> <span class="o">+</span> <span class="mf">64.4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">25</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">32.2</span> <span class="o">+</span> <span class="mf">199.1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">35</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">27.1</span> <span class="o">+</span> <span class="mf">36.1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">44</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">18.3</span> <span class="o">+</span> <span class="mf">29.8</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">49</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">10.9</span> <span class="o">+</span> <span class="mf">16.4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">62</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">9.8</span> <span class="o">+</span> <span class="mf">17.0</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">111</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">1.8</span> <span class="o">+</span> <span class="mf">2.8</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">costs</span><span class="p">[</span><span class="mi">119</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mf">4.1</span> <span class="o">+</span> <span class="mf">5.6</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span>
<span class="n">disasters</span><span class="p">[</span><span class="n">costs</span><span class="o">.</span><span class="n">isna</span><span class="p">()]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead tr th {
        text-align: left;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr>
      <th></th>
      <th colspan="2" halign="left">Cost ($billions)</th>
      <th>Fatalities</th>
      <th>Event</th>
      <th>Type</th>
      <th>Year</th>
      <th>Nation</th>
    </tr>
    <tr>
      <th></th>
      <th>Unnamed: 0_level_1</th>
      <th>(2021)[5]</th>
      <th>Fatalities</th>
      <th>Event</th>
      <th>Type</th>
      <th>Year</th>
      <th>Nation</th>
    </tr>
  </thead>
  <tbody>
  </tbody>
</table>
</div></div></div>
</div>
<p>Remove the dollar signs and convert to float.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">cost</span> <span class="ow">in</span> <span class="n">costs</span><span class="p">:</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">cost</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;$&quot;</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">cost</span>
    <span class="k">assert</span> <span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">float</span>
    <span class="n">xs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="n">xs</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">reverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Get the magnitudes and ranks</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
<span class="n">ranks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows a “rank-size plot” of the data: the x-axis shows the ranks of the disasters from 1 to 125, where 1 is the most costly; the y-axis shows their costs in billions of U.S. dollars.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ranks</span><span class="p">,</span> <span class="n">xs</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Rank (1 to 125)&quot;</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Cost (billions of 2021 dollars)&quot;</span><span class="p">,</span>
    <span class="n">xscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Rank-size plot for cost of disasters&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xticks</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticks</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail1.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/c29991320b86a655b1cee80ca20dbca2a2016eb48625a7d19289b4d712de8e97.png" src="_images/c29991320b86a655b1cee80ca20dbca2a2016eb48625a7d19289b4d712de8e97.png" />
</div>
</div>
<p>With both axes on a log scale, the rank-size plot is a nearly straight line, at least for the top 100 disasters.
And the slope of this line is close to 1, which implies that each time we double the rank, we cut the costs by one half.
That is, compared to the costliest disaster, the cost of the second-worst is one half; the cost of the fourth-worst is one quarter; the cost of the eighth is one eighth, and so on.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">index</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">16</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">64</span><span class="p">])</span> <span class="o">-</span> <span class="mi">1</span>
<span class="n">steps</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">mags</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
<span class="n">steps</span> <span class="o">/=</span> <span class="n">steps</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="mi">1</span> <span class="o">/</span> <span class="n">steps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 1.        ,  1.82888836,  4.31218698,  6.70038911, 12.77658697,
       31.62857143, 74.50961538])
</pre></div>
</div>
</div>
</div>
<p>To visualize disaster sizes, I will show the “tail distribution”, which is the complement of the cumulative distribution function (CDF).
The following figure shows the tail distribution of the 125 costliest disasters, on a log scale, along with a lognormal model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">make_surv</span><span class="p">,</span> <span class="n">fit_truncated_normal</span>

<span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_normal</span><span class="p">(</span><span class="n">surv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.07816053 0.57668442]
[1.07816055 0.57668442]
[1.07816053 0.57668444]
[1.04133203 0.54825645]
[1.04133204 0.54825645]
[1.04133203 0.54825647]
[1.04293263 0.54534355]
[1.04293265 0.54534355]
[1.04293263 0.54534356]
[1.04292536 0.54517372]
[1.04292537 0.54517372]
[1.04292536 0.54517373]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">surv</span><span class="o">=</span><span class="n">surv</span><span class="p">))</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;magnitude&#39;</span>
<span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>magnitude</th>
      <th>surv</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>-0.221849</td>
      <td>1.000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.154902</td>
      <td>0.992</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.096910</td>
      <td>0.984</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.000000</td>
      <td>0.976</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.079181</td>
      <td>0.960</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>103</th>
      <td>2.223755</td>
      <td>0.040</td>
    </tr>
    <tr>
      <th>104</th>
      <td>2.254548</td>
      <td>0.032</td>
    </tr>
    <tr>
      <th>105</th>
      <td>2.537441</td>
      <td>0.024</td>
    </tr>
    <tr>
      <th>106</th>
      <td>2.627058</td>
      <td>0.016</td>
    </tr>
    <tr>
      <th>107</th>
      <td>2.889246</td>
      <td>0.008</td>
    </tr>
  </tbody>
</table>
<p>108 rows × 2 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;disaster_magnitude.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="o">!</span>head<span class="w"> </span>disaster_magnitude.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>magnitude,surv
-0.22184874961635637,1.0
-0.1549019599857432,0.9920000000000007
-0.09691001300805639,0.9840000000000007
0.0,0.9760000000000006
0.07918124604762482,0.9600000000000006
0.11394335230683678,0.9520000000000006
0.146128035678238,0.9440000000000006
0.20411998265592482,0.9360000000000006
0.2787536009528289,0.9280000000000006
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">truncated_normal_sf</span>

<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mags</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">truncated_normal_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Percentage with cost ≥ $x$&quot;</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Cost (billions of 2021 dollars)&quot;</span>

<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xlabels</span><span class="p">)</span>

<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="s2">&quot;10%&quot;</span><span class="p">,</span> <span class="s2">&quot;1%&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="s2">&quot;75%&quot;</span><span class="p">,</span> <span class="s2">&quot;50%&quot;</span><span class="p">,</span> <span class="s2">&quot;25%&quot;</span><span class="p">,</span> <span class="s2">&quot;0%&quot;</span><span class="p">]</span>
<span class="n">yticks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([1.  , 0.75, 0.5 , 0.25, 0.  ])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_linear</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">xs</span><span class="p">)</span>
<span class="n">surv_linear</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of disaster costs&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail1a.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f5bfdb36bc9a5f556c9cde9c5f4c9ba25a24d318bfadde682158eb6a6502919f.png" src="_images/f5bfdb36bc9a5f556c9cde9c5f4c9ba25a24d318bfadde682158eb6a6502919f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of disaster costs, log scale&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail1b.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8b0984596e5fedd293862854bf791a58969b83f688787593506f296a7d7ffe8a.png" src="_images/8b0984596e5fedd293862854bf791a58969b83f688787593506f296a7d7ffe8a.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lognormal model&quot;</span><span class="p">)</span>
<span class="n">plot_error_bounds</span><span class="p">(</span><span class="n">surv_model</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C1&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of disaster costs, log scale&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail2.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/888c3619ce3184eedd4738e94c9af635a2b15bc7ca9f9bc7b365767e3f359f75.png" src="_images/888c3619ce3184eedd4738e94c9af635a2b15bc7ca9f9bc7b365767e3f359f75.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.976, 0.544, 0.072])
</pre></div>
</div>
</div>
</div>
<p>The dashed line shows the fraction of disasters that exceed each magnitude of cost.
For example, 98% of the disasters exceed a cost of <span class="math notranslate nohighlight">\(1 billion, 54% exceed \)</span>10 billion, and 7% exceed $100 billion.</p>
<p>The gray line shows a lognormal model I chose to fit the data; the shaded area shows how much variation we expect with a sample size of 125.
Most of the data fall within the bounds of the shaded area, which means that they are consistent with the lognormal model.</p>
<p>However, if you look closely, there are more large-cost disasters than we expect in a lognormal distribution.
To see this part of the distribution more clearly, we can plot the y-axis on a log scale; the following figure shows what that looks like.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">y2</span> <span class="o">*</span> <span class="mf">1e3</span><span class="p">,</span> <span class="n">y1</span> <span class="o">/</span> <span class="n">y2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(15.999999999999897, 1.2081898734673209, 13.24295158515303)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># The Surv object doesn&#39;t interpolate, so y1 ends up too high in this example</span>

<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>

<span class="n">interp</span> <span class="o">=</span> <span class="n">interp1d</span><span class="p">(</span><span class="n">surv</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">surv</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=</span><span class="s2">&quot;extrapolate&quot;</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">interp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="n">surv_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Lognormal model&quot;</span><span class="p">)</span>
<span class="n">plot_error_bounds</span><span class="p">(</span><span class="n">surv_model</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C2&quot;</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">)</span>
<span class="n">plot_error_bounds</span><span class="p">(</span><span class="n">surv_model</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">xticks</span><span class="p">,</span> <span class="n">xlabels</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span>
    <span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="n">ylabel</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of disaster costs, log-log scale&quot;</span><span class="p">,</span>
    <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;100%&quot;</span><span class="p">,</span> <span class="s2">&quot;10%&quot;</span><span class="p">,</span> <span class="s2">&quot;1%&quot;</span><span class="p">,</span> <span class="s2">&quot;0.1%&quot;</span><span class="p">]</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">ylabels</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail3.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/d28819a69c97092023e77b1e1f449951d96443b98e29cf3d8f34586f0539f345.png" src="_images/d28819a69c97092023e77b1e1f449951d96443b98e29cf3d8f34586f0539f345.png" />
</div>
</div>
<p>Again, the shaded area shows how much variation we expect in a sample of this size from a lognormal model.</p>
<p>Now we can see more clearly where the model diverges from the data and by how much.
For example, the vertical dotted line shows the discrepancy at $500 billion.
According to the model, only 1 out of 1000 disasters should exceed this cost, but the actual rate is 16 per 1000.</p>
<p>To make better predictions, we need a model that accurately estimates the probability of large disasters.
In the literature of long-tailed distributions, there are several to choose from; the one I found that best matches the data is Student’s <span class="math notranslate nohighlight">\(t\)</span>-distribution.</p>
<p>The shape of the <span class="math notranslate nohighlight">\(t\)</span>-distribution is a bell curve similar to a Gaussian, but the tails extend farther to the right and left.
It has two parameters that determine the center point and width of the curve, like the Gaussian distribution, plus a third parameter that controls the thickness of the tails, that is, what fraction of the values extend far from the mean.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span> <span class="k">as</span> <span class="n">t_dist</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">201</span><span class="p">)</span>
<span class="n">ys1</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Standard normal&#39;</span><span class="p">)</span>

<span class="n">df</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">ys2</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Student t with df=10&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;PDF&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail3a.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5ad0a0aef464e4037d25c4425177719ad0d552b121b10595fc94589da5e86109.png" src="_images/5ad0a0aef464e4037d25c4425177719ad0d552b121b10595fc94589da5e86109.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span> <span class="k">as</span> <span class="n">t_dist</span>

<span class="n">xs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">ys1</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys1</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Standard normal&#39;</span><span class="p">)</span>

<span class="n">ys2</span> <span class="o">=</span> <span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xs</span><span class="p">,</span> <span class="n">ys2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Student t with df=10&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Prob magnitude $&gt;$ x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail3b.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/af4549c01be85a514c8495d345232e2298b9daeb0554d96434f5ae295353259b.png" src="_images/af4549c01be85a514c8495d345232e2298b9daeb0554d96434f5ae295353259b.png" />
</div>
</div>
<p>Since I am using a <span class="math notranslate nohighlight">\(t\)</span>-distribution to fit the logarithms of the values, I’ll call the result a log-<span class="math notranslate nohighlight">\(t\)</span> model.
The following figures shows the distribution of costs again, along with a log-<span class="math notranslate nohighlight">\(t\)</span> model I chose to fit the data.
In the top figure, the y-axis shows the fraction of disasters on a linear scale;
in the bottom figure, the y-axis shows the same fractions on a log scale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">minimize_df</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">fit_truncated_t</span>

<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([3.52824501]), 1.0165307353889603, 0.488752041667769)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">truncated_t_sf</span>

<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model2</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Fraction with cost ≥ x&quot;</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="n">yticks</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model2</span><span class="p">,</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of disaster costs with log-$t$ model&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail4.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/4ec11813b1f2cf8478ff70022a86b147b7a417d4ff93aa1c0a5bf61acfb8d079.png" src="_images/4ec11813b1f2cf8478ff70022a86b147b7a417d4ff93aa1c0a5bf61acfb8d079.png" />
</div>
</div>
<p>In the top figure, we see that the data fall within the shaded area over the entire range of the distribution.
In the bottom figure, we see that the model fits the data well even in the extreme tail.</p>
<p>The agreement between the model and the data provides a hint about why the distribution might have this shape.
Mathematically, Student’s <span class="math notranslate nohighlight">\(t\)</span> distribution is a mixture of Gaussian distributions with different standard deviations.</p>
<p>The following figure was not included in the book, but it shows that if we generate values from Gaussian distributions with different standard deviations (drawn from an inverse gamma distribution), the values follow a <em>t</em> distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">invgamma</span>

<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">df</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">invgamma</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">125</span><span class="p">))</span>
<span class="n">sigma</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="n">sigma</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.6007941329583358, 0.1717044227431617)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">norm</span>

<span class="n">mu</span> <span class="o">=</span> <span class="mf">1.04</span>
<span class="n">sample</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">rvs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_sample</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">sample</span><span class="p">[</span><span class="n">sample</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mf">0.4</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Mix of lognormal&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_sample</span><span class="p">,</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of distaster costs with lognormal mixture&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">ylim</span><span class="o">=</span><span class="p">[</span><span class="mf">5e-3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail5.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/92c884c20d2dbc4ee2b065aa00301f2c034f0c5805e11685028c3a3f66035e7e.png" src="_images/92c884c20d2dbc4ee2b065aa00301f2c034f0c5805e11685028c3a3f66035e7e.png" />
</div>
</div>
</section>
<section id="earthquakes">
<h2>Earthquakes<a class="headerlink" href="#earthquakes" title="Permalink to this heading">#</a></h2>
<p>To describe the magnitudes of earthquakes, I downloaded data from the Southern California Earthquake Data Center.
Their archive goes all the way back to 1932, but the sensors they use and their coverage have changed over that time.
For consistency, I selected data from January 1981 to April 2022, which includes records of 791,329 earthquakes.</p>
<p>For information on catalog completeness and data sources, see <a class="reference external" href="http://www.data.scec.org/about/data_avail.html">http://www.data.scec.org/about/data_avail.html</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># This version of quake.csv includes more recent data than the version in the book,</span>
<span class="c1"># so the results are a little different.</span>

<span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;quake.csv&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">quake_df</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(803451, 4)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>#YYY</th>
      <th>MM</th>
      <th>DD</th>
      <th>MAG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1981</td>
      <td>1</td>
      <td>1</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1981</td>
      <td>1</td>
      <td>1</td>
      <td>2.3</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1981</td>
      <td>1</td>
      <td>1</td>
      <td>2.4</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1981</td>
      <td>1</td>
      <td>1</td>
      <td>1.6</td>
    </tr>
    <tr>
      <th>4</th>
      <td>1981</td>
      <td>1</td>
      <td>1</td>
      <td>1.9</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake_df</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>#YYY</th>
      <th>MM</th>
      <th>DD</th>
      <th>MAG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>803446</th>
      <td>2022</td>
      <td>12</td>
      <td>31</td>
      <td>0.5</td>
    </tr>
    <tr>
      <th>803447</th>
      <td>2022</td>
      <td>12</td>
      <td>31</td>
      <td>1.0</td>
    </tr>
    <tr>
      <th>803448</th>
      <td>2022</td>
      <td>12</td>
      <td>31</td>
      <td>0.9</td>
    </tr>
    <tr>
      <th>803449</th>
      <td>2022</td>
      <td>12</td>
      <td>31</td>
      <td>0.6</td>
    </tr>
    <tr>
      <th>803450</th>
      <td>2022</td>
      <td>12</td>
      <td>31</td>
      <td>0.6</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">year</span> <span class="o">=</span> <span class="n">quake_df</span><span class="p">[</span><span class="s2">&quot;#YYY&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;1989&quot;</span>
<span class="n">year</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;MAG&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>#YYY</th>
      <th>MM</th>
      <th>DD</th>
      <th>MAG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>102346</th>
      <td>1987</td>
      <td>11</td>
      <td>24</td>
      <td>6.2</td>
    </tr>
    <tr>
      <th>163645</th>
      <td>1992</td>
      <td>6</td>
      <td>28</td>
      <td>6.3</td>
    </tr>
    <tr>
      <th>674787</th>
      <td>2019</td>
      <td>7</td>
      <td>4</td>
      <td>6.4</td>
    </tr>
    <tr>
      <th>408783</th>
      <td>2003</td>
      <td>12</td>
      <td>22</td>
      <td>6.5</td>
    </tr>
    <tr>
      <th>102647</th>
      <td>1987</td>
      <td>11</td>
      <td>24</td>
      <td>6.6</td>
    </tr>
    <tr>
      <th>224869</th>
      <td>1994</td>
      <td>1</td>
      <td>17</td>
      <td>6.7</td>
    </tr>
    <tr>
      <th>335296</th>
      <td>1999</td>
      <td>10</td>
      <td>16</td>
      <td>7.1</td>
    </tr>
    <tr>
      <th>678320</th>
      <td>2019</td>
      <td>7</td>
      <td>6</td>
      <td>7.1</td>
    </tr>
    <tr>
      <th>492576</th>
      <td>2010</td>
      <td>4</td>
      <td>4</td>
      <td>7.2</td>
    </tr>
    <tr>
      <th>163589</th>
      <td>1992</td>
      <td>6</td>
      <td>28</td>
      <td>7.3</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">quake_df</span><span class="p">[</span><span class="s2">&quot;MAG&quot;</span><span class="p">]</span>
<span class="n">mags</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    803451.000000
mean          1.388616
std           0.658252
min           0.000000
25%           0.900000
50%           1.300000
75%           1.800000
max           7.300000
Name: MAG, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">mags</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.8159564180018446
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quake_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;#YYY&quot;</span><span class="p">)[</span><span class="s2">&quot;MAG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count       40.000000
mean     19397.050000
std      11049.695313
min      10092.000000
25%      13467.500000
50%      16186.000000
75%      20463.000000
max      63571.000000
Name: MAG, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>803451
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_normal</span><span class="p">(</span><span class="n">surv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[1.48860875 0.65822228]
[1.48860877 0.65822228]
[1.48860875 0.6582223 ]
[1.37983937 0.66707222]
[1.37983939 0.66707222]
[1.37983937 0.66707224]
[1.38099766 0.65403304]
[1.38099768 0.65403304]
[1.38099766 0.65403305]
[1.38080268 0.65402889]
[1.3808027  0.65402889]
[1.38080268 0.65402891]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mags</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">truncated_normal_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The following figure shows the distribution of moment magnitudes compared to a Gaussian model, which is a lognormal model in terms of energy.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Magnitude (log energy)&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Fraction with mag ≥ $x$&quot;</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="n">xticks</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-7</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-6}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-7}$&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Lognormal model&quot;</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">surv_model</span> <span class="o">&gt;</span> <span class="mf">2e-7</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model</span><span class="p">[</span><span class="n">cutoff</span><span class="p">],</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Earthquake magnitudes with lognormal model&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail6.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/b4d5ca7ab533542c3676fe05e3701cfed824d9fc9c4c52a24d694ee910ad8ca2.png" src="_images/b4d5ca7ab533542c3676fe05e3701cfed824d9fc9c4c52a24d694ee910ad8ca2.png" />
</div>
</div>
<p>If you only look at the top figure, you might think the lognormal model is good enough.
But the probabilities for magnitudes greater than 3 are so small that differences between the model and the data are not visible.</p>
<p>The bottom figure, with the y-axis on a log scale, shows the tail more clearly.
Here we can see that the lognormal model drops off more quickly than the data.
According to the model, the fraction of earthquakes with magnitude 4 or more should be about 33 per million.
But the actual fraction of earthquakes this big is about 1800 per million, more than 50 times higher.</p>
<p>For larger earthquakes, the discrepancy is even bigger.
According to the model, fewer than one earthquake in a million should exceed magnitude 5; in reality, about 170 per million do.
If your job is to predict large earthquakes, and you underestimate their frequency by a factor of 170, you are in trouble.</p>
<p>The following figures show the same distribution compared to a log-<span class="math notranslate nohighlight">\(t\)</span> model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y1</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">y2</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">y1</span> <span class="o">/</span> <span class="n">y2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1784.8008154824963, 31.897268299459753, 55.9546604030893)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e7</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(168.02518137406247, 0.15958924021795134)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">7</span>
<span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e18</span>

<span class="c1"># 6.318484473557436, 4.618502751454663</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6.223154865724416, 4.406280129716829)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([9.07638598]), 1.3634555603669711, 0.6375531964799466)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">t</span> <span class="k">as</span> <span class="n">t_dist</span>

<span class="n">y7</span><span class="p">,</span> <span class="n">y8</span><span class="p">,</span> <span class="n">y9</span> <span class="o">=</span> <span class="n">t_dist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sf</span><span class="p">([</span><span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quakes_per_year</span> <span class="o">=</span> <span class="n">quake_df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;#YYY&quot;</span><span class="p">)[</span><span class="s2">&quot;MAG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">quakes_per_year</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>19129.785714285714
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y522</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">522</span> <span class="o">/</span> <span class="n">quakes_per_year</span>
<span class="n">y522</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.0014272197675095e-07
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model2</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">9</span><span class="p">)</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="n">xticks</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model2</span><span class="p">,</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Earthquake magnitudes with log-$t$ model&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="c1">#plt.plot(8, y8, &quot;s&quot;, color=&quot;C0&quot;, alpha=0.6)</span>
<span class="c1">#plt.plot(8, y522, &quot;o&quot;, color=&quot;C1&quot;, alpha=0.6)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail7.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9821dc3e86a10e72212efe8cda691447d026647f464c8a1658d3ab5b49cd54d2.png" src="_images/9821dc3e86a10e72212efe8cda691447d026647f464c8a1658d3ab5b49cd54d2.png" />
</div>
</div>
<p>The top figure shows that the log-<span class="math notranslate nohighlight">\(t\)</span> model fits the distribution well for magnitudes less than 3.
The bottom figure shows that it also fits the tail of the distribution.</p>
<p>If we extrapolate beyond the data, we can use this model to compute the probability of earthquakes larger than the ones we have seen so far.
For example, the square marker shows the predicted probability of an earthquake with magnitude 8, which is about 1.2 per million.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y8</span> <span class="o">*</span> <span class="mf">1e6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.197711963360669
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">/</span> <span class="n">quakes_per_year</span> <span class="o">/</span> <span class="n">y8</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>43.645302435809846
</pre></div>
</div>
</div>
</div>
<p>The number of earthquakes in this dataset is about 18,800 per year; at that rate we should expect an earthquake that exceeds magnitude 8 every 43 years, on average.
To see how credible that expectation is, let’s compare it to predictions from sources more knowledgeable than me.</p>
<p>In 2015, the U.S. Geological Survey (USGS) published the third revision of the Uniform California Earthquake Rupture Forecast (UCERF3).
It predicts that we should expect earthquakes in Southern California that exceed magnitude 8 at a rate of one per 522 years.
The circle marker in the figure shows the corresponding probability.</p>
<p>Their forecast is compatible with mine in the sense that it falls within the shaded area that represents the uncertainty of the model.
In other words, my model concedes that the predicted probability of a magnitude 8 earthquake could be off by a factor of 10, based on the data we have.
Nevertheless, if you own a building in California, or provide insurance for one, a factor of 10 is a big difference.
So you might wonder which model to believe, theirs or mine.</p>
<p>To find out, let’s see how their predictions from 2015 have turned out so far.
For comparison, I ran the log-<span class="math notranslate nohighlight">\(t\)</span> model again using only data from prior to 2015.
The following figure shows their predictions, mine, and the actual number of earthquakes that exceeded each magnitude in the 7.3 years between January 2015 and May 2022.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://pubs.usgs.gov/fs/2015/3009/pdf/fs2015-3009.pdf</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">prefix</span> <span class="o">=</span> <span class="n">quake_df</span><span class="p">[</span><span class="s2">&quot;#YYY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2015</span>
<span class="n">quakes_per_year</span> <span class="o">=</span> <span class="n">quake_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prefix</span><span class="p">]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;#YYY&quot;</span><span class="p">)[</span><span class="s2">&quot;MAG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">quakes_per_year</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17524.264705882353
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">quake_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">prefix</span><span class="p">,</span> <span class="s2">&quot;MAG&quot;</span><span class="p">]</span>
<span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([8.41547484]), 1.4816444224709593, 0.6026839581707539)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert UCERF predictions to quakes per 7.33 years</span>

<span class="n">pred_years</span> <span class="o">=</span> <span class="mf">7.33</span>
<span class="n">ucerf</span> <span class="o">=</span> <span class="n">pred_years</span> <span class="o">/</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">([</span><span class="mf">0.24</span><span class="p">,</span> <span class="mf">2.3</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">87</span><span class="p">,</span> <span class="mi">522</span><span class="p">],</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mf">7.5</span><span class="p">,</span> <span class="mi">8</span><span class="p">])</span>
<span class="n">ucerf</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.0    30.541667
6.0     3.186957
6.7     0.610833
7.0     0.293200
7.5     0.084253
8.0     0.014042
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert log-t predictions to quakes per 7.33 years</span>

<span class="n">a</span> <span class="o">=</span> <span class="n">t_dist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">ucerf</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">*</span> <span class="n">quakes_per_year</span> <span class="o">*</span> <span class="n">pred_years</span>
<span class="n">logt</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">ucerf</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">logt</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.0    20.567019
6.0     3.414845
6.7     1.152932
7.0     0.750355
7.5     0.382366
8.0     0.204125
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the actual number of quakes since 2015</span>

<span class="n">suffix</span> <span class="o">=</span> <span class="n">quake_df</span><span class="p">[</span><span class="s2">&quot;#YYY&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2015</span>
<span class="n">suffix</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="n">quakes_per_year</span> <span class="o">*</span> <span class="n">pred_years</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(207626, 128452.86029411765)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">quake_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">suffix</span><span class="p">,</span> <span class="s2">&quot;MAG&quot;</span><span class="p">]</span>
<span class="n">actual</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mf">5.3</span><span class="p">,</span> <span class="mf">5.7</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mf">6.3</span><span class="p">,</span> <span class="mf">6.7</span><span class="p">,</span> <span class="mi">7</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">for</span> <span class="n">thresh</span> <span class="ow">in</span> <span class="n">actual</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
    <span class="n">actual</span><span class="p">[</span><span class="n">thresh</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">mags</span> <span class="o">&gt;</span> <span class="n">thresh</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">actual</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.0    10.0
5.3     7.0
5.7     3.0
6.0     2.0
6.3     2.0
6.7     1.0
7.0     1.0
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">actual</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">actual</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;actual&quot;</span><span class="p">)</span>
<span class="n">logt</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;s:&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;log-$t$&quot;</span><span class="p">)</span>
<span class="n">ucerf</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s2">&quot;o--&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;UCERF3&quot;</span><span class="p">)</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="n">xlabel</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Number of quakes&quot;</span><span class="p">,</span> <span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">actual</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">20</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="n">yticks</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yticks</span><span class="p">(</span><span class="n">yticks</span><span class="p">,</span> <span class="n">yticks</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail8.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/7ed046ebc531df1cff4d5a4410b48bd5cef50cceaaa002423b08d9d52bc32dd3.png" src="_images/7ed046ebc531df1cff4d5a4410b48bd5cef50cceaaa002423b08d9d52bc32dd3.png" />
</div>
</div>
<p>Starting on the left, the UCERF model predicted that there would be 30 earthquakes in this interval with magnitude 5.0 or more.
The log-<span class="math notranslate nohighlight">\(t\)</span> model predicted 20.
In fact, there were 10.
So there were fewer large earthquakes than either model predicted.</p>
<p>Near the middle of the figure, both models predicted 3 earthquakes with magnitude 6.0 or more.
In fact, there were two, so both models were close.</p>
<p>On the right, the UCERF model expects 0.3 earthquakes with magnitude 7.0 or more in 7.3 years.
The log-<span class="math notranslate nohighlight">\(t\)</span> expects 0.8 earthquakes of this size in the same interval.
In fact, there was one: the main shock of the 2019 Ridgecrest earthquake sequence measured 7.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://en.wikipedia.org/wiki/2019_Ridgecrest_earthquakes</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">ucerf</span> <span class="o">/</span> <span class="mf">7.33</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.0      0.24
6.0      2.30
6.7     12.00
7.0     25.00
7.5     87.00
8.0    522.00
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">logt</span> <span class="o">/</span> <span class="mf">7.33</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>5.0     0.356396
6.0     2.146510
6.7     6.357705
7.0     9.768712
7.5    19.170102
8.0    35.909361
dtype: float64
</pre></div>
</div>
</div>
</div>
<p>The discrepancy between the two models increases for larger earthquakes.
The UCERF model estimates 87 years between earthquakes that exceed 7.5; the log-<span class="math notranslate nohighlight">\(t\)</span> model estimates only 19.
The UCERF model estimates 522 years between earthquakes that exceed 8.0; the log-<span class="math notranslate nohighlight">\(t\)</span> model estimates only 36.</p>
</section>
<section id="solar-flares">
<h2>Solar Flares<a class="headerlink" href="#solar-flares" title="Permalink to this heading">#</a></h2>
<p>The Space Weather Prediction Center (SWPC) monitors and predicts solar activity and its effects on Earth.
Since 1974 it has operated the Geostationary Operational Environmental Satellite system (GOES).
Several of the satellites in this system carry sensors that measure solar flares.
Data from these sensors, going back to 1975, is available for download.</p>
<p>Since 1997, these datasets include “integrated flux” – the kind of term science fiction writers love – which measures the total energy from a solar flare that would pass through a given area.
The magnitude of this flux is one way to quantify its potential for impact on Earth.
This dataset includes measurements from more than 36,000 solar flares.
The following figure shows the distribution of their magnitudes compared to a lognormal model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Kurtzgesagt https://www.youtube.com/watch?v=oHHSSJDJ4oo</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;flares.csv&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flares_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">flares</span> <span class="o">=</span> <span class="n">flares_df</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">flares</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(36560,)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">flares</span><span class="p">)</span>
<span class="n">mags</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    36560.000000
mean        -3.058657
std          0.691503
min         -5.022276
25%         -3.537602
50%         -3.080922
75%         -2.619789
max          0.414973
Name: 0, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>36560
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_normal</span><span class="p">(</span><span class="n">surv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[-3.04218419  0.69158557]
[-3.04218423  0.69158557]
[-3.04218419  0.69158559]
[-3.0738114   0.68338351]
[-3.07381145  0.68338351]
[-3.0738114   0.68338353]
[-3.07353797  0.68244264]
[-3.07353802  0.68244264]
[-3.07353797  0.68244265]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mags</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">truncated_normal_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Integrated flux (Joules / square meter)&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Fraction with flux ≥ $x$&quot;</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-6}$&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flares</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="n">flares</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">flares</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">/</span> <span class="n">flares</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(2.6, 9.5e-06, 273684.2105263158)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">surv_model</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">y2</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">y1</span> <span class="o">/</span> <span class="n">y2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(218.81838074390188, 3.3991818848706328, 64.37383704527177)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Lognormal Model&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span> <span class="n">surv_model</span><span class="p">[</span><span class="n">cutoff</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> 
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of solar flare flux with lognormal model&quot;</span>
<span class="p">)</span>
<span class="n">lines</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail9.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/76cd3d3f2632a360a8e47248753c0652dbe9c382750fba1d74a24811e0659d5d.png" src="_images/76cd3d3f2632a360a8e47248753c0652dbe9c382750fba1d74a24811e0659d5d.png" />
</div>
</div>
<p>The x-axis shows integrated flux on a log scale; the largest flare observed during this period measured 2.6 Joules per square meter on September 7, 2005.
By itself, that number might not mean much, but it is almost a million times bigger than the smallest flare.
So the thing to appreciate here is the great range of magnitudes.</p>
<p>Looking at the top figure, it seems like the lognormal model fits the data well.
But for fluxes greater than 0.1 Joules per square meter, the probabilities are so small they are indistinguishable.</p>
<p>Looking at the bottom figure, we can see that for fluxes in this range, the lognormal model underestimates the probabilities.
For example, according to the model, the fraction of flares with flux greater than 1 should be about 3 per million; in the dataset, it is about 200 per million.
The dotted line in the figure shows this difference.</p>
<p>If we are only interested in flares with flux less than 0.01, the lognormal model might be good enough.
But for predicting the effect of space weather on Earth, it is the largest flares we care about, and for those the lognormal model might be dangerously inaccurate.</p>
<p>Let’s see if the log-<span class="math notranslate nohighlight">\(t\)</span> model does any better.
The following figures show the distribution of fluxes again, along with a log-<span class="math notranslate nohighlight">\(t\)</span> distribution.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([12.38820488]), -3.0803784847994766, 0.6632850329593064)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model2</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">cutoff2</span> <span class="o">=</span> <span class="n">surv_model2</span><span class="o">.</span><span class="n">qs</span> <span class="o">&lt;=</span> <span class="mf">1.1</span> <span class="o">*</span> <span class="n">high</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model2</span><span class="p">[</span><span class="n">cutoff2</span><span class="p">],</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of solar flare flux with log-$t$ model&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail10.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f916bfabb94ef51ac7242cedd013e7ee0368c9b45ea7e2ae3ac7f9a4ad315a46.png" src="_images/f916bfabb94ef51ac7242cedd013e7ee0368c9b45ea7e2ae3ac7f9a4ad315a46.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">scale</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model2</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">cutoff2</span> <span class="o">=</span> <span class="n">surv_model2</span><span class="o">.</span><span class="n">qs</span> <span class="o">&lt;=</span> <span class="n">scale</span> <span class="o">*</span> <span class="n">high</span>

<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span> <span class="s2">&quot;$10^</span><span class="si">{5}</span><span class="s2">$&quot;</span><span class="p">]</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-7</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-6}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-7}$&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model2</span><span class="p">[</span><span class="n">cutoff2</span><span class="p">],</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of solar flare flux with log-$t$ model&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail10a.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9431a9be5036218d009304e418228d4864ec87877577bafc3d27e971e8c2e27e.png" src="_images/9431a9be5036218d009304e418228d4864ec87877577bafc3d27e971e8c2e27e.png" />
</div>
</div>
<p>The top figure shows that the log-<span class="math notranslate nohighlight">\(t\)</span> model fits the data well over the range of the distribution, except for some discrepancy among the smallest flares.
Maybe we don’t detect small flares as reliably, or maybe there are just fewer of them than the model predicts.</p>
<p>The bottom figure shows that the model fits the tail of the distribution except possibly for the most extreme values.
Above 1 Joule per meter squared, the actual curve drops off faster than the model, although it is still within the range of variation we expect.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">mags</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>7
</pre></div>
</div>
</div>
</div>
<p>This example shows that the distribution of the size of solar flares is longer-tailed than a lognormal distribution, which suggests that the largest possible solar flares might be substantially larger than the ones we have seen so far.</p>
<p>If we use the model to extrapolate beyond the data – which is always an uncertain thing to do – we expect 2.4 flares per million to exceed 10 Joules per square meter, and 0.36 per million to exceed 100.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="mf">20e6</span> <span class="o">/</span> <span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([21.47023593,  2.41162628,  0.35574138]), 547.0459518599563)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">t_dist</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e9</span><span class="p">,</span> <span class="mf">1e9</span> <span class="o">/</span> <span class="mi">36000</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([14.61658962]), 27777.777777777777)
</pre></div>
</div>
</div>
</div>
<p>In the last 20 years we have observed about 36,000 flares, so it would take more than 500 years to observe a million.
But in that time, we might see a solar flare 10 or 100 times bigger than the biggest we have seen so far.</p>
</section>
<section id="lunar-craters">
<h2>Lunar Craters<a class="headerlink" href="#lunar-craters" title="Permalink to this heading">#</a></h2>
<p>The largest crater on the near side of the moon, named Bailly, is 303 kilometers in diameter; the largest on the far side, the South Pole-Aitken basin, is roughly 2500 kilometers in diameter.</p>
<p>In addition to large, visible craters like these, there are innumerable smaller craters.
The Lunar Crater Database catalogs nearly all of the ones larger than one kilometer, about 1.3 million in total.
It is based on images taken by the Lunar Reconnaissance Orbiter, which NASA sent to the Moon in 2009.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://www.nytimes.com/2022/03/21/science/nasa-asteroid-strike.html</span>

<span class="c1"># https://en.wikipedia.org/wiki/Tunguska_event</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://www.nasa.gov/centers/goddard/news/features/2010/biggest_crater.html</span>
<span class="c1"># https://en.wikipedia.org/wiki/Bailly_(crater)</span>
<span class="c1"># https://en.wikipedia.org/wiki/South_Pole%E2%80%93Aitken_basin</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># https://astrogeology.usgs.gov/search/map/Moon/Research/Craters/lunar_crater_database_robbins_2018</span>
<span class="c1"># https://en.wikipedia.org/wiki/Lunar_Reconnaissance_Orbiter</span>
<span class="c1"># Robbins, S. J. (2018). A new global database of lunar impact craters &gt;1–2 km: 1. Crater locations and sizes, comparisons with published databases, and global analysis. Journal of Geophysical Research: Planets, 124(4), pp. 871-892. https://doi.org/10.1029/2018JE005592</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1740</span> <span class="o">*</span> <span class="mi">2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>3480
</pre></div>
</div>
</div>
</div>
<p>Download the data from <a class="reference external" href="https://astrogeology.usgs.gov/search/map/Moon/Research/Craters/lunar_crater_database_robbins_2018">https://astrogeology.usgs.gov/search/map/Moon/Research/Craters/lunar_crater_database_robbins_2018</a></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;https://pdsimage2.wr.usgs.gov/Individual_Investigations/moon_lro.kaguya_multi_craterdatabase_robbins_2018/data/lunar_crater_database_robbins_2018.csv&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>ls<span class="w"> </span>-lh<span class="w"> </span>lunar_crater_database_robbins_2018.csv
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-rw-rw-r-- 1 downey downey 228M Mar  2  2023 lunar_crater_database_robbins_2018.csv
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;lunar_crater_database_robbins_2018.csv&quot;</span>
<span class="n">craters</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">craters</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>CRATER_ID</th>
      <th>LAT_CIRC_IMG</th>
      <th>LON_CIRC_IMG</th>
      <th>LAT_ELLI_IMG</th>
      <th>LON_ELLI_IMG</th>
      <th>DIAM_CIRC_IMG</th>
      <th>DIAM_CIRC_SD_IMG</th>
      <th>DIAM_ELLI_MAJOR_IMG</th>
      <th>DIAM_ELLI_MINOR_IMG</th>
      <th>DIAM_ELLI_ECCEN_IMG</th>
      <th>...</th>
      <th>DIAM_ELLI_ANGLE_IMG</th>
      <th>LAT_ELLI_SD_IMG</th>
      <th>LON_ELLI_SD_IMG</th>
      <th>DIAM_ELLI_MAJOR_SD_IMG</th>
      <th>DIAM_ELLI_MINOR_SD_IMG</th>
      <th>DIAM_ELLI_ANGLE_SD_IMG</th>
      <th>DIAM_ELLI_ECCEN_SD_IMG</th>
      <th>DIAM_ELLI_ELLIP_SD_IMG</th>
      <th>ARC_IMG</th>
      <th>PTS_RIM_IMG</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>00-1-000000</td>
      <td>-19.83040</td>
      <td>264.7570</td>
      <td>-19.89050</td>
      <td>264.6650</td>
      <td>940.960</td>
      <td>21.31790</td>
      <td>975.874</td>
      <td>905.968</td>
      <td>0.371666</td>
      <td>...</td>
      <td>35.9919</td>
      <td>0.007888</td>
      <td>0.008424</td>
      <td>0.636750</td>
      <td>0.560417</td>
      <td>0.373749</td>
      <td>0.002085</td>
      <td>0.000968</td>
      <td>0.568712</td>
      <td>8088</td>
    </tr>
    <tr>
      <th>1</th>
      <td>00-1-000001</td>
      <td>44.77630</td>
      <td>328.6020</td>
      <td>44.40830</td>
      <td>329.0460</td>
      <td>249.840</td>
      <td>5.99621</td>
      <td>289.440</td>
      <td>245.786</td>
      <td>0.528111</td>
      <td>...</td>
      <td>127.0030</td>
      <td>0.011178</td>
      <td>0.015101</td>
      <td>1.052780</td>
      <td>0.209035</td>
      <td>0.357296</td>
      <td>0.005100</td>
      <td>0.004399</td>
      <td>0.627328</td>
      <td>2785</td>
    </tr>
    <tr>
      <th>2</th>
      <td>00-1-000002</td>
      <td>57.08660</td>
      <td>82.0995</td>
      <td>56.90000</td>
      <td>81.6464</td>
      <td>599.778</td>
      <td>21.57900</td>
      <td>632.571</td>
      <td>561.435</td>
      <td>0.460721</td>
      <td>...</td>
      <td>149.1620</td>
      <td>0.008464</td>
      <td>0.019515</td>
      <td>0.776149</td>
      <td>0.747352</td>
      <td>0.374057</td>
      <td>0.003095</td>
      <td>0.002040</td>
      <td>0.492373</td>
      <td>5199</td>
    </tr>
    <tr>
      <th>3</th>
      <td>00-1-000003</td>
      <td>1.96124</td>
      <td>230.6220</td>
      <td>1.95072</td>
      <td>230.5880</td>
      <td>558.762</td>
      <td>14.18190</td>
      <td>568.529</td>
      <td>546.378</td>
      <td>0.276416</td>
      <td>...</td>
      <td>133.6910</td>
      <td>0.007079</td>
      <td>0.007839</td>
      <td>0.526945</td>
      <td>0.532872</td>
      <td>1.262710</td>
      <td>0.004496</td>
      <td>0.001400</td>
      <td>0.595221</td>
      <td>4341</td>
    </tr>
    <tr>
      <th>4</th>
      <td>00-1-000004</td>
      <td>-49.14960</td>
      <td>266.3470</td>
      <td>-49.18330</td>
      <td>266.3530</td>
      <td>654.332</td>
      <td>17.50970</td>
      <td>665.240</td>
      <td>636.578</td>
      <td>0.290365</td>
      <td>...</td>
      <td>87.6468</td>
      <td>0.008827</td>
      <td>0.017733</td>
      <td>0.568958</td>
      <td>0.758631</td>
      <td>1.383530</td>
      <td>0.004626</td>
      <td>0.001533</td>
      <td>0.545924</td>
      <td>5933</td>
    </tr>
  </tbody>
</table>
<p>5 rows × 21 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diameters</span> <span class="o">=</span> <span class="n">craters</span><span class="p">[</span><span class="s2">&quot;DIAM_CIRC_IMG&quot;</span><span class="p">]</span>
<span class="n">diameters</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1.296796e+06
mean     2.436963e+00
std      5.519133e+00
min      1.000000e+00
25%      1.242710e+00
50%      1.606840e+00
75%      2.380860e+00
max      2.491870e+03
Name: DIAM_CIRC_IMG, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">diameters</span><span class="p">)</span>
<span class="n">mags</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1.296796e+06
mean     2.730862e-01
std      2.483783e-01
min      0.000000e+00
25%      9.436979e-02
50%      2.059726e-01
75%      3.767339e-01
max      3.396525e+00
Name: DIAM_CIRC_IMG, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1296796
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_normal</span><span class="p">(</span><span class="n">surv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.27308865 0.24837722]
[0.27308867 0.24837722]
[0.27308865 0.24837723]
[0.05295431 0.37367805]
[0.05295432 0.37367805]
[0.05295431 0.37367806]
[-0.25451594  0.46113896]
[-0.25451595  0.46113896]
[-0.25451594  0.46113898]
[-0.34244255  0.4572347 ]
[-0.34244256  0.4572347 ]
[-0.34244255  0.45723471]
[-0.2936525   0.44014652]
[-0.29365252  0.44014652]
[-0.2936525   0.44014653]
[-0.29545249  0.44042469]
[-0.2954525   0.44042469]
[-0.29545249  0.44042471]
[-0.29531495  0.44037601]
[-0.29531496  0.44037601]
[-0.29531495  0.44037602]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mags</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">truncated_normal_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Crater diameter (kilometers)&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Fraction with diameter ≥ $x$&quot;</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xlabels</span><span class="p">)</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-6}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-7}$&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>The following figures show the distribution of their sizes on a log scale, compared to a lognormal model.
The left figure shows the tail distribution on a linear scale; the right figure shows the same curve on a log scale.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">y2</span> <span class="o">*</span> <span class="mf">1e6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(242.90636307851742, 0.37897902114510834)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Lognormal model&quot;</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">surv_model</span> <span class="o">&gt;</span> <span class="mf">1e-7</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span> <span class="n">surv_model</span><span class="p">[</span><span class="n">cutoff</span><span class="p">],</span> <span class="n">n</span><span class="p">,</span> 
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Moon crater diameters with lognormal model&quot;</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">x</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">],</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail11.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/ec8e4e78c814bf1e576cdaeb9eb291d62dae3629983c5430f9f0197be35a752b.png" src="_images/ec8e4e78c814bf1e576cdaeb9eb291d62dae3629983c5430f9f0197be35a752b.png" />
</div>
</div>
<p>Looking at the figure on the left, we can see a discrepancy between the data and the model between 3 and 10 kilometers.
Nevertheless, the model fits the logarithms of the diameters well, so we could conclude that the distribution of crater sizes is approximately lognormal.</p>
<p>However, looking at the figure on the right, we can see big differences between the data and the model in the tail.
In the dataset, the fraction of craters as big as 100 kilometers is about 250 per million; according to the model, it would be less than 1 per million.
The dotted line in the figure shows this difference.</p>
<p>Going farther into the tail, the fraction of craters as big as 1000 kilometers is about 3 per million; according to the model, it would be less than one per <em>trillion</em>.
And the probability of a crater as big as the South Pole-Aitken basin is about 50 per sextillion.</p>
<p>If we are only interested in craters less than 10 kilometers in diameter, the lognormal model might be good enough.
But for questions related to the biggest craters, it is way off.</p>
<p>The following figure shows the distribution of these crater sizes, compared to a log-<span class="math notranslate nohighlight">\(t\)</span> model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">y1</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">y2</span> <span class="o">*</span> <span class="mf">1e6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(242.90636307851742, 0.37897902114510834)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="mi">1000</span><span class="p">)</span>
<span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array(3.08452525e-06), array(1.46578142e-13))
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># 50 per sextillion</span>

<span class="n">norm</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">sf</span><span class="p">(</span><span class="n">high</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1e18</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>49.38523077882056
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([11.13359356]), -0.2019431517012043, 0.37469477145698354)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mf">1.2</span> <span class="o">*</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model2</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">cutoff2</span> <span class="o">=</span> <span class="n">surv_model2</span><span class="o">.</span><span class="n">qs</span> <span class="o">&lt;=</span> <span class="mf">1.03</span> <span class="o">*</span> <span class="n">high</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model2</span><span class="p">[</span><span class="n">cutoff2</span><span class="p">],</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Moon crater diameters with log-t model&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail12.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/490d4c0710c62133ebb6fd9b1ad8bdda64368a485d11643f7765da14e03d5bfd.png" src="_images/490d4c0710c62133ebb6fd9b1ad8bdda64368a485d11643f7765da14e03d5bfd.png" />
</div>
</div>
<p>Since the dataset does not include craters smaller than one kilometer, I cut off the model at the same threshold.
We can assume that there are many smaller craters, but with this dataset we can’t tell what the distribution of their sizes looks like.</p>
<p>The log-<span class="math notranslate nohighlight">\(t\)</span> model fits the distribution well, but it’s not perfect: there are more craters near 100 km than the model expects, and fewer craters larger than 1000 km.
As usual, the world is under no obligation to follow simple rules, but this model does pretty well.</p>
</section>
<section id="asteroids">
<h2>Asteroids<a class="headerlink" href="#asteroids" title="Permalink to this heading">#</a></h2>
<p>The Jet Propulsion Laboratory (JPL) and NASA provide data related to asteroids, comets and other small bodies in our solar system.
From their Small-Body Database, I selected asteroids in the “main asteroid belt” between the orbits of Mars and Jupiter.</p>
<p>There are more than one million asteroids in this dataset, about 136,000 with known diameter.
The largest are Ceres (940 kilometers in diameter), Vesta (525 km), Pallas (513 km), and Hygeia (407 km).
The smallest are less than one kilometer.</p>
<p>I downloaded the data using the <a class="reference external" href="https://ssd.jpl.nasa.gov/tools/sbdb_query.html">Small-Body Database</a></p>
<ul class="simple">
<li><p>Selecting Inner, outer, and main belt asteroids</p></li>
<li><p>Variables: IAU name, diameter, GM (mass times gravitational constant G)</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;sbdb_query_results2.csv&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asteroids</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">asteroids</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(1138975, 3)
</pre></div>
</div>
</div>
</div>
<p>Fans of <em>The Expanse</em> will recognize the names of the largest asteroids in <a class="reference external" href="https://expanse.fandom.com/wiki/Asteroid_Belt">the Belt</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asteroids</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;diameter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>diameter</th>
      <th>GM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>693</th>
      <td>Interamnia</td>
      <td>306.313</td>
      <td>5.000000</td>
    </tr>
    <tr>
      <th>9</th>
      <td>Hygiea</td>
      <td>407.120</td>
      <td>7.000000</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Pallas</td>
      <td>513.000</td>
      <td>13.630000</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Vesta</td>
      <td>525.400</td>
      <td>17.288245</td>
    </tr>
    <tr>
      <th>0</th>
      <td>Ceres</td>
      <td>939.400</td>
      <td>62.628400</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asteroids</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;diameter&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>diameter</th>
      <th>GM</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>241</th>
      <td>Ida</td>
      <td>32.000</td>
      <td>0.00275</td>
    </tr>
    <tr>
      <th>251</th>
      <td>Mathilde</td>
      <td>52.800</td>
      <td>0.00689</td>
    </tr>
    <tr>
      <th>21</th>
      <td>Kalliope</td>
      <td>167.536</td>
      <td>0.49100</td>
    </tr>
    <tr>
      <th>106</th>
      <td>Camilla</td>
      <td>210.370</td>
      <td>0.74750</td>
    </tr>
    <tr>
      <th>15</th>
      <td>Psyche</td>
      <td>226.000</td>
      <td>1.53000</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">asteroids</span><span class="p">[</span><span class="s2">&quot;diameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    135915.000000
mean          5.265815
std           8.495350
min           0.347000
25%           2.783000
50%           3.940000
75%           5.651000
max         939.400000
Name: diameter, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">asteroids</span><span class="p">[</span><span class="s2">&quot;diameter&quot;</span><span class="p">])</span>
<span class="n">mags</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    135915.000000
mean          0.613943
std           0.257474
min          -0.459671
25%           0.444513
50%           0.595496
75%           0.752125
max           2.972851
Name: diameter, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>135915
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_normal</span><span class="p">(</span><span class="n">surv</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.61406612 0.2574008 ]
[0.61406614 0.2574008 ]
[0.61406612 0.25740082]
[0.59649365 0.22729091]
[0.59649367 0.22729091]
[0.59649365 0.22729093]
[0.59765045 0.22862602]
[0.59765047 0.22862602]
[0.59765045 0.22862603]
[0.59766666 0.22865271]
[0.59766668 0.22865271]
[0.59766666 0.22865273]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">truncated_normal_pmf</span>

<span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">mags</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">*</span> <span class="mf">0.99</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">pmf_model</span> <span class="o">=</span> <span class="n">truncated_normal_pmf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">pmf_model</span><span class="o">.</span><span class="n">make_surv</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Asteroid diameter (kilometers)&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Fraction with diameter ≥ $x$&quot;</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="mf">1.5</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y1</span> <span class="o">*</span> <span class="mf">1e6</span><span class="p">,</span> <span class="n">y2</span> <span class="o">*</span> <span class="mf">1e6</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(8188.941617943904, 39.34458611676295)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">surv_model</span> <span class="o">&gt;</span> <span class="mf">1e-6</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">,</span> <span class="mf">1e-6</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="s2">&quot;$10^{-3}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-6}$&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Lognormal model&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model</span><span class="p">[</span><span class="n">cutoff</span><span class="p">],</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of asteroid diameters with lognormal model&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail13.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/9e9e6f9f5a60ed0a04c23c21bae7ccab5a248af76c8c2c8a94015ff87183e46a.png" src="_images/9e9e6f9f5a60ed0a04c23c21bae7ccab5a248af76c8c2c8a94015ff87183e46a.png" />
</div>
</div>
<p>The following figure shows the distribution of asteroid sizes compared to a log-<span class="math notranslate nohighlight">\(t\)</span> model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="mf">6.5</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(6.5, 0.5953882516804466, 0.2150180564203059)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model2</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">cutoff2</span> <span class="o">=</span> <span class="n">surv_model2</span><span class="o">.</span><span class="n">qs</span> <span class="o">&lt;=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">high</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model2</span><span class="p">[</span><span class="n">cutoff2</span><span class="p">],</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of asteroid diameters with log-t model&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail14.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/8ccd293fa9210c7e273cb9c564601b646b439698647da04c1da28db5782a68b3.png" src="_images/8ccd293fa9210c7e273cb9c564601b646b439698647da04c1da28db5782a68b3.png" />
</div>
</div>
<p>In the top figure, we see that the log-<span class="math notranslate nohighlight">\(t\)</span> model fits the data well in the middle of the range, except possibly near 1 kilometer.
In the bottom, we see that the log-<span class="math notranslate nohighlight">\(t\)</span> model does not fit the tail of the distribution particularly well: there are more asteroids near 100 km than the model predicts.
So the distribution of asteroid sizes does not strictly follow a log-<span class="math notranslate nohighlight">\(t\)</span> distribution.
Nevertheless, we can use it to explain the distribution of crater sizes, as I’ll show in the next section.</p>
</section>
<section id="origins-of-long-tailed-distributions">
<h2>Origins of Long-Tailed Distributions<a class="headerlink" href="#origins-of-long-tailed-distributions" title="Permalink to this heading">#</a></h2>
<p>Empirically – that is, based on data rather than a physical model – the diameter of an impact crater depends on the diameter of the projectile that created it, raised to the power 0.78, and on the impact velocity raised to the power 0.44.
It also depends on the density of the asteroid and the angle of impact.</p>
<p>Source: Melosh, <em>Planetary Surface Processes</em>.</p>
<p>As a simple model of this relationship, I’ll simulate the crater formation process by drawing  asteroid diameters from the distribution in the previous section and drawing the other factors – density, velocity, and angle – from a lognormal distribution with parameters chosen to match the data.
The following figure shows the results from this simulation along with the actual distribution of crater sizes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diam_asteroid</span> <span class="o">=</span> <span class="n">asteroids</span><span class="p">[</span><span class="s2">&quot;diameter&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">diam_crater</span> <span class="o">=</span> <span class="n">craters</span><span class="p">[</span><span class="s2">&quot;DIAM_CIRC_IMG&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
<span class="n">diam_asteroid</span><span class="o">.</span><span class="n">count</span><span class="p">(),</span> <span class="n">diam_crater</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(135915, 1296796)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_crater</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">diam_crater</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">17</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">diam_crater</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">resample_asteroid</span> <span class="o">=</span> <span class="n">diam_asteroid</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">n</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># resample_asteroid = diam_asteroid</span>
<span class="n">rvs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">normal</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">resample_asteroid</span><span class="o">.</span><span class="n">count</span><span class="p">())</span>
<span class="nb">len</span><span class="p">(</span><span class="n">rvs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>129679600
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">error_func_pred</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Error function for finding parameters for the asteroid problem.</span>
<span class="sd">    </span>
<span class="sd">    params: tuple of mu and sigma</span>
<span class="sd">    </span>
<span class="sd">    returns: array of differences in the survival functions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">params</span>
    <span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">rvs</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span>
    <span class="n">pred_crater</span> <span class="o">=</span> <span class="n">factors</span> <span class="o">*</span> <span class="n">resample_asteroid</span><span class="o">**</span><span class="mf">0.78</span>
    <span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pred_crater</span><span class="p">)</span>
    <span class="n">cutoff</span> <span class="o">=</span> <span class="n">mags</span> <span class="o">&gt;=</span> <span class="n">surv_crater</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
    <span class="n">surv_pred</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">cutoff</span><span class="p">])</span>
    <span class="c1"># surv.plot()</span>
    <span class="c1"># surv_pred.plot(color=&#39;gray&#39;)</span>

    <span class="n">ps</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="mi">20</span><span class="p">)</span>
    <span class="c1"># ps = np.linspace(0.1, 0.9, 20)</span>
    <span class="n">qs</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">inverse</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
    <span class="c1"># print(qs)</span>

    <span class="n">error</span> <span class="o">=</span> <span class="n">surv_crater</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span> <span class="o">-</span> <span class="n">surv_pred</span><span class="p">(</span><span class="n">qs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">error</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.194</span>
<span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.883</span>
<span class="n">params</span> <span class="o">=</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
<span class="n">error_func_pred</span><span class="p">(</span><span class="n">params</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-3.194, 0.883)
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-3.16249439e-04, -2.73415007e-05,  1.20415497e-04,  2.96512650e-04,
        4.48439739e-04,  6.12564529e-04,  4.29226980e-04,  2.16708737e-04,
        1.21459936e-04,  6.07299681e-05,  3.32894198e-05,  2.09586479e-05,
        8.46778641e-06,  8.78063634e-06,  7.08561326e-06,  1.45431455e-07,
        1.04829884e-05,  1.38803636e-05,  1.38803636e-05,  4.62678787e-06])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">run_minimize</span><span class="p">():</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Find the values of mu and sigma that solve the asteroid problem.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">least_squares</span><span class="p">(</span><span class="n">error_func_pred</span><span class="p">,</span> <span class="n">x0</span><span class="o">=</span><span class="n">params</span><span class="p">,</span> <span class="n">xtol</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">,</span> <span class="n">diff_step</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">res</span><span class="o">.</span><span class="n">success</span>
    <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">res</span><span class="o">.</span><span class="n">x</span>
    <span class="k">return</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>


<span class="c1"># mu, sigma = run_minimize()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">factors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">power</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">rvs</span> <span class="o">*</span> <span class="n">sigma</span> <span class="o">+</span> <span class="n">mu</span><span class="p">)</span>
<span class="n">pred_crater</span> <span class="o">=</span> <span class="n">factors</span> <span class="o">*</span> <span class="n">resample_asteroid</span><span class="o">**</span><span class="mf">0.78</span>
<span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">pred_crater</span><span class="p">)</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">mags</span> <span class="o">&gt;=</span> <span class="n">surv_crater</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">()</span>
<span class="n">surv_pred</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">[</span><span class="n">cutoff</span><span class="p">])</span>
<span class="n">surv_pred</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>probs</th>
    </tr>
    <tr>
      <th>diameter</th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0.000001</th>
      <td>1.000000</td>
    </tr>
    <tr>
      <th>0.000002</th>
      <td>0.999995</td>
    </tr>
    <tr>
      <th>0.000005</th>
      <td>0.999990</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;Crater diameter (kilometers)&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Fraction with diameter ≥ $x$&quot;</span>

<span class="n">xticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">1000</span><span class="p">]</span>

<span class="n">cutoff</span> <span class="o">=</span> <span class="n">surv_pred</span><span class="o">.</span><span class="n">qs</span> <span class="o">&gt;=</span> <span class="mi">0</span>
<span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Simulated crater sizes&quot;</span>

<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv_crater</span><span class="p">,</span>
    <span class="n">surv_pred</span><span class="p">,</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Moon crater diameters with simulation results&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail15.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/220bc590b8037e015775f9e854e105ec32a2f82fca6dc143d384d723132f25f5.png" src="_images/220bc590b8037e015775f9e854e105ec32a2f82fca6dc143d384d723132f25f5.png" />
</div>
</div>
<p>The simulation results are a good match for the data.
This example suggests that the distribution of crater sizes can be explained by the relationship between the distributions of asteroid sizes and other factors like velocity and density.</p>
</section>
<section id="stock-market-crashes">
<h2>Stock Market Crashes<a class="headerlink" href="#stock-market-crashes" title="Permalink to this heading">#</a></h2>
<p>Like natural disasters, the distribution of magnitudes of stock market crashes is long-tailed.
To demonstrate, I’ll use data from the MeasuringWorth Foundation which has compiled the value of the Dow Jones Industrial Average at the end of each day from February 16, 1885 to the present, with adjustments at several points to make the values consistent.
The series I collected ends on May 6, 2022, so it includes 37,512 days.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># &quot;Citation: Samuel H. Williamson, &#39;Daily Closing Value of the Dow Jones Average, 1885 to Present,&#39; MeasuringWorth, 2022. &quot;</span>

<span class="c1"># https://www.measuringworth.com/datasets/DJA</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;DJA.csv&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">djia</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">skiprows</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">djia</span><span class="o">.</span><span class="n">shape</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(37512, 2)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">djia</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>DJIA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2/16/1885</td>
      <td>30.9226</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2/17/1885</td>
      <td>31.3365</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2/18/1885</td>
      <td>31.4744</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2/19/1885</td>
      <td>31.6765</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2/20/1885</td>
      <td>31.4252</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">djia</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>DJIA</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>37507</th>
      <td>5/2/2022</td>
      <td>33061.50</td>
    </tr>
    <tr>
      <th>37508</th>
      <td>5/3/2022</td>
      <td>33128.79</td>
    </tr>
    <tr>
      <th>37509</th>
      <td>5/4/2022</td>
      <td>34061.06</td>
    </tr>
    <tr>
      <th>37510</th>
      <td>5/5/2022</td>
      <td>32997.97</td>
    </tr>
    <tr>
      <th>37511</th>
      <td>5/6/2022</td>
      <td>32899.37</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>In percentage terms, the largest single-day drop was 22.6%, during the Black Monday crash.
The second largest drop was 12.9% on March 16, 2020, during the crash caused by the COVID-19 pandemic.
Numbers three and four on the list were 12.8% and 11.7%, on consecutive days during Wall Street Crash of 1929.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">djia</span><span class="p">[</span><span class="s2">&quot;DJIA&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">djia</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span><span class="o">**</span><span class="n">diff</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
<span class="n">djia</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;change&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>DJIA</th>
      <th>change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>28833</th>
      <td>10/19/1987</td>
      <td>1738.74</td>
      <td>-22.610538</td>
    </tr>
    <tr>
      <th>36978</th>
      <td>3/16/2020</td>
      <td>20188.52</td>
      <td>-12.926547</td>
    </tr>
    <tr>
      <th>13297</th>
      <td>10/28/1929</td>
      <td>260.64</td>
      <td>-12.820684</td>
    </tr>
    <tr>
      <th>13298</th>
      <td>10/29/1929</td>
      <td>230.07</td>
      <td>-11.728821</td>
    </tr>
    <tr>
      <th>36976</th>
      <td>3/12/2020</td>
      <td>21200.62</td>
      <td>-9.988443</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>On the positive side, the largest single-day gain was on March 15, 1933, when the index gained 15.3%.
There were other large gains in October 1929 and October 1931.
The largest gain of the 21st century, so far, was on March 24, 2020, when the index gained 11.4% in expectation that the U.S. Congress would pass a large economic stimulus bill.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">djia</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s2">&quot;change&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tail</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date</th>
      <th>DJIA</th>
      <th>change</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>36984</th>
      <td>3/24/2020</td>
      <td>20704.9100</td>
      <td>11.365038</td>
    </tr>
    <tr>
      <th>13299</th>
      <td>10/30/1929</td>
      <td>258.4700</td>
      <td>12.344069</td>
    </tr>
    <tr>
      <th>13871</th>
      <td>10/6/1931</td>
      <td>99.3400</td>
      <td>14.870490</td>
    </tr>
    <tr>
      <th>14292</th>
      <td>3/15/1933</td>
      <td>62.1000</td>
      <td>15.341753</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2/16/1885</td>
      <td>30.9226</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>But these large moves are unusual; on 95% of days, the change is less than 2 percentage points either way.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">djia</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    37511.000000
mean         0.712317
std          0.799769
min          0.000000
25%          0.217753
50%          0.493605
75%          0.935523
max         22.610538
Name: change, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">djia</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.9453508210705908
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">djia</span><span class="p">[</span><span class="s2">&quot;change&quot;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.028897419492429088
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">djia</span><span class="p">[</span><span class="s2">&quot;DJIA&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
<span class="n">all_mags</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    37511.000000
mean         0.000081
std          0.004660
min         -0.111318
25%         -0.001970
50%          0.000195
75%          0.002291
max          0.061987
Name: DJIA, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">all_mags</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="p">(</span><span class="n">all_mags</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span> <span class="p">(</span><span class="n">all_mags</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(0.5231392621027938, 0.4713158455960759, 0.005518234165067178)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">all_mags</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="p">(</span><span class="n">r</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.018582199949923606
</pre></div>
</div>
</div>
</div>
<p>As an aside, the index climbed on 52.3% of days, fell on 47.1% of days, and closed exactly where it opened on the remaining 0.06% of days.
The average increase was only 0.02% per day, but with about 250 trading days per year, that amounts to an increase of 4.8% annually.
After 37,512 days, the total increase is more than 100,000%.
So that’s a pretty good return on investment, if you made the investment in 1885.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">r</span><span class="o">**</span><span class="mi">250</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.04754694096007417
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">all_mags</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">r</span><span class="o">**</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(37512, 1063.1240848647278)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">start</span><span class="p">,</span> <span class="n">end</span> <span class="o">=</span> <span class="n">djia</span><span class="p">[</span><span class="s2">&quot;DJIA&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
<span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">,</span> <span class="n">end</span> <span class="o">/</span> <span class="n">start</span> <span class="o">-</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(30.9226, 32899.37, 1062.926383939255)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">losses</span> <span class="o">=</span> <span class="n">all_mags</span> <span class="o">&lt;</span> <span class="mi">0</span>
<span class="n">losses</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.4713158455960759
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="o">-</span><span class="n">all_mags</span><span class="p">[</span><span class="n">losses</span><span class="p">]</span>
<span class="n">mags</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    1.768000e+04
mean     3.196865e-03
std      3.704198e-03
min      7.287896e-07
25%      9.450282e-04
50%      2.151678e-03
75%      4.170744e-03
max      1.113182e-01
Name: DJIA, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">mags</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.7738946206503647
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>17680
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_normal</span><span class="p">(</span><span class="n">surv</span><span class="p">)</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.00319705 0.00370412]
[0.00319706 0.00370412]
[0.00319705 0.00370414]
[-0.0013507   0.00550956]
[-0.00135072  0.00550956]
[-0.0013507   0.00550957]
[-0.00621391  0.00604884]
[-0.00621392  0.00604884]
[-0.00621391  0.00604886]
[-0.01126   0.007184]
[-0.01126002  0.007184  ]
[-0.01126     0.00718402]
[-0.01332923  0.00747085]
[-0.01332924  0.00747085]
[-0.01332923  0.00747086]
[-0.01298826  0.00737537]
[-0.01298827  0.00737537]
[-0.01298826  0.00737538]
[-0.01293662  0.00736386]
[-0.01293664  0.00736386]
[-0.01293662  0.00736387]
[-0.01293473  0.00736343]
[-0.01293475  0.00736343]
[-0.01293473  0.00736344]
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(-0.012934732189136055, 0.007363429563516698)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">truncated_normal_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;One day percent change&quot;</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;no change&quot;</span><span class="p">,</span> <span class="s2">&quot;-5%&quot;</span><span class="p">,</span> <span class="s2">&quot;-10%&quot;</span><span class="p">,</span> <span class="s2">&quot;-15%&quot;</span><span class="p">,</span> <span class="s2">&quot;-20%&quot;</span><span class="p">]</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.85</span><span class="p">,</span> <span class="mf">0.8</span><span class="p">])</span>
<span class="n">xticks</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([-0.        ,  0.02227639,  0.04575749,  0.07058107,  0.09691001])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span><span class="p">(</span><span class="n">xticks</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">100</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.48076923076922906
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cutoff</span> <span class="o">=</span> <span class="n">surv_model</span> <span class="o">&gt;</span> <span class="mf">1e-5</span>
<span class="n">yticks</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">1e-3</span><span class="p">,</span> <span class="mf">1e-4</span><span class="p">,</span> <span class="mf">1e-5</span><span class="p">]</span>
<span class="n">ylabels</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s2">&quot;$10^{-4}$&quot;</span><span class="p">,</span> <span class="s2">&quot;$10^{-5}$&quot;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<p>Since we are interested in stock market crashes, I selected the 17,680 days when the value of the index dropped.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Lognormal model&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;Fraction with drop ≥ $x$&quot;</span>

<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model</span><span class="p">[</span><span class="n">cutoff</span><span class="p">],</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of negative changes with lognormal model&quot;</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail16.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/25a121b4f28ed2d4687935a4115c38b895f1751a5104896952833f213d859b19.png" src="_images/25a121b4f28ed2d4687935a4115c38b895f1751a5104896952833f213d859b19.png" />
</div>
</div>
<p>On the left, the lognormal model seems to fit the distribution well, but again there are big differences hiding in the tail.
On the right, we can see that the lognormal model does not fit the tail of the distribution at all.</p>
<p>The following figure shows the distribution of these negative percentage changes compared to a log-<span class="math notranslate nohighlight">\(t\)</span> model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">)])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(array([3.8945931]), -0.002607418984953457, 0.003426713548607919)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="mf">1.02</span> <span class="o">*</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
<span class="n">cutoff</span> <span class="o">=</span> <span class="n">surv_model</span><span class="o">.</span><span class="n">qs</span> <span class="o">&lt;=</span> <span class="n">high</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span>
    <span class="n">surv</span><span class="p">,</span>
    <span class="n">surv_model</span><span class="p">,</span>
    <span class="n">n</span><span class="p">,</span>
    <span class="n">hatch</span><span class="o">=</span><span class="s2">&quot;/&quot;</span><span class="p">,</span>
    <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Tail distribution of stock market changes with log-$t$ model&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">surv</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;C0&quot;</span><span class="p">,</span> <span class="n">style</span><span class="o">=</span><span class="s2">&quot;o&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;longtail17.png&quot;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">600</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/a5efb65b1e07abf7f4b7c8a6eef5f966cc09b1006c04ca072444d1a7acca77b3.png" src="_images/a5efb65b1e07abf7f4b7c8a6eef5f966cc09b1006c04ca072444d1a7acca77b3.png" />
</div>
</div>
<p>The top figure shows that the log-<span class="math notranslate nohighlight">\(t\)</span> model fits the left side of the distribution well.
The bottom figure shows that it fits the tail well, with the possible exception of the last data point, the 1987 crash, which falls just at the edge of variation we expect.
According to the model, there is only a 5% chance that we would see a crash as big as this one after 17,680 down days.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">y1</span> <span class="o">=</span> <span class="n">surv</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y2</span> <span class="o">=</span> <span class="n">surv_model</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="n">n</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">,</span> <span class="n">y1</span> <span class="o">/</span> <span class="n">y2</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(17680, array(5.6561086e-05), array(1.28916302e-05), 4.387426949065176)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="mi">1</span> <span class="o">-</span> <span class="n">t_dist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="n">n</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0.0542351])
</pre></div>
</div>
</div>
</div>
</section>
<section id="black-and-gray-swans">
<h2>Black and Gray Swans<a class="headerlink" href="#black-and-gray-swans" title="Permalink to this heading">#</a></h2>
<p>If you have read <em>The Black Swan</em>, by Nassim Taleb, the examples in this chapter provide context for understanding black swans and their relatives, gray swans.</p>
<p>In Taleb’s vocabulary, a black swan is a large, impactful event that was considered extremely unlikely before it happened, based on a model of prior events.
If the distribution of event sizes is actually long-tailed and the model is Gaussian, black swans will happen with some regularity.</p>
<p>For example, if we use a Gaussian distribution to model the magnitudes of earthquakes, we predict that the probability of a magnitude 7 earthquake is about 4 per sextillion (<span class="math notranslate nohighlight">\(10^{18}\)</span>).
The actual rate in the dataset we looked at is about 6 per million, which is more likely by a factor of a trillion (<span class="math notranslate nohighlight">\(10^{12}\)</span>).
When a magnitude 7 earthquake occurs, it would be a black swan if your predictions were based on the Gaussian model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># x = 7</span>
<span class="c1"># surv(x)*1e6, surv_model(x)*1e18</span>

<span class="c1"># 6.318484473557436, 4.618502751454663</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="in-a-long-tailed-world">
<h2>In a Long-Tailed World<a class="headerlink" href="#in-a-long-tailed-world" title="Permalink to this heading">#</a></h2>
<p>Imagine a world where the distribution of human height is not Gaussian or even lognormal; instead, it follows a long-tailed distribution like the various disasters in this chapter.
Specifically, suppose it follows a log-<span class="math notranslate nohighlight">\(t\)</span> distribution with the same tail thickness as the distribution of disaster costs, but with the same mean as the distribution of human height.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">filename</span> <span class="o">=</span> <span class="s2">&quot;brfss_sample.hdf&quot;</span>
<span class="n">download</span><span class="p">(</span><span class="n">DATA_PATH</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">brfss</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_hdf</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;brfss&quot;</span><span class="p">)</span>
<span class="n">height</span> <span class="o">=</span> <span class="n">brfss</span><span class="p">[</span><span class="s2">&quot;HTM4&quot;</span><span class="p">]</span>
<span class="n">height</span><span class="o">.</span><span class="n">quantile</span><span class="p">([</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.75</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.25    163.0
0.75    178.0
Name: HTM4, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mags</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">height</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="n">mags</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">mags</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>count    375271.000000
mean          2.229956
std           0.028219
min           1.959041
25%           2.212188
50%           2.230449
75%           2.250420
max           2.369216
Name: HTM4, dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv</span> <span class="o">=</span> <span class="n">make_surv</span><span class="p">(</span><span class="n">mags</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">minimize_df</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">surv</span><span class="p">,</span> <span class="p">[(</span><span class="mi">1</span><span class="p">,</span> <span class="mf">1e6</span><span class="p">)])</span>
<span class="n">df</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([999859.46341698])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="mf">3.53</span>  <span class="c1"># same as distribution of disasters</span>
<span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="n">fit_truncated_t</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">surv</span><span class="p">)</span>
<span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(3.53, 2.2293001672048596, 0.025915097488203958)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">low</span><span class="p">,</span> <span class="n">high</span> <span class="o">=</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">surv</span><span class="o">.</span><span class="n">qs</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
<span class="n">qs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">low</span><span class="p">,</span> <span class="n">high</span><span class="p">,</span> <span class="mi">2000</span><span class="p">)</span>
<span class="n">surv_model</span> <span class="o">=</span> <span class="n">truncated_t_sf</span><span class="p">(</span><span class="n">qs</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model_label</span> <span class="o">=</span> <span class="s2">&quot;Log-$t$ model&quot;</span>
<span class="n">xlabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">ylabel</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
<span class="n">xticks</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">xlabels</span> <span class="o">=</span> <span class="n">xticks</span>
<span class="n">axs</span> <span class="o">=</span> <span class="n">plot_two</span><span class="p">(</span><span class="n">surv</span><span class="p">,</span> <span class="n">surv_model</span><span class="p">,</span> <span class="n">n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/f8a590abf3448c805d8ed6813476f6aa7728460e63665bebd080199ed3a12157.png" src="_images/f8a590abf3448c805d8ed6813476f6aa7728460e63665bebd080199ed3a12157.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">decorate</span><span class="p">(</span><span class="n">xlabel</span><span class="o">=</span><span class="s2">&quot;Log Height&quot;</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s2">&quot;Prob &gt;= x&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/5ce304cc56035defdfe3fb32e93ff62f1ddf959a5ee3c50a6066f699d24bd98f.png" src="_images/5ce304cc56035defdfe3fb32e93ff62f1ddf959a5ee3c50a6066f699d24bd98f.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dist</span> <span class="o">=</span> <span class="n">t_dist</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ps</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.99</span><span class="p">,</span> <span class="mf">0.999</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">10000</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">330e6</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="mf">7e9</span><span class="p">]</span>
<span class="n">ps</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0.9, 0.99, 0.999, 0.9999, 0.999999, 0.999999996969697, 0.9999999998571428]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="p">(</span><span class="n">height</span> <span class="o">&gt;=</span> <span class="mi">277</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span> <span class="o">*</span> <span class="mf">7e9</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>0.0
</pre></div>
</div>
</div>
</div>
<p>Out of 100 people, the tallest might be 215 cm.</p>
<p>If you see 1000 people, the tallest of them might be 277 cm.</p>
<p>Out of 10,000 people, the tallest would be more than 4 meters tall.</p>
<p>Out of a million people in Long-tailed World, the tallest would be 59 meters
.
In a country the size of the United States, the tallest person would be 160,000 kilometers tall.</p>
<p>And in a world population of 7 billion, the tallest would be 14 quintillion kilometers tall, which is about 1500 light years.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># predicted heights converted from cm to m</span>

<span class="n">qs</span> <span class="o">=</span> <span class="n">dist</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">ps</span><span class="p">)</span>
<span class="n">series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="mi">10</span><span class="o">**</span><span class="n">qs</span> <span class="o">/</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">series</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1.862427e+00    0.900000
2.157498e+00    0.990000
2.770801e+00    0.999000
4.416977e+00    0.999900
5.888934e+01    0.999999
1.575737e+08    1.000000
1.445579e+19    1.000000
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># height of the tallest person in light years</span>

<span class="n">series</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="mf">9.46073e15</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1527.9783031704246
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># double-checking that the &quot;tallest people&quot; examples are on the model curve</span>

<span class="n">transformed</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">ps</span><span class="p">,</span> <span class="n">qs</span><span class="p">)</span>
<span class="n">transformed</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2.270079     1.000000e-01
2.333950     1.000000e-02
2.442605     1.000000e-03
2.645125     1.000000e-04
3.770037     1.000000e-06
10.197484    3.030303e-09
21.160042    1.428572e-10
dtype: float64
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">surv_model</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
<span class="n">surv</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ls</span><span class="o">=</span><span class="s2">&quot;--&quot;</span><span class="p">)</span>
<span class="n">transformed</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="n">decorate</span><span class="p">(</span><span class="n">yscale</span><span class="o">=</span><span class="s2">&quot;log&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="_images/3225beedbf48d4918f05d456e03e6a44941029b9fbfa7477e30cb0a8c537269b.png" src="_images/3225beedbf48d4918f05d456e03e6a44941029b9fbfa7477e30cb0a8c537269b.png" />
</div>
</div>
<p>Probably Overthinking It</p>
<p>Copyright 2022 Allen Downey</p>
<p>The code in this notebook and <code class="docutils literal notranslate"><span class="pre">utils.py</span></code> is under the <a class="reference external" href="https://mit-license.org/">MIT license</a>.</p>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="birthweight.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Causation, Collision, and Confusion</p>
      </div>
    </a>
    <a class="right-next"
       href="overton.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Chasing the Overton Window</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-distribution-of-disaster">The Distribution of Disaster</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#earthquakes">Earthquakes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#solar-flares">Solar Flares</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#lunar-craters">Lunar Craters</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#asteroids">Asteroids</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#origins-of-long-tailed-distributions">Origins of Long-Tailed Distributions</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stock-market-crashes">Stock Market Crashes</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#black-and-gray-swans">Black and Gray Swans</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#in-a-long-tailed-world">In a Long-Tailed World</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Allen B. Downey
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2022.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>